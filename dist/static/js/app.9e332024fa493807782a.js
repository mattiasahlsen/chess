webpackJsonp([13],{"1MTY":function(t,e){},"3RpM":function(t,e){},G949:function(t,e){},"LuF+":function(t,e){},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("7+uW"),i={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]};var a=n("VU/8")({name:"App"},i,!1,function(t){n("vQQj")},null,null).exports,s=n("/ocq"),o=n("Xxa5"),h=n.n(o),c=n("//Fk"),u=n.n(c),f=n("exGp"),l=n.n(f),v=n("c/Tr"),p=n.n(v),d=0,b=1,g=["P","N","B","R","Q","K","p","n","b","r","q","k"],k={white:{Q:"wQ",N:"wN",R:"wR",B:"wB"},black:{q:"bQ",n:"bN",r:"bR",b:"bB"}},w=function(t){n("TFeN")("./"+k.white[t]+".png").then(function(e){k.white[t]=e})};for(var m in k.white)w(m);var y=function(t){n("TFeN")("./"+k.black[t]+".png").then(function(e){k.black[t]=e})};for(var m in k.black)y(m);var x={name:"Promotion",data:function(){return{}},props:["pos","color","board"],computed:{file:function(){return this.pos%8},urls:function(){return this.color===d?k.white:k.black},width:function(){return this.board.offsetWidth/8},offset:function(){return this.board.getBoundingClientRect().x+(this.file-1)*this.width}}},_={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"promotion",style:{left:t.offset+"px",width:t.width+"px"}},t._l(t.urls,function(e,r){return n("img",{key:e,style:{width:t.width+"px"},attrs:{src:e},on:{click:function(e){return t.$emit("done",r)}}})}),0)},staticRenderFns:[]};var M=n("VU/8")(x,_,!1,function(t){n("LuF+")},"data-v-46a32d55",null).exports,P=n("KyXY"),C=n.n(P),R=(n("1MTY"),n("RRo+")),N=n.n(R),Q=n("Zrlr"),T=n.n(Q),B=n("wxAW"),S=n.n(B);function A(t){return t.charAt(0)===t.charAt(0).toUpperCase()}function q(t,e){return e===d?A(t):!A(t)}function E(t,e){return A(t)===A(e)}function K(t){return t===d?b:d}function F(t,e){return Math.abs(t%8-e%8)}function H(t){return 8-Math.floor(t/8)}function z(t){if("number"==typeof t)return t;if(2!==t.length)return NaN;var e=(t=t.toLowerCase()).charCodeAt(0),n=t.charCodeAt(1),r="a".charCodeAt(0),i="h".charCodeAt(0);return e>=r&&e<=i&&n>=49&&n<=56?e-97+56-8*(n-49):NaN}function I(t){var e=String.fromCharCode(t%8+97),n=H(t).toString();return e.concat(n)}function D(t,e){for(var n=0;n<64;n++)if(t[n]!==e[n])return!1;return!0}var X={P:100,N:320,B:330,R:500,Q:900,K:3e4},L={P:[0,0,0,0,0,0,0,0,50,50,50,50,50,50,50,50,10,10,20,30,30,20,10,10,5,5,10,25,25,10,5,5,0,0,0,20,20,0,0,0,5,-5,-10,0,0,-10,-5,5,5,10,10,-20,-20,10,10,5,0,0,0,0,0,0,0,0],N:[-50,-40,-30,-30,-30,-30,-40,-50,-40,-20,0,0,0,0,-20,-40,-30,0,10,15,15,10,0,-30,-30,5,15,20,20,15,5,-30,-30,0,15,20,20,15,0,-30,-30,5,10,15,15,10,5,-30,-40,-20,0,5,5,0,-20,-40,-50,-40,-30,-30,-30,-30,-40,-50],B:[-20,-10,-10,-10,-10,-10,-10,-20,-10,0,0,0,0,0,0,-10,-10,0,5,10,10,5,0,-10,-10,5,5,10,10,5,5,-10,-10,0,10,10,10,10,0,-10,-10,10,10,10,10,10,10,-10,-10,5,0,0,0,0,5,-10,-20,-10,-10,-10,-10,-10,-10,-20],R:[0,0,0,0,0,0,0,0,5,10,10,10,10,10,10,5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,0,0,0,5,5,0,0,0],Q:[-20,-10,-10,-5,-5,-10,-10,-20,-10,0,0,0,0,0,0,-10,-10,0,5,5,5,5,0,-10,-5,0,5,5,5,5,0,-5,0,0,5,5,5,5,0,-5,-10,5,5,5,5,5,0,-10,-10,0,5,0,0,0,0,-10,-20,-10,-10,-5,-5,-10,-10,-20],K:[-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30,-20,-30,-30,-40,-40,-30,-30,-20,-10,-20,-20,-20,-20,-20,-20,-10,20,20,0,0,0,0,20,20,20,30,10,0,0,10,30,20]},W={},Y=function(t){var e=t.toLowerCase();W[t]=[],W[e]=[],L[t].forEach(function(n,r){W[t].push(n+X[t]),W[e][56-r+r%8*2]=n+X[t]})};for(var U in L)Y(U);function j(t){for(var e=0,n=0;n<64;n++)if(t[n]){var r=t[n];A(r)?e+=W[r][n]:e-=W[r][n]}return e}var O=n("ifoU"),G=n.n(O),Z=n("LtXW"),J=new Z(Z.engines.mt19937().seed(27102));function V(){return J.integer(-Math.pow(2,31),Math.pow(2,31)-1)}var tt=function(){return[V(),V()]},et={};g.forEach(function(t){et[t]=[];for(var e=0;e<64;e++)et[t].push(tt());et.turn=tt(),et.wc=[tt(),tt()],et.bc=[tt(),tt()],et.epFile=[];for(var n=0;n<8;n++)et.epFile.push(tt());et.kp=[];for(var r=[3,5,59,61],i=0;i<r.length;i++)et.kp[r[i]]=tt()});!function(){function t(e){T()(this,t),this.map=new G.a,this.maxSize=e}S()(t,[{key:"size",value:function(){return this.map.size}},{key:"get",value:function(t){var e=t[0],n=t[1],r=this.map.get(e);if(void 0!==r)return this.map.delete(e),this.map.set(e,r),r[n]}},{key:"add",value:function(t,e){var n=t[0],r=t[1],i=this.map.get(n);if(void 0!==i)i[r]=e,this.map.delete(n),this.map.set(n,i);else{var a=[];a[r]=e,this.map.set(n,a)}return this.map.size>this.maxSize&&this.map.delete(this.map.keys().next().value),e}},{key:"clear",value:function(){this.map.clear()}},{key:"setSize",value:function(t){this.maxSize=t}}])}();var nt=function(){function t(e){T()(this,t),this.cache=[],this.currentSize=0,this.maxSize=e}return S()(t,[{key:"size",value:function(){return this.currentSize}},{key:"setSize",value:function(t){this.maxSize=t}},{key:"get",value:function(t){var e=t[0],n=t[1];return void 0!==this.cache[e]?this.cache[e][n]:void 0}},{key:"add",value:function(t,e){var n=t[0],r=t[1];return this.currentSize===this.maxSize&&(this.cache=[],this.currentSize=0),void 0!==this.cache[n]?(void 0===this.cache[n][r]&&this.currentSize++,this.cache[n][r]=e):(this.cache[n]=[],this.cache[n][r]=e,this.currentSize++),e}},{key:"clear",value:function(){this.cache=[],this.currentSize=0}}]),t}(),rt=56,it=7,at=-8,st=-1,ot={};for(var ht in ot.P=[at,-16,-9,-7],ot.N=[-17,-15,-10,6,17,15,-6,10],ot.B=[-9,-7,7,9],ot.R=[at,1,8,st],ot.Q=[at,-7,1,9,8,7,st,-9],ot.K=[at,-7,1,9,8,7,st,-9],ot)ot[ht.toLowerCase()]=ot[ht];ot.p=[];for(var ct=0;ct<ot.P.length;ct++)ot.p.push(-ot.P[ct]);var ut,ft=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[!0,!0],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[!0,!0],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,h=arguments[7],c=arguments[8],u=arguments[9];if(T()(this,t),"string"==typeof e){var f=e;this.board=[],this.wc=[!1,!1],this.bc=[!1,!1],this.ep=-1,this.kp=-1;for(var l=f.trim().split(/ +/),v=0,p=0;p<l[0].length;){var g=l[0].charAt(p),k=parseInt(g);if(N()(k)){for(var w=0;w<k;w++)this.board[v+w]=null;v+=k}else g=g,this.board[v]=g,v++;if(p++,v>=64)break;v%8==0&&p++}switch(l[1]){case"w":this.turn=d;break;case"b":this.turn=b;break;default:throw new Error("Invalid fen string")}if("-"!==l[2])for(var m=[],y=0;y<l[2].length;y++){var x=l[2].charAt(y);switch(x){case"Q":this.wc[0]=!0;break;case"K":this.wc[1]=!0;break;case"q":this.bc[1]=!0;break;case"k":this.bc[0]=!0;break;default:throw new Error("Invalid fen string")}m.push(x)}"-"!==l[3]&&(this.ep=z(l[3])),this.halfMoveClock=parseInt(l[4])}else this.board=e,this.turn=n,this.wc=r,this.bc=i,this.ep=a,this.kp=s,this.halfMoveClock=o;this.score=void 0!==h?h:this.turn===d?j(this.board):-j(this.board),this.hash=void 0!==c?c:function(t){var e=[0,0],n=function(t){e[0]^=t[0],e[1]^=t[1]};t.turn===d&&n(et.turn);for(var r=0;r<64;r++){var i=t.board[r];i&&n(et[i][r])}return t.wc[0]&&n(et.wc[0]),t.wc[1]&&n(et.wc[1]),t.bc[0]&&n(et.bc[0]),t.bc[1]&&n(et.bc[1]),-1!==t.ep&&n(et.epFile[t.ep%8]),-1!==t.kp&&n(et.kp[t.kp]),e}(this),this.boardHash=void 0!==u?u:this.hashBoard()}return S()(t,[{key:"genMoves",value:h.a.mark(function t(){var e,n,r,i,a,s,o,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.turn;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=0;case 1:if(!(e<this.board.length)){t.next=48;break}if(null!==(n=this.board[e])&&q(n,c)){t.next=5;break}return t.abrupt("continue",45);case 5:if("K"!==n.toUpperCase()){t.next=13;break}if(!(r=c===d?this.wc:this.bc)[0]||null!==this.board[e-1]||null!==this.board[e-2]){t.next=10;break}return t.next=10,[e,e-2];case 10:if(!r[1]||null!==this.board[e+1]||null!==this.board[e+2]){t.next=13;break}return t.next=13,[e,e+2];case 13:i=0;case 14:if(!(i<ot[n].length)){t.next=45;break}if(!(-16===(a=ot[n][i])&&e<rt-8||16===a&&e>it+8)){t.next=18;break}return t.abrupt("continue",42);case 18:s=e+a;case 19:if(!(s>=0&&s<=63&&F(s,s-a)<6)){t.next=42;break}if(o=this.board[s],"P"!==n.toUpperCase()){t.next=30;break}if(0!==F(e,s)||null===o){t.next=24;break}return t.abrupt("break",42);case 24:if(2!==(h=e,u=s,Math.abs(Math.floor(h/8)-Math.floor(u/8)))||null===this.board[e+a/2]){t.next=26;break}return t.abrupt("break",42);case 26:if(1!==F(e,s)||s===this.ep||null!==o&&!E(o,n)){t.next=28;break}return t.abrupt("break",42);case 28:t.next=35;break;case 30:if(null===o){t.next=35;break}if(E(o,n)){t.next=34;break}return t.next=34,[e,s];case 34:return t.abrupt("break",42);case 35:return t.next=37,[e,s];case 37:if(!"KkNnPp".includes(n)){t.next=39;break}return t.abrupt("break",42);case 39:s+=a,t.next=19;break;case 42:i++,t.next=14;break;case 45:e++,t.next=1;break;case 48:case"end":return t.stop()}var h,u},t,this)})},{key:"nullMove",value:function(){var e=new t(this.board.slice(),K(this.turn),this.wc,this.bc,-1,-1,this.halfMoveClock+1,-this.score,this.hashNullMove(),this.boardHash);return e.prev=this,e}},{key:"move",value:function(e,n,r){var i=e[0],a=e[1],s=this.board[i];n||(n=this.turn===d?"Q":"q");var o=this.board.slice(),h=this.wc.slice(),c=this.bc.slice(),u=-1,f=-1;void 0===r&&(r=-(this.score+this.value(e,n)));var l=void 0;if(l=o[a]?0:this.halfMoveClock+1,o[a]=o[i],o[i]=null,"K"===s)h=[!1,!1],2===Math.abs(a-i)&&(o[f=(i+a)/2]="R",o[a<i?rt:63]=null);else if("k"===s)c=[!1,!1],2===Math.abs(a-i)&&(o[f=(i+a)/2]="r",o[a<i?0:it]=null);else{var v=function(t){switch(t){case rt:h[0]=!1;break;case 63:h[1]=!1;break;case 0:c[0]=!1;break;case it:c[1]=!1}};v(i),v(a),"P"===s?(l=0,a-i==-16?u=(a+i)/2:a===this.ep?o[a+8]=null:a<=it&&(o[a]=n)):"p"===s&&(l=0,a-i==16?u=(a+i)/2:a===this.ep?o[a-8]=null:a>=rt&&(o[a]=n))}var p=this.hashMove(e,n),b=new t(o,K(this.turn),h,c,u,f,l,r,p[0],p[1]);return b.prev=this,b}},{key:"value",value:function(t,e){var n=t[0],r=t[1],i=this.board[n],a=this.board[r];if(-1!==this.kp&&Math.abs(r-this.kp)<2)return 3e4;var s=W[i][r]-W[i][n];return a&&(s+=W[a][r]),"K"===i&&2===Math.abs(r-n)?(s+=W.R[(r+n)/2],s-=r<n?W.R[rt]:W.R[63]):"k"===i&&2===Math.abs(r-n)&&(s+=W.r[(r+n)/2],s-=r<n?W.r[0]:W.r[it]),"P"===i?r<=it?s+=W[e||"Q"][r]-W[i][r]:r===this.ep&&(a=this.board[r+8],s+=W[a][r+8]):"p"===i&&(r>=rt?s+=W[e||"q"][r]-W[i][r]:r===this.ep&&(a=this.board[r-8],s+=W[a][r-8])),s}},{key:"hashMove",value:function(t,e){var n=this,r=t[0],i=t[1],a=this.board[r],s=this.board[i],o=this.hash.slice(),h=this.boardHash.slice(),c=function(t){o[0]^=t[0],o[1]^=t[1]},u=function(t){h[0]^=t[0],h[1]^=t[1]};if(c(et.turn),-1!==this.ep&&c(et.epFile[this.ep%8]),-1!==this.kp&&c(et.kp[this.kp]),c(et[a][r]),c(et[a][i]),u(et[a][r]),u(et[a][i]),s&&(c(et[s][i]),u(et[s][i])),"K"===a&&2===Math.abs(i-r)){var f=(i+r)/2;c(et.wc[0]),c(et.wc[1]),c(et.kp[f]),c(et.R[f]),u(et.R[f]),i<r?(c(et.R[rt]),u(et.R[rt])):(c(et.R[63]),u(et.R[63]))}else if("k"===a&&2===Math.abs(i-r)){var l=(i+r)/2;c(et.bc[0]),c(et.bc[1]),c(et.kp[l]),c(et.r[l]),u(et.r[l]),i<r?(c(et.r[0]),u(et.r[0])):(c(et.r[it]),u(et.r[it]))}else{var v=function(t){switch(t){case rt:n.wc[0]&&c(et.wc[0]);break;case 63:n.wc[1]&&c(et.wc[1]);break;case 0:n.bc[0]&&c(et.bc[0]);break;case it:n.bc[1]&&c(et.bc[1])}};v(r),v(i),"P"===a?i-r==-16?c(et.epFile[(i+r)/2%8]):i===this.ep?(s=this.board[i+8],c(et[s][i+8]),u(et[s][i+8])):i<=it&&(c(et[a][i]),c(et[e||"Q"][i]),u(et[a][i]),u(et[e||"Q"][i])):"p"===a&&(i-r==16?c(et.epFile[(i+r)/2%8]):i===this.ep?(s=this.board[i-8],c(et[s][i-8]),u(et[s][i-8])):i>=rt&&(c(et[a][i]),c(et[e||"q"][i]),u(et[a][i]),u(et[e||"q"][i])))}return[o,h]}},{key:"hashNullMove",value:function(){var t=this.hash.slice(),e=function(e){t[0]^=e[0],t[1]^=e[1]};return-1!==this.ep&&e(et.epFile[this.ep%8]),-1!==this.kp&&e(et.kp[this.kp]),e(et.turn),t}},{key:"hashBoard",value:function(){for(var t=[0,0],e=0;e<64;e++){var n=this.board[e];n&&(t[0]^=et[n][e][0],t[1]^=et[n][e][1])}return t}},{key:"valid",value:function(t){for(var e=this.genMoves(),n=e.next();!n.done;){if(t[0]===n.value[0]&&t[1]===n.value[1]){for(var r=this.move(t),i=r.genMoves(),a=i.next();!a.done;){if(-1!==r.kp&&Math.abs(a.value[1]-r.kp)<2)return!1;var s=r.board[a.value[1]];if(null!==s&&"Kk".includes(s))return!1;a=i.next()}return!0}n=e.next()}return!1}},{key:"inCheck",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.turn,e=void 0,n=void 0,r=void 0,i=void 0;for(var a in t===d?(i=this.board.indexOf("K"),e={bq:ot.B,rq:ot.R,n:ot.N},r="p",n=[7,9]):(i=this.board.indexOf("k"),e={BQ:ot.B,RQ:ot.R,N:ot.N},r="P",n=[-9,-7]),e)for(var s=0;s<e[a].length;s++)for(var o=i+e[a][s];o>=0&&o<=63&&F(o,o-e[a][s])<6;){if(this.board[o]){if(a.includes(this.board[o]))return!0;if(this.board[o]===r&&(i===o+n[0]||i===o+n[1]))return!0;break}if("Nn".includes(a))break;o+=e[a][s]}return!1}},{key:"toString",value:function(){for(var t="",e=0,n=0;n<64;n++)null===this.board[n]?e++:(e>0&&(t+=e,e=0),t+=this.board[n]),n%8==7&&(e>0&&(t+=e,e=0),n<63&&(t+="/"));return t+=" ",this.turn===d?t+="w":t+="b",t+=" ",this.wc[0]||this.wc[1]||this.bc[0]||this.bc[1]?(this.wc[1]&&(t+="K"),this.wc[0]&&(t+="Q"),this.bc[1]&&(t+="k"),this.bc[0]&&(t+="q")):t+="-",t+=" ",-1!==this.ep?t+=I(this.ep):t+="-",t+=" ",t+=this.halfMoveClock,t+=" ",t+=1}}]),t}(),lt=n("woOf"),vt=n.n(lt),pt=(ut=l()(h.a.mark(function t(e,n,r){var i,a,s,o;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i={lower:-dt,upper:dt},s=(a=r)-2*bt,o=Qt(e);do{i.lower!==-dt&&i.upper!==dt?s=i.upper-i.lower>3?Math.floor((i.lower+i.upper)/2):a+(a===i.lower?1:0):a===i.lower?s=a+bt:a===i.upper&&(s=a-bt),(a=Tt(e,n,s-1,s,o.new(),!0))<s?i.upper=a:(i.lower=a,Pt=!0)}while(i.lower<=i.upper-1&&!Ct());return t.abrupt("return",[i.lower,i.upper]);case 6:case"end":return t.stop()}},t,this)})),function(t,e,n){return ut.apply(this,arguments)}),dt=15*X.Q,bt=50,gt="L",kt="E",wt="H",mt=new nt(1e7),yt=new nt(1e3);yt.push=function(t){var e=this.get(t);void 0!==e?this.add(t,e+1):this.add(t,1)},yt.pull=function(t){var e=this.get(t);void 0!==e&&e>0&&this.add(t,e-1)};!function(){function t(){return T()(this,t),this.origins={},this}S()(t,[{key:"add",value:function(t){this.origins[t[0]]?this.origins[t[0]][t[1]]=!0:(this.origins[t[0]]={},this.origins[t[0]][t[1]]=!0)}},{key:"forEach",value:function(t,e){for(var n in this.origins)for(var r in this.origins[n]);}}])}();var xt=0,_t=0,Mt=void 0,Pt=!1,Ct=function(){return Date.now()>Mt&&Pt};function Rt(t,e,n){if(e){var r=e[0],i=void 0;if(i=r[1]===t.ep?"P"===t.board[r[0]]?t.board[t.ep+8]:"p"===t.board[r[0]]?t.board[t.ep-8]:t.board[r[1]]:t.board[r[1]],n(e[0],e[1],i))return}var a=t.genMoves(),s=a.next();if(!s.done)for(;!s.done;){var o=s.value,h=void 0;if(h=o[1]===t.ep?"P"===t.board[o[0]]?t.board[t.ep+8]:t.board[t.ep-8]:t.board[o[1]],"P"===t.board[o[0]]&&o[1]<=it){for(var c=0;c<"QNRB".length;c++)if(n(o,"QNRB".charAt(c),h))return}else if("p"===t.board[o[0]]&&o[1]>=rt){for(var u=0;u<"qnrb".length;u++)if(n(o,"qnrb".charAt(u),h))return}else if(n(o,void 0,h))return;s=a.next()}}function Nt(t){for(var e=t.genMoves(),n=e.next();!n.done;)if("Kk".includes(t.board[n.value[0]])&&2===Math.abs(n.value[1]-n.value[0]))n=e.next();else{if(!t.move(n.value).inCheck(t.turn))return!1;n=e.next()}return!0}function Qt(t){var e={};g.forEach(function(t){e[t]=0});for(var n=0;n<64;n++){var r=t.board[n];r&&e[r]++}return e.new=function(t){var e=vt()({},this);return t&&e[t]--,e},e.endgame=function(){return!(this.Q>0&&(this.R>0||this.B+this.N>1))&&!(this.q>0&&(this.r>0||this.b+this.n>1))},e.insufficientMaterial=function(){return 0===this.Q&&0===this.q&&0===this.P&&0===this.p&&0===this.R&&0===this.r&&(0===this.B||1===this.B&&0===this.N)&&(0===this.b||1===this.b&&0===this.n)},e}function Tt(t,e,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(_t++,e<0&&(e=0),t.halfMoveClock>=50)return 0;if(yt.get(t.boardHash)>=3)return 0;var s=!0,o=void 0,h=mt.get(t.hash);if(h&&(o=h.pv,h.depth>=e))switch(xt++,h.fail){case gt:if(h.score<=n)return n;break;case kt:return h.score;case wt:if(h.score>=r)return r}h=mt.add(t.hash,{pv:o,score:n,depth:e,fail:gt});var c=i.endgame();if(c&&i.insufficientMaterial())return h.score=0,h.fail=kt,0;var u=function(t,e,i){return!!Ct()||(i>n?(h.fail=wt,s=!1,h.pv=[t,e],n=i>=dt?dt:r,!0):(i>-dt&&(s=!1),!1))};if(e<=0)if(t.score>=r){if(!t.inCheck())return c&&Nt(t)?(h.score=0,h.fail=kt,0):(h.score=r,h.fail=wt,r);s=!1,Rt(t,o,function(e,a,s){var o=t.move(e,a);if(o.inCheck(t.turn))return!1;yt.push(o.boardHash);var h=-Tt(o,0,-r,-n,i.new(s));return yt.pull(o.boardHash),u(e,a,h)})}else{if(t.score+X.Q<n)return t.inCheck(K(t.turn))?(h.fail=wt,h.score=dt,dt):c&&!t.inCheck()&&Nt(t)?(h.score=0,h.fail=kt,0):n;if(Rt(t,o,function(e,a,s){if(-1!==t.kp&&Math.abs(t.kp-e[1])<2)return n=dt,h.fail=wt,!0;if(!(t.board[e[1]]||e[1]===t.ep&&"Pp".includes(t.board[e[0]])))return!1;var o=t.score+t.value(e,a);if(o>=dt)return n=dt,h.fail=wt,!0;if((t.board[e[1]]||e[1]===t.ep)&&o+2*X.P>=n){var c=t.move(e,a,-o);yt.push(c.boardHash);var f=-Tt(c,0,-r,-n,i.new(s));return yt.pull(c.boardHash),u(e,a,f)}return!1}),s&&n<r)return h.fail=kt,h.score=t.score,t.score}else{if(!a&&1===e&&t.score+X.Q<n)return t.inCheck(K(t.turn))?(h.score=dt,h.fail=wt,dt):c&&Nt(t)?(h.score=0,h.fail=kt,0):n;if(!a&&!c&&-Tt(t.nullMove(),e-3,-r,-n,i.new())>=r)return h.score=r,h.fail=wt,r;Rt(t,o,function(a,s){var o=t.score+t.value(a,s);if(o>=dt)return n=dt,h.fail=wt,!0;if(1===e&&o+2*X.P<n)return!1;var c=t.move(a,s,-o);yt.push(c.boardHash);var f=-Tt(c,e-1,-r,-n,i.new());return yt.pull(c.boardHash),u(a,s,f)})}return s&&c&&!t.inCheck()&&Nt(t)?(h.score=0,h.fail=kt,0):(Ct()&&(h.fail=wt),h.score=n,n)}var Bt=function(){var t=l()(h.a.mark(function t(e,n){var r,i,a,s,o,c,u,f,l,v,d,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e4,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,k=arguments[4],w=arguments[5];return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=e.score,i=void 0,g<1&&(g=1),n.forEach(function(t){yt.push(new ft(t.fen).boardHash)}),yt.push(e.boardHash),b<1e3&&(b=1e3),b>6e4&&(b=6e4),Mt=Date.now()+b,k.searched=0,k.tpHits=0,a=1;case 11:if(!(a<=g)||Ct()){t.next=44;break}k.depth=a,s=p()(e.genMoves()),o=0;case 15:if(!(o<s.length)){t.next=35;break}return c=s[o],u=e.move(c),f=mt.get(u.hash),t.next=21,pt(u,a-1,f&&f.score);case 21:if(i=t.sent,l=-i[1],(!r||r<l)&&(r=l),!w){t.next=32;break}if(!f){t.next=30;break}return t.next=28,w(c,o,f.score,f.depth+1);case 28:t.next=32;break;case 30:return t.next=32,w(c,o,e.score,1);case 32:o++,t.next=15;break;case 35:return t.next=37,pt(e,a,r);case 37:i=t.sent,r=i[0],a++,k.searched=_t,k.tpHits=xt,t.next=11;break;case 44:return Ct()?"time":"depth",Pt=!1,_t=0,xt=0,v=mt.get(e.hash),d=v,mt.clear(),yt.clear(),t.abrupt("return",d);case 53:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}(),St={startPos:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",searchTime:6},At=new(function(){function t(e){T()(this,t),this.config=St,this.history=[],this.aiInfo={depth:0,searched:0,tpHits:0},e&&this.configure(e),this.setPos(this.config.startPos)}return S()(t,[{key:"configure",value:function(t){for(var e in t)this.config[e]=t[e]}},{key:"getConfig",value:function(){return this.config}},{key:"setPos",value:function(t){var e,n,r=[],i=void 0,a=[!1,!1],s=[!1,!1],o=-1,h=t.trim().split(/ +/);if(6!==h.length)return!1;for(var c=0,u=0;u<h[0].length;){var f=h[0].charAt(u),l=parseInt(f);if(N()(l)&&l>0){if(l>8-c%8)return!1;for(var v=0;v<l;v++)r[c+v]=null;c+=l}else{if(!g.includes(f))return!1;f=f,r[c]=f,c++}if(u++,c>=64)break;if(c%8==0){if("/"!==h[0].charAt(u))return!1;u++}}if(" "!==t.charAt(u))return!1;switch(h[1]){case"w":i=d;break;case"b":i=b;break;default:return!1}if("-"!==h[2]){if(h[2].length>4)return!1;for(var p=[],k=0;k<h[2].length;k++){var w=h[2].charAt(k);if(p.includes(w))return!1;switch(w){case"Q":a[0]=!0;break;case"K":a[1]=!0;break;case"q":s[1]=!0;break;case"k":s[0]=!0;break;default:return!1}p.push(w)}}if("-"!==h[3]){var m=H(o=z(h[3]));if(isNaN(o))return!1;if(3!==m&&6!==m)return!1}return e=parseInt(h[4]),n=parseInt(h[5]),!!(N()(e)&&e>=0)&&(!!(N()(n)&&n>0)&&(this.fullMove=n,this.position=new ft(r,i,a,s,o,-1,e),this.history=[],!0))}},{key:"validFen",value:function(t){return(new this.constructor).setPos(t)}},{key:"fen",value:function(){for(var t=this.position,e=t.board,n="",r=0,i=0;i<64;i++)null===e[i]?r++:(r>0&&(n+=r,r=0),n+=e[i]),i%8==7&&(r>0&&(n+=r,r=0),i<63&&(n+="/"));return n+=" ",t.turn===d?n+="w":n+="b",n+=" ",t.wc[0]||t.wc[1]||t.bc[0]||t.bc[1]?(t.wc[1]&&(n+="K"),t.wc[0]&&(n+="Q"),t.bc[1]&&(n+="k"),t.bc[0]&&(n+="q")):n+="-",n+=" ",-1!==t.ep?n+=I(t.ep):n+="-",n+=" ",n+=t.halfMoveClock,n+=" ",n+=this.fullMove,n}},{key:"move",value:function(t,e,n){if(t=z(t),e=z(e),n)if(this.position.turn===d){if(!"QNRB".includes(n))return!1}else if(!"qnrb".includes(n))return!1;return!!this.valid(t,e)&&(this.history.push({fen:this.fen(),move:[t,e]}),this.position=this.position.move([t,e],n),this.position.turn===d&&(this.fullMove+=1),!0)}},{key:"undoMove",value:function(){var t=this.history,e=t.pop();return e?(this.setPos(e.fen),this.history=t,e.move):null}},{key:"winner",value:function(){return this.inCheckMate()?this.position.turn===d?"black":"white":this.fiftyMoves()||this.inThreefoldRepetition()||this.inStaleMate()||this.insuffMaterial()?"draw":null}},{key:"insuffMaterial",value:function(){return Qt(this.position).insufficientMaterial()}},{key:"fiftyMoves",value:function(){return this.position.halfMoveClock>=50}},{key:"inThreefoldRepetition",value:function(){for(var e=1,n=0;n<this.history.length;n++){var r=new t;if(r.setPos(this.history[n].fen),D(r.position.board,this.position.board)&&3===++e)return!0}return!1}},{key:"inCheckMate",value:function(){return 0===this.moves().length&&this.position.inCheck()}},{key:"inStaleMate",value:function(){return 0===this.moves().length&&!this.position.inCheck()}},{key:"moves",value:function(){for(var t=[],e=this.position.genMoves(),n=e.next();!n.done;)this.position.valid(n.value)&&t.push(n.value),n=e.next();return t}},{key:"valid",value:function(t,e){return t=z(t),e=z(e),this.position.valid([t,e])}},{key:"restart",value:function(){this.setPos(this.config.startPos)}},{key:"aiMove",value:function(){var t=l()(h.a.mark(function t(e,n){var r,i;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null===this.winner()){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,Bt(this.position,this.history,1e3*this.config.searchTime,e,this.aiInfo,this.config.betweenDepths);case 4:if(r=t.sent,!(i=r.pv)){t.next=14;break}if(!n){t.next=10;break}return t.next=10,n(r);case 10:return this.move(i[0][0],i[0][1],i[1]),t.abrupt("return",i);case 14:throw new Error("The AI failed to make a move");case 15:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}()},{key:"turn",value:function(){return this.position.turn===d?"white":"black"}}]),t}()),qt={name:"Home",components:{Promotion:M},data:function(){return{game:At,promotion:null,winner:At.winner(),aiInfo:At.aiInfo,fen:At.fen(),startPos:At.config.startPos,board:null,thinking:!1,startedThinking:null,winningEntry:null}},computed:{invalidFen:function(){return!At.validFen(this.fen)},invalidStartPos:function(){return!At.validFen(this.startPos)}},watch:{"game.position.board":function(){this.board.position(this.game.fen(),!0),this.winner=this.game.winner(),this.fen=this.game.fen()},"game.position.turn":function(){var t=this;"black"===this.game.turn()&&null===this.game.winner()&&setTimeout(function(){var e;t.thinking=!0,t.startedThinking=new Date,t.moves=p()(t.game.position.genMoves()).map(function(t){return{move:t}}),t.game.aiMove(100,(e=l()(h.a.mark(function e(n){var r,i;return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.winningEntry=n,r=n.pv,i=t.$refs.canvas.getContext("2d"),t.$refs.canvas.width=t.$refs.canvas.width,i.lineWidth=6,i.strokeStyle="#00ff99",i.shadowOffsetX=2,i.shadowOffsetX=2,i.shadowBlur=5,i.shadowColor="rgba(0, 0, 0, 0.02)",t.drawLine(i,r[0][0],r[0][1]),e.next=13,new u.a(function(t,e){return setTimeout(t,1e3)});case 13:t.winningEntry=null;case 14:case"end":return e.stop()}},e,t)})),function(t){return e.apply(this,arguments)})).finally(function(){t.thinking=!1,t.startedThinking=null})},100)},"game.aiInfo":{handler:function(t){this.aiInfo=t},deep:!0}},mounted:function(){var t,e=this;this.game.configure({betweenDepths:(t=l()(h.a.mark(function t(n,r,i,a){var s;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(s=e.$refs.canvas.getContext("2d")).lineWidth=4,s.strokeStyle="#33cccc",s.shadowOffsetX=2,s.shadowOffsetX=2,s.shadowBlur=5,s.shadowColor="rgba(0, 0, 0, 0.02)",e.drawLine(s,n[0],n[1]),e.moves[r].score=i,e.moves[r].depth=a,e.$forceUpdate(),t.next=13,new u.a(function(t,e){return setTimeout(t,10)});case 13:case"end":return t.stop()}},t,e)})),function(e,n,r,i){return t.apply(this,arguments)})}),this.onDragStart=function(t,n){return("w"===n.charAt(0)?d:b)===e.game.position.turn&&null===e.winner},this.onDrop=function(t,n,r){if(!e.game.valid(t,n))return"snapback";var i=H(z(n));if("P"!==r.charAt(1)||8!==i&&1!==i)e.game.move(t,n);else{var a="w"===r.charAt(0)?d:b;e.promotion={pos:z(n),color:a,src:t,target:n}}},this.createBoard(),window.onresize=this.createBoard,this.$refs.board.ontouchmove=function(t){return t.preventDefault()}},methods:{drawLine:function(t,e,n){var r=this.getX(e),i=this.getY(e);t.moveTo(r,i);var a=this.getX(n),s=this.getY(n);t.lineTo(a,s),t.stroke()},canvasWidth:function(){return this.$refs.canvas.offsetWidth},canvasHeight:function(){return this.$refs.canvas.offsetHeight},textX:function(t){return(this.getX(t[0])+this.getX(t[1]))/2},textY:function(t){return(this.getY(t[0])+this.getY(t[1]))/2},getX:function(t){return(t%8+.5)/8*this.canvasWidth()},getY:function(t){return(Math.floor(t/8)+.5)/8*this.canvasHeight()},thinkProgress:function(){return 100*(((new Date).getTime()-this.startedThinking.getTime())/(1e3*this.game.config.searchTime))},createBoard:function(){var t=$(window).height(),e=$(window).width();this.$refs.board.style.width=this.$refs.board.style.height=Math.min(e,t)+"px",this.board=C()("board",{position:this.game.fen(),draggable:!0,onDrop:this.onDrop,onDragStart:this.onDragStart})},destroyBoard:function(){this.board&&this.board.destroy(),this.board=null},handlePromotion:function(t){this.game.move(this.promotion.src,this.promotion.target,t),this.promotion=null},cancel:function(){this.promotion=null,this.board.position(this.game.fen(),!1)},undoMove:function(){this.game.undoMove(),At.position.turn===b&&this.game.undoMove()},restart:function(){console.log("restart"),this.game.restart()},setPos:function(){this.game.setPos(this.fen)&&(this.fen=this.game.fen())},setStartPos:function(){At.validFen(this.startPos)&&this.game.configure({startPos:this.startPos})},resetStartPos:function(){this.game.configure({startPos:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"}),this.startPos=this.game.config.startPos},setTime:function(t){this.game.configure({searchTime:t})}}},Et={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"content"},[t.promotion?n("Promotion",{attrs:{pos:t.promotion.pos,board:t.$refs.board,color:t.promotion.color},on:{done:t.handlePromotion}}):t._e(),t._v(" "),n("div",{ref:"boardContainer",staticClass:"board-container"},[n("div",{ref:"board",attrs:{id:"board","touch-action":"none"},on:{click:t.cancel}}),t._v(" "),t.thinking||t.winningEntry?n("canvas",{ref:"canvas",attrs:{id:"canvas",height:t.$refs.boardContainer.offsetHeight,width:t.$refs.boardContainer.offsetWidth}}):t._e(),t._v(" "),t.thinking&&t.$refs.canvas?n("div",{staticClass:"overlay"},[t.winningEntry?t._e():n("p",{staticClass:"thinking-text"},[t._v("Thinking...")]),t._v(" "),t.winningEntry?t._e():n("div",{staticClass:"think-bar"},[n("div",{staticClass:"think-bar-fill",style:{width:t.thinkProgress()+"%"}})]),t._v(" "),t.winningEntry?n("p",{staticClass:"move-text winning-move-text",style:{left:t.textX(t.winningEntry.pv[0])+"px",top:t.textY(t.winningEntry.pv[0])+"px"}},[t._v("\n          Winning move"),n("br"),t._v("Score: "+t._s(t.winningEntry.score)+"\n        ")]):t._l(t.moves,function(e,r){return n("p",{key:r,staticClass:"move-text",style:{left:t.textX(e.move)+"px",top:t.textY(e.move)+"px"}},[t._v("\n          "+t._s(e.score)+"\n        ")])})],2):t._e()]),t._v(" "),n("div",{staticClass:"info"},[n("h1",[t._v("Jackfish")]),t._v(" "),n("h2",[t._v("A chess engine in javascript.")]),t._v(" "),n("div",{staticClass:"game-status col-sm-6"},["white"===t.winner?n("h3",[t._v("The winner is\n          "),n("span",{staticClass:"white"},[t._v("white")])]):"black"===t.winner?n("h3",[t._v("The winner is\n          "),n("span",{staticClass:"black"},[t._v("black")])]):"draw"===t.winner?n("h3",[t._v("It's a draw")]):n("h3",{style:{visibility:"hidden"}},[t._v("\n          Game is still running.\n        ")]),t._v(" "),n("button",{staticClass:"btn btn-light",attrs:{type:"button"},on:{click:t.undoMove}},[t._v("\n          Undo move\n        ")]),t._v(" "),n("button",{staticClass:"btn btn-light",attrs:{type:"button"},on:{click:t.restart}},[t._v("\n          Restart\n        ")]),t._v(" "),n("div",{staticClass:"mt-3"},[n("p",[n("strong",[t._v("Depth searched:")]),t._v(" "+t._s(t.aiInfo.depth))]),t._v(" "),n("p",[n("strong",[t._v("Nodes searched:")]),t._v(" "+t._s(t.aiInfo.searched))])])]),t._v(" "),t._m(0),t._v(" "),t._m(1),t._v(" "),n("p",{staticClass:"created-by"},[t._v("Created by Mattias Ahlsén")])])],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"col-sm-6 links"},[e("h3",[this._v("About")]),this._v(" "),e("p",[this._v("\n          This is a chess engine I've built in javascript.\n          All rules apply: insufficient material, fifty-move rule, threefold\n          repetition etc. More info below.\n        ")]),this._v(" "),e("a",{staticClass:"btn btn-primary btn-lg",attrs:{target:"_blank",href:"https://github.com/mattiasahlsen/jackfish/",role:"button"}},[this._v("\n          Github repo\n        ")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"about mt-4 mb-4"},[n("h4",{staticClass:"mt-3"},[t._v("Features")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://chessprogramming.wikispaces.com/Simplified+evaluation+function"}},[t._v("\n          Piece-square table evaluation\n        ")])]),t._v(" "),n("li",{},[n("a",{attrs:{href:"https://chessprogramming.wikispaces.com/MTD%28f%29"}},[t._v("\n          MTD(f)\n        ")])]),t._v(" "),n("li",{},[n("a",{attrs:{href:"https://chessprogramming.wikispaces.com/Alpha-Beta"}},[t._v("\n          Alpha-beta\n        ")])]),t._v(" "),n("li",{},[n("a",{attrs:{href:"https://chessprogramming.wikispaces.com/Iterative+Deepening"}},[t._v("\n          Iterative deepening\n        ")])]),t._v(" "),n("li",{},[n("a",{attrs:{href:"https://chessprogramming.wikispaces.com/Transposition%20Table#KeyCollisions"}},[t._v("\n          Transposition table\n        ")])]),t._v(" "),n("li",{},[n("a",{attrs:{href:"https://chessprogramming.wikispaces.com/Quiescence+Search"}},[t._v("\n          Quiescence search\n        ")])]),n("li",{},[n("a",{attrs:{href:"https://chessprogramming.wikispaces.com/delta+pruning"}},[t._v("\n          Delta pruning\n        ")])])]),t._v(" "),n("h4",{staticClass:"mt-3"},[t._v("Credits to")]),t._v(" "),n("div",[n("a",{attrs:{href:"https://chessprogramming.wikispaces.com/"}},[t._v("https://chessprogramming.wikispaces.com/")])]),t._v(" "),n("div",[n("a",{attrs:{href:"https://github.com/thomasahle/sunfish"}},[t._v("https://github.com/thomasahle/sunfish")])]),t._v(" "),n("div")])}]};var Kt=n("VU/8")(qt,Et,!1,function(t){n("3RpM"),n("G949")},"data-v-462c73c8",null).exports;r.a.use(s.a);var Ft=new s.a({routes:[{path:"/",name:"Home",component:Kt}]}),Ht=n("8smA"),zt=n("7t+N"),$t=n.n(zt);n("qb6w");r.a.use(Ht.a),window.$=window.jquery=$t.a,r.a.config.productionTip=!1,new r.a({el:"#app",router:Ft,components:{App:a},template:"<App/>"})},TFeN:function(t,e,n){var r={"./bB.png":["z18c",11],"./bK.png":["dLpT",10],"./bN.png":["KRZJ",9],"./bP.png":["9AiN",8],"./bQ.png":["+a6Z",7],"./bR.png":["fFy0",6],"./wB.png":["xofh",5],"./wK.png":["zrxd",4],"./wN.png":["Zz9q",3],"./wP.png":["gMX9",2],"./wQ.png":["80Ug",1],"./wR.png":["rP+x",0]};function i(t){var e=r[t];return e?n.e(e[1]).then(function(){return n(e[0])}):Promise.reject(new Error("Cannot find module '"+t+"'."))}i.keys=function(){return Object.keys(r)},i.id="TFeN",t.exports=i},qb6w:function(t,e){},vQQj:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.9e332024fa493807782a.js.map