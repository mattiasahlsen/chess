{"version":3,"sources":["webpack:///./src/App.vue?5975","webpack:///./src/App.vue","webpack:///src/App.vue","webpack:///./src/jackfish/declarations.js","webpack:///src/components/Promotion.vue","webpack:///./src/components/Promotion.vue?5b82","webpack:///./src/components/Promotion.vue","webpack:///./src/jackfish/helpers.js","webpack:///./src/jackfish/evaluation.js","webpack:///./src/jackfish/tp.js","webpack:///./src/jackfish/Position.js","webpack:///./src/jackfish/AI.js","webpack:///./src/jackfish/index.js","webpack:///src/components/Home.vue","webpack:///./src/components/Home.vue?e60b","webpack:///./src/components/Home.vue","webpack:///./src/router/index.js","webpack:///./src/main.js"],"names":["selectortype_template_index_0_src_App","render","_h","this","$createElement","_c","_self","attrs","id","staticRenderFns","src_App","__webpack_require__","normalizeComponent","name","ssrContext","WHITE","BLACK","PIECES","imgs","white","Q","N","R","B","black","q","n","r","b","key","Promotion__key","Promotion","data","props","computed","file","pos","urls","color","width","board","offsetWidth","offset","getBoundingClientRect","x","components_Promotion","_vm","staticClass","style","left","_l","img","piece","src","on","click","$event","$emit","src_components_Promotion","Promotion_normalizeComponent","isWhite","charAt","toUpperCase","isColor","sameColor","p1","p2","next","c","colDif","Math","abs","rank","p","floor","parse","s","length","NaN","toLowerCase","charCodeAt","a","h","squareToString","String","fromCharCode","toString","concat","equalBoards","b1","b2","i","PIECE","P","K","pstRaw","pst","bKey","forEach","e","push","evaluation_key","_loop","evaluate","value","Random","random","engines","mt19937","seed","rand","integer","pow","randoms","hashes","turn","wc","bc","epFile","kp","kps","Lru","maxSize","classCallCheck_default","map","map_default","createClass_default","size","hash","low","high","arr","get","undefined","delete","set","val","keys","clear","tp_Cwf","Cwf","cache","currentSize","A1","H8","W","steps","Position_key","S","Position_i","Position","boardOrFen","arguments","ep","halfMoveClock","score","myHash","boardHash","fen","subs","trim","split","num","parseInt","is_integer_default","j","Error","used","applyHashes","hashParam","tp_hash","hashBoard","rights","step","t","tp","includes","ret","slice","hashNullMove","prev","move","promo","o","op","helper","newHashes","hashMove","_this","newHash","newBoardHash","applyHash","applyBoardHash","moves","genMoves","el","done","nextPos","nextMoves","nextEl","mySteps","pawnSteps","pawn","kingSquare","indexOf","bq","rq","BQ","RQ","spaces","MAX_SCORE","SEARCH_MARGIN","L","AI_E","H","AI_tp","boardTable","count","add","pull","Killer","origins","callBack","tpHits","searched","timeLimit","gotMove","timeout","Date","now","forMoves","pv","callback","inStalemate","inCheck","getPieces","pieces","new","takenPiece","newPieces","assign_default","endgame","insufficientMaterial","alphaBeta","depth","alpha","beta","root","stalemate","entry","fail","handleMove","nextScore","nullMove","mtdf","guess","bound","lower","upper","f","AI","_ref","asyncToGenerator_default","regenerator_default","mark","_callee","history","stopReason","deepestEntry","returnVal","time","maxDepth","logs","betweenDepths","wrap","_context","jackfish_Position","abrupt","stop","_x2","_x3","apply","defaultConfig","startPos","searchTime","Home_game","Engine","options","config","aiInfo","configure","setPos","fullMove","isNaN","position","constructor","valid","last","pop","inCheckMate","fiftyMoves","inThreefoldRepetition","inStaleMate","insuffMaterial","game","generator","winner","Home","components","promotion","invalidFen","validFen","invalidStartPos","watch","game.position.board","game.position.turn","setTimeout","aiMove","game.aiInfo","handler","deep","mounted","_this2","promise_default","resolve","chessboard_default","draggable","onDrop","target","onDragStart","methods","handlePromotion","cancel","undoMove","restart","setStartPos","resetStartPos","setTime","components_Home","_v","visibility","type","directives","rawName","expression","domProps","input","composing","$set","_e","_m","_s","$refs","ref","href","role","src_components_Home","Home_normalizeComponent","vue_esm","use","vue_router_esm","router","routes","path","component","window","$","jquery","jquery_default","productionTip","App","template"],"mappings":"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","file":"static/js/app.27717567fd604572dc69.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"app\"}},[_c('router-view')],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-0e232033\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/App.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-0e232033\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!../node_modules/vue-loader/lib/selector?type=styles&index=0!./App.vue\")\n}\nvar normalizeComponent = require(\"!../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../node_modules/vue-loader/lib/selector?type=script&index=0!./App.vue\"\nimport __vue_script__ from \"!!babel-loader!../node_modules/vue-loader/lib/selector?type=script&index=0!./App.vue\"\n/* template */\nimport __vue_template__ from \"!!../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-0e232033\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../node_modules/vue-loader/lib/selector?type=template&index=0!./App.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/App.vue\n// module id = null\n// module chunks = ","<template>\n  <div id=\"app\">\n    <router-view/>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'App'\n}\n</script>\n\n<style>\n#app {\n  font-family: 'Avenir', Helvetica, Arial, sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  text-align: center;\n  color: #2c3e50;\n  margin-top: 60px;\n}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/App.vue","/**\n * Type and constants declarations.\n * @flow\n */\n\nexport const WHITE = 0;\nexport const BLACK = 1;\nexport const PIECES = [\n  'P', 'N', 'B', 'R', 'Q', 'K',\n  'p', 'n', 'b', 'r', 'q', 'k'\n];\n\nexport type Color = 0 | 1;\n// ' ' means no piece\nexport type Piece = 'P' | 'N' | 'B' | 'R' | 'Q' | 'K' |\n                    'p' | 'n' | 'b' | 'r' | 'q' | 'k';\n// [white, black], piece objects may be any order\n// must have no empty elements\nexport type Board = Array<Piece | null>;\n\nexport type Move = [number, number]; // [from, to]\nexport type CR = [boolean, boolean]; // castling rights [queenside, kingside]\n\nexport type Hash = [number, number];\nexport type History = Array<{fen: string, move: Move}>;\n\n// used for testing\nexport type PieceObj = {| pos: number, piece: Piece |};\nexport type Pieces = Array<PieceObj>;\n\n\n\n// WEBPACK FOOTER //\n// ./src/jackfish/declarations.js","<template>\n  <div class=\"promotion\" :style=\"{\n    left: offset + 'px',\n    width: width + 'px',\n  }\">\n    <img v-for=\"(img, piece) in urls\" :key=\"img\"\n      :src=\"img\" @click=\"$emit('done', piece)\"\n      :style=\"{ width: width + 'px', }\"\n    >\n  </div>\n</template>\n\n<script>\nimport { WHITE } from '@/jackfish/declarations';\n\n// piece img urls\nconst imgs = {\n  white: {\n    Q: 'wQ',\n    N: 'wN',\n    R: 'wR',\n    B: 'wB',\n  },\n  black: {\n    q: 'bQ',\n    n: 'bN',\n    r: 'bR',\n    b: 'bB',\n  }\n};\n\nfor (const key in imgs.white) {\n  imgs.white[key] = '/img/chesspieces/wikipedia/' + imgs.white[key] + '.png';\n}\nfor (const key in imgs.black) {\n  imgs.black[key] = '/img/chesspieces/wikipedia/' + imgs.black[key] + '.png';\n}\n\nexport default {\n  name: 'Promotion',\n  data() {\n    return {\n    };\n  },\n  props: ['pos', 'color', 'board'],\n  computed: {\n    file() {\n      return this.pos % 8; // 0 - 7\n    },\n    // piece img urls\n    urls() {\n      if (this.color === WHITE) return imgs.white;\n      else return imgs.black;\n    },\n    width() {\n      return this.board.offsetWidth / 8;\n    },\n    offset() {\n      return this.board.getBoundingClientRect().x +\n        (this.file - 1) * this.width;\n    }\n  },\n};\n</script>\n\n<style scoped>\n.promotion {\n  position: absolute;\n  background-color: white;\n  box-shadow: 1px 1px 5px;\n  z-index: 100;\n}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/Promotion.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"promotion\",style:({\n  left: _vm.offset + 'px',\n  width: _vm.width + 'px',\n})},_vm._l((_vm.urls),function(img,piece){return _c('img',{key:img,style:({ width: _vm.width + 'px', }),attrs:{\"src\":img},on:{\"click\":function($event){_vm.$emit('done', piece)}}})}))}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-6968ab57\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/Promotion.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-6968ab57\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Promotion.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Promotion.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Promotion.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-6968ab57\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./Promotion.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-6968ab57\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/Promotion.vue\n// module id = null\n// module chunks = ","/**\n * Helper functions.\n * @flow\n */\n\nimport { WHITE, BLACK } from './declarations';\nimport type { Piece, Color, Board } from './declarations';\n\nexport function isWhite(piece: Piece): boolean {\n  return piece.charAt(0) === piece.charAt(0).toUpperCase();\n}\n\nexport function isColor(piece: Piece, color: Color): boolean {\n  return color === WHITE ? isWhite(piece) : !isWhite(piece);\n}\n\nexport function sameColor(p1: Piece, p2: Piece): boolean {\n  return isWhite(p1) === isWhite(p2);\n}\n\n// Returns the other color.\nexport function next(c: Color): Color {\n  return c === WHITE ? BLACK : WHITE;\n}\n\nexport function rowDif(p1: number, p2: number): number {\n  return Math.abs(Math.floor(p1 / 8) - Math.floor(p2 / 8));\n}\n\nexport function colDif(p1: number, p2: number): number {\n  return Math.abs(p1 % 8 - p2 % 8);\n}\n\nexport function rank(p: number): number {\n  return 8 - Math.floor(p / 8)\n}\n\n/**\n * Parses a position on form 'f5'. If it's already a number, returns the\n * number.\n * @return The corresponding number, or NaN if the string was invalid.\n */\nexport function parse(s: string | number) {\n  if (typeof s === 'number') return s;\n  if (s.length !== 2) return NaN;\n\n  s = s.toLowerCase();\n  const file = s.charCodeAt(0); // char representing file\n  const rank = s.charCodeAt(1); // char representing rank\n  const a = 'a'.charCodeAt(0);\n  const h = 'h'.charCodeAt(0);\n  if (!(file >= a && file <= h && rank >= 49 && rank <= 56)) {\n    return NaN;\n  }\n\n  // 97 is ascii for 'a' and 49 for '1'\n  return file - 97 + 56 - (rank - 49) * 8;\n}\n\n/**\n * Parses a position on number form to from 'f5'.\n * Assumes pos >= 0 && pos <= 63.\n * @return The string, or null if the number was invalid.\n */\nexport function squareToString(pos: number): string {\n  const file: string = String.fromCharCode(pos % 8 + 97);\n  const r: string = rank(pos).toString();\n  return file.concat(r);\n}\n\nexport function equalBoards (b1: Board, b2: Board) {\n  for (let i = 0; i < 64; i++) {\n    if (b1[i] !== b2[i]) return false;\n  }\n  return true;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/jackfish/helpers.js","/**\n * Evaluation of a position.\n * @flow\n */\n\nimport { isWhite } from './helpers';\n\nimport type { Board, Piece } from './declarations';\n\n// Piece values.\n// King value is set to a very high value to easily detect when king is taken,\n// and thereby detecting checkmate, and to always avoid it if possible.\nexport const PIECE = { P: 100, N: 320, B: 330, R: 500, Q: 900, K: 30000 };\n\n// Piece-square tables.\n// Index is index of position on the board for white, and for the board\n// flipped for black.\n// Taken from https://chessprogramming.wikispaces.com/Simplified%20evaluation%20function\n\n/* eslint-disable */\nexport const pstRaw = {\n  // pawn\n  P: [\n     0,  0,  0,  0,  0,  0,  0,  0,\n    50, 50, 50, 50, 50, 50, 50, 50,\n    10, 10, 20, 30, 30, 20, 10, 10,\n     5,  5, 10, 25, 25, 10,  5,  5,\n     0,  0,  0, 20, 20,  0,  0,  0,\n     5, -5,-10,  0,  0,-10, -5,  5,\n     5, 10, 10,-20,-20, 10, 10,  5,\n     0,  0,  0,  0,  0,  0,  0,  0\n  ],\n  // knight\n  N: [\n    -50,-40,-30,-30,-30,-30,-40,-50,\n    -40,-20,  0,  0,  0,  0,-20,-40,\n    -30,  0, 10, 15, 15, 10,  0,-30,\n    -30,  5, 15, 20, 20, 15,  5,-30,\n    -30,  0, 15, 20, 20, 15,  0,-30,\n    -30,  5, 10, 15, 15, 10,  5,-30,\n    -40,-20,  0,  5,  5,  0,-20,-40,\n    -50,-40,-30,-30,-30,-30,-40,-50,\n  ],\n  // bishop\n  B: [\n    -20,-10,-10,-10,-10,-10,-10,-20,\n    -10,  0,  0,  0,  0,  0,  0,-10,\n    -10,  0,  5, 10, 10,  5,  0,-10,\n    -10,  5,  5, 10, 10,  5,  5,-10,\n    -10,  0, 10, 10, 10, 10,  0,-10,\n    -10, 10, 10, 10, 10, 10, 10,-10,\n    -10,  5,  0,  0,  0,  0,  5,-10,\n    -20,-10,-10,-10,-10,-10,-10,-20,\n  ],\n  // rook\n  R: [\n     0,  0,  0,  0,  0,  0,  0,  0,\n     5, 10, 10, 10, 10, 10, 10,  5,\n    -5,  0,  0,  0,  0,  0,  0, -5,\n    -5,  0,  0,  0,  0,  0,  0, -5,\n    -5,  0,  0,  0,  0,  0,  0, -5,\n    -5,  0,  0,  0,  0,  0,  0, -5,\n    -5,  0,  0,  0,  0,  0,  0, -5,\n     0,  0,  0,  5,  5,  0,  0,  0,\n  ],\n  // queen\n  Q: [\n    -20,-10,-10, -5, -5,-10,-10,-20,\n    -10,  0,  0,  0,  0,  0,  0,-10,\n    -10,  0,  5,  5,  5,  5,  0,-10,\n     -5,  0,  5,  5,  5,  5,  0, -5,\n      0,  0,  5,  5,  5,  5,  0, -5,\n    -10,  5,  5,  5,  5,  5,  0,-10,\n    -10,  0,  5,  0,  0,  0,  0,-10,\n    -20,-10,-10, -5, -5,-10,-10,-20,\n  ],\n  // king\n  K: [\n    -30,-40,-40,-50,-50,-40,-40,-30,\n    -30,-40,-40,-50,-50,-40,-40,-30,\n    -30,-40,-40,-50,-50,-40,-40,-30,\n    -30,-40,-40,-50,-50,-40,-40,-30,\n    -20,-30,-30,-40,-40,-30,-30,-20,\n    -10,-20,-20,-20,-20,-20,-20,-10,\n     20, 20,  0,  0,  0,  0, 20, 20,\n     20, 30, 10,  0,  0, 10, 30, 20\n  ]\n};\n/* eslint-enable */\n\n// Join psts with piece values into a final pst, and add mirrored tables\n// for black pieces\ntype Pst = {\n  [piece: Piece]: Array<number>\n};\n\nexport const pst: Pst = {};\nfor (const key in pstRaw) {\n  const bKey: Piece = (key.toLowerCase(): any); // corresponding black piece key\n  pst[(key: any)] = [];\n  pst[bKey] = [];\n  pstRaw[key].forEach((e, i) => {\n    pst[(key: any)].push(e + PIECE[key])\n    pst[bKey][56 - i + 2 * (i % 8)] = e + PIECE[key];\n  });\n}\n\n/**\n * Gives the board value for white (negate for black's).\n */\nexport default function evaluate(board: Board): number {\n  let value = 0;\n  for (let i = 0; i < 64; i++) {\n    if (board[i]) {\n      const piece: Piece = board[i];\n      if (isWhite(piece)) value += pst[piece][i];\n      else value -= pst[piece][i];\n    }\n  }\n  return value;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/jackfish/evaluation.js","/**\n * Transposition table stuff\n * @flow\n */\n\nimport Position from './Position';\nimport { PIECES, WHITE } from './declarations';\nimport type { Piece } from './declarations';\n\nconst Random = require('random-js');\n// 27102 is just a random number\nconst random = new Random(Random.engines.mt19937().seed(27102));\n\n/**\n * Zobrist hashing for positions. Hashed in two parts, low and high.\n *\n * Low is used as key in Map and high is stored at the key\n * together with a value for that position. This is because of\n * javascript's number type that can only store integers up to 52 signed\n * bits and the fact that bitwise operators in javascript only operates on\n * 32 bit signed integers.\n */\n\n// get 2 random 32 bit integers\nexport function rand() {\n  return random.integer(-Math.pow(2, 31), Math.pow(2, 31) - 1);\n}\n\n// Makes a hash tuple with low and high\nexport const randoms = () => [rand(), rand()];\n\n// initialize hashes array\ntype Hashes = {\n  [index: Piece | 'wc' | 'bc' | 'turn' | 'epFile' | 'kp']: any\n}\nconst hashes: Hashes = {};\nPIECES.forEach(p => {\n  hashes[p] = [];\n  for (let i = 0; i < 64; i++) {\n    hashes[p].push(randoms()); // [low, high]\n  }\n\n  hashes.turn = randoms(); // apply when white's turn\n\n  hashes.wc = [randoms(), randoms()]; // [queenside, kingside]\n  hashes.bc = [randoms(), randoms()];\n\n  hashes.epFile = [];\n  for (let i = 0; i < 8; i++) {\n    hashes.epFile.push(randoms()); // [A, B, C...]\n  }\n\n  hashes.kp = [];\n  const kps = [3, 5, 59, 61];\n  for (let i = 0; i < kps.length; i++) {\n    hashes.kp[kps[i]] = randoms();\n  }\n});\n\nexport { hashes };\n\n// Hash the position, returning hash as [low, high]\nexport function hash(pos: Position): [number, number] {\n  const myHash = [0, 0]; // low, high\n\n  // apply [low, high] to low and high\n  const applyHashes = (hashParam: [number, number]) => {\n    myHash[0] ^= hashParam[0];\n    myHash[1] ^= hashParam[1];\n  }\n\n  if (pos.turn === WHITE) applyHashes(hashes.turn);\n  for (let i = 0; i < 64; i++) {\n    const p = pos.board[i];\n    if (p) applyHashes(hashes[p][i]);\n  }\n  if (pos.wc[0]) applyHashes(hashes.wc[0]);\n  if (pos.wc[1]) applyHashes(hashes.wc[1]);\n  if (pos.bc[0]) applyHashes(hashes.bc[0]);\n  if (pos.bc[1]) applyHashes(hashes.bc[1]);\n  if (pos.ep !== -1) applyHashes(hashes.epFile[pos.ep % 8]);\n  if (pos.kp !== -1) applyHashes(hashes.kp[pos.kp]);\n\n  return myHash;\n}\n\n/** Transposition table */\n\n// LRU cache, first in first out, size > 0\nexport class Lru<Entry = any> {\n  map: Map<number, Array<Entry>> = new Map();\n  // max number of keys in map (not max number of entries since there can be\n  // many entries in an array at one key)\n  maxSize: number;\n\n  constructor(maxSize: number) {\n    this.maxSize = maxSize;\n  }\n\n  size() {\n    return this.map.size;\n  }\n\n  /** Returns entry at hash, or undefined if there is none. */\n  get(hash: [number, number]): ?Entry {\n    const low = hash[0];\n    const high = hash[1];\n    const arr = this.map.get(low);\n\n    if (arr !== undefined) {\n      // set to last recently used\n      this.map.delete(low);\n      this.map.set(low, arr);\n\n      return arr[high];\n    }\n    return undefined;\n  }\n\n  /** Add an entry to the cache, returns the added entry. */\n  add(hash: [number, number], val: Entry): Entry {\n    const low = hash[0];\n    const high = hash[1];\n    const arr = this.map.get(low);\n\n    if (arr !== undefined) {\n      arr[high] = val;\n      this.map.delete(low);\n      this.map.set(low, arr);\n    } else {\n      const arr = [];\n      arr[high] = val;\n      this.map.set(low, arr);\n    }\n\n    if (this.map.size > this.maxSize) {\n      // $FlowFixMe\n      this.map.delete(this.map.keys().next().value);\n    }\n\n    return val;\n  }\n\n  clear() {\n    this.map.clear();\n  }\n\n  setSize(maxSize: number) {\n    this.maxSize = maxSize;\n  }\n}\n\n// A simpler clear-when-full cache,\n// has a max size but just resets when it's reached\nexport class Cwf<Entry = any> {\n  cache: Array<Array<Entry>> = [];\n  maxSize: number;\n  currentSize: number = 0;\n\n  constructor(size: number) {\n    this.maxSize = size;\n  }\n\n  size(): number {\n    return this.currentSize;\n  }\n  setSize(size: number): void {\n    this.maxSize = size;\n  }\n\n  /** Returns entry at hash or undefined if there is none. */\n  get(hash: [number, number]): ?Entry {\n    const low = hash[0];\n    const high = hash[1];\n\n    if (this.cache[low] !== undefined) return this.cache[low][high];\n    else return undefined;\n  }\n\n  /** Add an entry to the cache. Assumes it does not already exist */\n  add(hash: [number, number], val: Entry): Entry {\n    const low = hash[0];\n    const high = hash[1];\n\n    // if passed size limit, clear cache and start over\n    // (might clear one too early)\n    if (this.currentSize === this.maxSize) {\n      this.cache = [];\n      this.currentSize = 0;\n    }\n\n    if (this.cache[low] !== undefined) {\n      if (this.cache[low][high] === undefined) this.currentSize++;\n      this.cache[low][high] = val;\n    } else {\n      this.cache[low] = [];\n      this.cache[low][high] = val;\n      this.currentSize++;\n    }\n    return val;\n  }\n  clear() {\n    this.cache = [];\n    this.currentSize = 0;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/jackfish/tp.js","/**\n * Position module.\n * @flow\n */\n\nimport { isColor, sameColor, next, colDif, rowDif,\n  parse, squareToString } from './helpers';\nimport evaluate, { pst } from './evaluation';\nimport { WHITE, BLACK } from './declarations';\nimport { hash, hashes } from './tp';\n\nimport type { Color, Board, Piece, Move, CR, Hash } from './declarations';\n\n// some squares\nexport const A1 = 56;\nexport const H1 = 63;\nexport const A8 = 0;\nexport const H8 = 7;\n\n// directions\nconst N = -8; // north\nconst E = 1; // east\nconst S = 8; // south\nconst W = -1; // west\n\n/* eslint-disable */\n// possible steps for different pieces\nconst steps = {};\nsteps.P = [N, 2*N, N+W, N+E]; // p[0] = white, p[1] = black\nsteps.N = [2*N+W, 2*N+E, 2*W+N, 2*W+S, 2*S+E, 2*S+W, 2*E+N, 2*E+S];\nsteps.B = [N+W, N+E, S+W, S+E];\nsteps.R = [N, E, S, W];\nsteps.Q = [N, N+E, E, S+E, S, S+W, W, N+W];\nsteps.K = [N, N+E, E, S+E, S, S+W, W, N+W];\n\n// add for black pieces\nfor (const key in steps) {\n  steps[key.toLowerCase()] = steps[key];\n}\n// black pawns can only move opposite direction\nsteps.p = [];\nfor (let i = 0; i < steps.P.length; i++) steps.p.push(-steps.P[i]);\n\n/* eslint-enable */\n\n/**\n * A complete position of a chess game.\n */\nexport default class Position {\n  board: Board;\n  turn: Color;\n  wc: CR;\n  bc: CR;\n  ep: number;\n  kp: number;\n  halfMoveClock: number;\n\n  score: number;\n  hash: Hash;\n  boardHash: Hash;\n\n  prev: Position | void;\n\n  constructor(\n    boardOrFen: Board | string,\n    turn: Color = WHITE,\n    wc: CR = [true, true], // white castling rights\n    bc: CR = [true, true], // black...\n    ep: number = -1, // -1 if there is none\n    kp: number = -1, // -1 if there is none\n    halfMoveClock: number = 0, // defaults to 0\n\n    // Score for color to move. If none is provided, calculates it from scratch.\n    score?: number,\n    myHash?: Hash,\n    boardHash?: Hash,\n  ) {\n    // if we get a fen string: assumes it's a valid fen string\n    if (typeof boardOrFen === 'string') {\n      const fen = boardOrFen;\n      this.board = [];\n      this.wc = [false, false];\n      this.bc = [false, false];\n      this.ep = -1;\n      this.kp = -1;\n\n      const subs = fen.trim().split(/ +/); // get substrings\n\n      let pos = 0; // current board position (square)\n      let i = 0; // index of string\n      // The board array is indexed the same way as FEN notation.\n      while (i < subs[0].length) {\n        let c = subs[0].charAt(i); // currently parsed char\n        const num = parseInt(c);\n        if (Number.isInteger(num)) {\n          for (let j = 0; j < num; j++) {\n            this.board[pos + j] = null;\n          }\n          pos += num;\n        } else {\n          // Cast to piece when we know it is one.\n          c = ((c: any): Piece)\n          this.board[pos] = c;\n          pos++;\n        }\n        i++;\n        if (pos >= 64) break; // should not be able to be bigger than 64\n        else if (pos % 8 === 0) {\n          i++;\n        }\n      }\n\n      switch (subs[1]) {\n        case 'w': this.turn = WHITE; break;\n        case 'b': this.turn = BLACK; break;\n        default: throw new Error('Invalid fen string');\n      }\n\n      if (subs[2] !== '-') {\n        const used = [];\n        for (let i = 0; i < subs[2].length; i++) {\n          const c = subs[2].charAt(i);\n          switch (c) {\n            case 'Q': this.wc[0] = true; break;\n            case 'K': this.wc[1] = true; break;\n            case 'q': this.bc[1] = true; break;\n            case 'k': this.bc[0] = true; break;\n            default: throw new Error('Invalid fen string');\n          }\n          used.push(c);\n        }\n      }\n\n      if (subs[3] !== '-') this.ep = parse(subs[3]);\n\n      this.halfMoveClock = parseInt(subs[4]);\n    } else {\n      // else just copy all the parameters to fields.\n      this.board = boardOrFen;\n      this.turn = turn;\n      this.wc = wc;\n      this.bc = bc;\n      this.ep = ep;\n      this.kp = kp;\n      this.halfMoveClock = halfMoveClock;\n    }\n\n    if (score !== undefined) this.score = score;\n    else {\n      this.score = this.turn === WHITE\n        ? evaluate(this.board) : -evaluate(this.board);\n    }\n\n    if (myHash !== undefined) this.hash = myHash;\n    else this.hash = hash((this: any));\n    if (boardHash !== undefined) this.boardHash = boardHash;\n    else this.boardHash = this.hashBoard();\n  }\n\n  /**\n   * Returns possible moves for color, including moves that result in king-take\n   * and castles invalid because of threatened squares or check. For pawn\n   * promotions, it will only generate one move without the promotion piece.\n   * You must later add the promotion piece for the move to be valid.\n   * @param [color=this.turn] The color to look for moves for.\n   */\n  *genMoves(color?: Color = this.turn): Generator<Move, void, void> {\n    for (let i = 0; i < this.board.length; i++) {\n      const piece = this.board[i];\n      if (piece === null || !isColor(piece, color)) continue;\n\n      // check for castling\n      if (piece.toUpperCase() === 'K') {\n        const rights = color === WHITE ? this.wc : this.bc;\n        if (rights[0] && this.board[i - 1] === null &&\n          this.board[i - 2] === null) yield ([i, i - 2]: Move);\n        if (rights[1] && this.board[i + 1] === null &&\n          this.board[i + 2] === null) yield ([i, i + 2]: Move);\n      }\n\n      for (let j = 0; j < steps[piece].length; j++) {\n        const step = steps[piece][j];\n        // if step is two steps, it must be a pawn\n        if ((step === 2 * N && i < A1 - 8) ||\n          (step === 2 * S && i > H8 + 8)) continue;\n\n        let t = i + step; // target square\n\n        // keep within bounds of board\n        while (t >= 0 && t <= 63 && colDif(t, t - step) < 6) {\n          const tp = this.board[t]; // target piece (or null)\n\n          // pawns get special treatment\n          if (piece.toUpperCase() === 'P') {\n            if (colDif(i, t) === 0 && tp !== null) break;\n            if (rowDif(i, t) === 2 && this.board[i + step / 2] !== null) break;\n            if (colDif(i, t) === 1 && t !== this.ep &&\n              (tp === null || sameColor(tp, piece))) break;\n          } else if (tp !== null) {\n            if (!sameColor(tp, piece)) {\n              yield ([i, t]: Move);\n            }\n            break;\n          }\n\n          yield ([i, t]: Move);\n          if ('KkNnPp'.includes(piece)) break;\n          t += step;\n        }\n      }\n    }\n  }\n\n  /**\n   * Makes a nullmove, i.e. switches turn, resets en passant and negates score.\n   */\n  nullMove(): Position {\n    // copying board with slice, works because it's shallow\n    const ret = new Position(this.board.slice(), next(this.turn), this.wc, this.bc,\n      -1, -1, this.halfMoveClock + 1,\n      -this.score, this.hashNullMove(), this.boardHash);\n    ret.prev = this;\n    return ret;\n  }\n\n  /**\n   * Makes the move and returns the new position. Does not alter this\n   * position. Assumes that the move is valid.\n   * @param move  The move\n   * @param promo If there is a promotion of a pawn, this is the piece to\n   *              replace it with. Default to Queen.\n   * @param score Optional to pass score to avoid calculating it twice\n   * @return      The new position.\n   */\n  move(move: Move, promo?: Piece, score?: number): Position {\n    const o = move[0]; // origin square\n    const t = move[1]; // target square\n    // it's assumed that there is a piece at the origin position,\n    // toUpperCase() makes it generic because color doesn't matter\n    const op: Piece = (this.board[o]: any);\n    if (!promo) {\n      if (this.turn === WHITE) promo = 'Q'; // default promotion piece\n      else promo = 'q';\n    }\n\n    const board = this.board.slice(); // copy board\n    let wc: CR = (this.wc.slice(): any); // copy castling rights\n    let bc: CR = (this.bc.slice(): any);\n    let ep = -1; // default\n    let kp = -1;\n    // negate score so it's for the other side\n    if (score === undefined) score = -(this.score + this.value(move, promo));\n\n    let halfMoveClock;\n    // will also be reset at pawn take\n    if (board[t]) halfMoveClock = 0;\n    else halfMoveClock = this.halfMoveClock + 1;\n\n    // make the move\n    board[t] = board[o];\n    board[o] = null;\n\n    // castle\n    if (op === 'K') {\n      wc = [false, false];\n      if (Math.abs(t - o) === 2) {\n        kp = (o + t) / 2;\n        board[kp] = 'R';\n        board[t < o ? A1 : H1] = null;\n      }\n    } else if (op === 'k') {\n      bc = [false, false];\n      if (Math.abs(t - o) === 2) {\n        kp = (o + t) / 2;\n        board[kp] = 'r';\n        board[t < o ? A8 : H8] = null;\n      }\n    } else {\n      // set castling rights\n      const helper = (p) => {\n        switch (p) {\n          case A1: wc[0] = false; break;\n          case H1: wc[1] = false; break;\n          case A8: bc[0] = false; break;\n          case H8: bc[1] = false; break;\n          default: break;\n        }\n      }\n      helper(o);\n      helper(t);\n\n      // double move, en passant and pawn promotion\n      if (op === 'P') { // white\n        halfMoveClock = 0;\n\n        if (t - o === -16) ep = (t + o) / 2;\n        else if (t === this.ep) board[t + 8] = null;\n        else if (t <= H8) board[t] = (promo: any); // assume it's defined\n      } else if (op === 'p') { // black\n        halfMoveClock = 0;\n\n        if (t - o === 16) ep = (t + o) / 2;\n        else if (t === this.ep) board[t - 8] = null;\n        else if (t >= A1) board[t] = (promo: any);\n      }\n    }\n\n    const newHashes = this.hashMove(move, promo)\n\n    const ret = new Position(board, next(this.turn), wc, bc, ep, kp,\n      halfMoveClock, score, newHashes[0], newHashes[1]);\n    ret.prev = this;\n    return ret;\n  }\n\n  /**\n   * Returns the value (change of position score) of a move. Assumes it's valid.\n   */\n  value(move: Move, promo?: Piece): number {\n    const o = move[0];\n    const t = move[1];\n    const op: Piece = (this.board[o]: any);\n    let tp: Piece = (this.board[t]: any);\n\n    // invalid castling detection, returns MAX_SAFE_INTEGER if last move's\n    // castle was invalid (if king is threatened on any of the squares\n    // it moves over)\n    if (this.kp !== -1 && Math.abs(t - this.kp) < 2) return 30000;\n\n    let score = pst[op][t] - pst[op][o];\n    // capture\n    if (tp) score += pst[tp][t];\n\n    // castling\n    if (op === 'K' && Math.abs(t - o) === 2) {\n      score += pst['R'][(t + o) / 2];\n      score -= t < o ? pst['R'][A1] : pst['R'][H1];\n    } else if (op === 'k' && Math.abs(t - o) === 2) {\n      score += pst['r'][(t + o) / 2];\n      score -= t < o ? pst['r'][A8] : pst['r'][H8];\n    }\n\n    // pawn stuff\n    if (op === 'P') {\n      if (t <= H8) score += pst[promo || 'Q'][t] - pst[op][t];\n      else if (t === this.ep) {\n        tp = (this.board[t + 8]: any);\n        score += pst[tp][t + 8];\n      }\n    } else if (op === 'p') {\n      if (t >= A1) score += pst[promo || 'q'][t] - pst[op][t];\n      else if (t === this.ep) {\n        tp = (this.board[t - 8]: any);\n        score += pst[tp][t - 8];\n      }\n    }\n    return score;\n  }\n\n  /** Returns the resulting hashes ([posHash, boardHash]) from a move\n      (position hash and board hash). Assumes it's a valid move. */\n  hashMove(move: Move, promo?: Piece): [Hash, Hash] {\n    const o = move[0];\n    const t = move[1];\n    const op: Piece = (this.board[o]: any);\n    let tp = this.board[t];\n\n    const newHash: Hash = (this.hash.slice(): any); // copy\n    const newBoardHash: Hash = (this.boardHash.slice(): any);\n\n    const applyHash = (hashParam: Hash) => {\n      newHash[0] ^= hashParam[0];\n      newHash[1] ^= hashParam[1];\n    }\n    const applyBoardHash = (hashParam: Hash) => {\n      newBoardHash[0] ^= hashParam[0];\n      newBoardHash[1] ^= hashParam[1];\n    }\n\n    // switch turn\n    applyHash(hashes.turn);\n\n    // if this position has an en passant or king passant, unhash it\n    if (this.ep !== -1) applyHash(hashes.epFile[this.ep % 8]);\n    if (this.kp !== -1) applyHash(hashes.kp[this.kp]);\n\n    applyHash(hashes[op][o]);\n    applyHash(hashes[op][t]);\n    applyBoardHash(hashes[op][o]);\n    applyBoardHash(hashes[op][t]);\n    if (tp) {\n      applyHash(hashes[tp][t]);\n      applyBoardHash(hashes[tp][t]);\n    }\n\n    // castling\n    if (op === 'K' && Math.abs(t - o) === 2) {\n      const kp = (t + o) / 2;\n      applyHash(hashes.wc[0]);\n      applyHash(hashes.wc[1]);\n      applyHash(hashes.kp[kp]);\n\n      applyHash(hashes['R'][kp]);\n      applyBoardHash(hashes['R'][kp]);\n      if (t < o) {\n        applyHash(hashes['R'][A1]);\n        applyBoardHash(hashes['R'][A1]);\n      } else {\n        applyHash(hashes['R'][H1]);\n        applyBoardHash(hashes['R'][H1]);\n      }\n    } else if (op === 'k' && Math.abs(t - o) === 2) {\n      const kp = (t + o) / 2;\n      applyHash(hashes.bc[0]);\n      applyHash(hashes.bc[1]);\n      applyHash(hashes.kp[kp]);\n\n      applyHash(hashes['r'][kp]);\n      applyBoardHash(hashes['r'][kp]);\n      if (t < o) {\n        applyHash(hashes['r'][A8]);\n        applyBoardHash(hashes['r'][A8]);\n      } else {\n        applyHash(hashes['r'][H8]);\n        applyBoardHash(hashes['r'][H8]);\n      }\n    } else {\n      const helper = (p) => {\n        switch (p) {\n          case A1: if (this.wc[0]) applyHash(hashes.wc[0]); break;\n          case H1: if (this.wc[1]) applyHash(hashes.wc[1]); break;\n          case A8: if (this.bc[0]) applyHash(hashes.bc[0]); break;\n          case H8: if (this.bc[1]) applyHash(hashes.bc[1]); break;\n          default: break;\n        }\n      }\n      helper(o);\n      helper(t);\n\n      // pawn stuff\n      if (op === 'P') {\n        // hash en passant\n        if (t - o === -16) applyHash(hashes.epFile[((t + o) / 2) % 8]);\n        else if (t === this.ep) {\n          tp = (this.board[t + 8]: any);\n          applyHash(hashes[tp][t + 8]);\n          applyBoardHash(hashes[tp][t + 8]);\n        } else if (t <= H8) {\n          applyHash(hashes[op][t]);\n          applyHash(hashes[promo || 'Q'][t]);\n          applyBoardHash(hashes[op][t]);\n          applyBoardHash(hashes[promo || 'Q'][t]);\n        }\n      } else if (op === 'p') {\n        if (t - o === 16) applyHash(hashes.epFile[((t + o) / 2) % 8]);\n        else if (t === this.ep) {\n          tp = (this.board[t - 8]: any);\n          applyHash(hashes[tp][t - 8]);\n          applyBoardHash(hashes[tp][t - 8]);\n        } else if (t >= A1) {\n          applyHash(hashes[op][t]);\n          applyHash(hashes[promo || 'q'][t]);\n          applyBoardHash(hashes[op][t]);\n          applyBoardHash(hashes[promo || 'q'][t]);\n        }\n      }\n    }\n    return [newHash, newBoardHash];\n  }\n\n  hashNullMove(): Hash {\n    const newHash: Hash = (this.hash.slice(): any); // copy old hash\n    const applyHash = (hashParam: Hash) => {\n      newHash[0] ^= hashParam[0];\n      newHash[1] ^= hashParam[1];\n    }\n\n    // if this position has an en passant or king passant, unhash it\n    if (this.ep !== -1) applyHash(hashes.epFile[this.ep % 8]);\n    if (this.kp !== -1) applyHash(hashes.kp[this.kp]);\n\n    applyHash(hashes.turn);\n\n    return newHash;\n  }\n\n  hashBoard(): Hash {\n    const hash: Hash = [0, 0];\n\n    for (let i = 0; i < 64; i++) {\n      const p = this.board[i];\n      if (p) {\n        // apply hash\n        hash[0] ^= hashes[p][i][0];\n        hash[1] ^= hashes[p][i][1];\n      }\n    }\n    return hash;\n  }\n\n  /**\n   * Checks if a move is valid.\n   */\n  valid(move: Move): boolean {\n    const moves = this.genMoves(); // generator\n    let el = moves.next();\n    while (!el.done) {\n      if (move[0] === el.value[0] && move[1] === el.value[1]) {\n        const nextPos = this.move(move);\n        const nextMoves = nextPos.genMoves();\n        let nextEl = nextMoves.next();\n        while (!nextEl.done) {\n          // check if the move was an invalid castle\n          if (nextPos.kp !== -1 && Math.abs(nextEl.value[1] - nextPos.kp) < 2) {\n            return false;\n          }\n          // check if the move results in king being taken\n          const tp = nextPos.board[nextEl.value[1]];\n          if (tp !== null && 'Kk'.includes(tp)) return false;\n          nextEl = nextMoves.next();\n        }\n        // if it passed all the tests, return true\n        return true;\n      }\n      el = moves.next();\n    }\n    return false;\n  }\n\n  /** Returns true if color is in check. If square is provided,\n      checks if that square is threatened. */\n  inCheck(color: Color = this.turn): boolean {\n    let mySteps; // steps for different pieces\n    let pawnSteps;\n    let pawn;\n    let kingSquare;\n    if (color === WHITE) {\n      // square position of king\n      kingSquare = this.board.indexOf('K');\n\n      mySteps = {\n        'bq': steps.B,\n        'rq': steps.R,\n        'n': steps.N,\n      };\n      pawn = 'p';\n      pawnSteps = [S + W, S + E];\n    } else {\n      kingSquare = this.board.indexOf('k');\n\n      mySteps = {\n        'BQ': steps.B,\n        'RQ': steps.R,\n        'N': steps.N,\n      }\n      pawn = 'P';\n      pawnSteps = [N + W, N + E];\n    }\n\n    // search all steps for all pieces\n    for (const key in mySteps) {\n      for (let i = 0; i < mySteps[key].length; i++) {\n        let t = kingSquare + mySteps[key][i];\n        while (t >= 0 && t <= 63 && colDif(t, t - mySteps[key][i]) < 6) {\n          if (this.board[t]) {\n            if (key.includes(this.board[t])) return true;\n            // pawns get special treatment\n            if (this.board[t] === pawn &&\n              (kingSquare === t + pawnSteps[0] ||\n              kingSquare === t + pawnSteps[1])) {\n              return true;\n            }\n            break;\n          }\n\n          if ('Nn'.includes(key)) break;\n          t += mySteps[key][i];\n        }\n      }\n    }\n    return false;\n  }\n\n  // Get fen of the position (fullMove set to 1)\n  toString() {\n    let fen = '';\n    let spaces = 0;\n    for (let i = 0; i < 64; i++) {\n      if (this.board[i] === null) spaces++;\n      else {\n        if (spaces > 0) {\n          fen += spaces;\n          spaces = 0;\n        }\n        fen += this.board[i];\n      }\n      if (i % 8 === 7) {\n        if (spaces > 0) {\n          fen += spaces;\n          spaces = 0;\n        }\n        if (i < 63) fen += '/';\n      }\n    }\n\n    fen += ' ';\n    if (this.turn === WHITE) fen += 'w';\n    else fen += 'b';\n\n    fen += ' ';\n    if (!this.wc[0] && !this.wc[1] && !this.bc[0] && !this.bc[1]) fen += '-';\n    else {\n      if (this.wc[1]) fen += 'K';\n      if (this.wc[0]) fen += 'Q';\n      if (this.bc[1]) fen += 'k';\n      if (this.bc[0]) fen += 'q';\n    }\n\n    fen += ' ';\n    if (this.ep !== -1) fen += squareToString(this.ep);\n    else fen += '-';\n\n    fen += ' ';\n    fen += this.halfMoveClock;\n\n    fen += ' ';\n    fen += 1; // fullMove\n\n    return fen;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/jackfish/Position.js","/**\n * @module AI\n * The \"AI\", or computer mover.\n * @flow\n */\n\nimport Position, { A1, H8 } from './Position';\nimport { Cwf } from './tp'\nimport { PIECE } from './evaluation';\nimport { next } from './helpers';\nimport { PIECES } from './declarations';\n\nimport type { Move, Piece, History, Hash } from './declarations';\n\n// best moves for a position in reverse order\ntype Pv = [Move, Piece | void] | void;\n\n// Constants and types.\n\n// If value of position is > this, it means previous move was invalid\nconst MAX_SCORE = 15 * PIECE.Q; // with margin\n// How much to move alpha and beta in the mtd(f) until we have failed\n// both high and low\nconst SEARCH_MARGIN = 50;\n\n// fail low, high, hit exact (between alpha and beta) or invalid position\nconst L = 'L';\nconst E = 'E';\nconst H = 'H';\n\ntype Entry = {\n  pv: Pv, // moves previously beat alpha, from worst to best\n  score: number,\n  depth: number,\n  fail: 'L' | 'E' | 'H'\n};\n\nconst tp: Cwf<Entry> = new Cwf(1e7);\nconst boardTable: any = new Cwf(1e3); // table to find repeated positions\n\n// add methods to boardTable\nboardTable.push = function(hash: Hash) {\n  let count = this.get(hash); // if this position has been visited before\n  if (count !== undefined) this.add(hash, count + 1);\n  else this.add(hash, 1);\n}\nboardTable.pull = function(hash: Hash) {\n  let count = this.get(hash); // if this position has been visited before\n  if (count !== undefined && count > 0) this.add(hash, count - 1);\n}\n\n/* eslint-disable */\n// Data structure for storing killer moves (not pawn promotions)\nclass Killer {\n  origins: { [number]: { [number]: boolean } } = {};\n  constructor() {\n    return this;\n  }\n\n  add(move: Move) {\n    if (this.origins[move[0]]) this.origins[move[0]][move[1]] = true;\n    else {\n      this.origins[move[0]] = {};\n      this.origins[move[0]][move[1]] = true;\n    }\n  }\n\n  forEach(pos, callBack: (move: Move, tp: ?Piece) => boolean) {\n    for (const o in this.origins) {\n      for (const t in this.origins[o]) {\n        // TODO: Implement pseudo valid method on Position class and use\n        // here, then if it is pseudo-valid, call callback with the move\n      }\n    }\n  }\n}\n/* eslint-enable */\n\n// Logs\nlet tpHits = 0;\nlet searched = 0; // how many positions searched\n\nlet timeLimit;\nlet gotMove = false; // must have failed high or exact once to get a move\nconst timeout = () => Date.now() > timeLimit && gotMove;\n\n// Helper functions\n\n// Calls a callback function for all moves (as arguments) generated by genMoves,\n// including all 4 promotion moves for promotions. Runs through pv moves first.\n// if callback returns true, breaks. Returns true if there were any moves\n// generated, else false.\nfunction forMoves(pos: Position, pv: Pv,\n  callback: (move: Move, promo?: Piece, tp: ?Piece) => boolean): void {\n  if (pv) {\n    const move = pv[0];\n    let tp;\n    if (move[1] === pos.ep) {\n      if (pos.board[move[0]] === 'P') tp = pos.board[pos.ep + 8];\n      else if (pos.board[move[0]] === 'p') tp = pos.board[pos.ep - 8];\n      else tp = pos.board[move[1]];\n    } else tp = pos.board[move[1]];\n\n    if (callback(pv[0], pv[1], tp)) return; // move, promo\n  }\n\n  const moves = pos.genMoves();\n  let el = moves.next();\n  if (el.done) return; // if there are no valid moves\n\n  while (!el.done) {\n    const move = el.value;\n    let tp;\n    if (move[1] === pos.ep) {\n      if (pos.board[move[0]] === 'P') tp = pos.board[pos.ep + 8];\n      else tp = pos.board[pos.ep - 8];\n    } else tp = pos.board[move[1]];\n\n    if (pos.board[move[0]] === 'P' && move[1] <= H8) {\n      const promos = 'QNRB';\n      for (let i = 0; i < promos.length; i++) {\n        if (callback(move, (promos.charAt(i): any), tp)) return;\n      }\n    } else if (pos.board[move[0]] === 'p' && move[1] >= A1) {\n      const promos = 'qnrb';\n      for (let i = 0; i < promos.length; i++) {\n        if (callback(move, (promos.charAt(i): any), tp)) return;\n      }\n    } else if (callback(move, undefined, tp)) return;\n    el = moves.next();\n  }\n}\n\n// Check if a positino is stalemate. Assumes nobody is in check.\n// Promotion piece doesn't matter.\nfunction inStalemate(pos: Position) {\n  const moves = pos.genMoves();\n  let el = moves.next();\n  while (!el.done) {\n    // don't try castling, if the castle is valid, there is also a valid\n    // king move that don't gets you in check\n    // $FlowFixMe\n    if ('Kk'.includes(pos.board[el.value[0]]) && Math.abs(el.value[1] - el.value[0]) === 2) {\n      el = moves.next();\n      continue;\n    }\n\n    // if a move didn't get your king killed\n    if (!pos.move(el.value).inCheck(pos.turn)) {\n      return false; // not stalemate\n    }\n    el = moves.next();\n  }\n  return true; // stalemate\n}\n\nexport function getPieces(pos: Position) {\n  const pieces: Object = {};\n  PIECES.forEach((e) => { pieces[e] = 0 });\n  for (let i = 0; i < 64; i++) {\n    const p = pos.board[i];\n    if (p) pieces[p]++;\n  }\n  pieces.new = function(takenPiece?: Piece) {\n    const newPieces = Object.assign({}, this);\n    if (takenPiece) newPieces[takenPiece]--;\n    return newPieces;\n  }\n  pieces.endgame = function() {\n    if (this.Q > 0) {\n      if (this.R > 0 || this.B + this.N > 1) return false;\n    }\n    if (this.q > 0) {\n      if (this.r > 0 || this.b + this.n > 1) return false;\n    }\n    return true;\n  }\n  pieces.insufficientMaterial = function() {\n    return this.Q === 0 && this.q === 0 &&\n      this.P === 0 && this.p === 0 &&\n      this.R === 0 && this.r === 0 &&\n      (this.B === 0 || (this.B === 1 && this.N === 0)) &&\n      (this.b === 0 || (this.b === 1 && this.n === 0));\n  }\n\n  return pieces;\n}\n\n// Main algorithm\n\n// generic alpha-beta algorithm, doesn't assume mtd(f) search\nfunction alphaBeta(\n  pos: Position,\n  depth: number,\n  alpha: number,\n  beta: number,\n  pieces: Object,\n  root: boolean = false): number {\n  searched++;\n  if (depth < 0) depth = 0;\n\n  // draw\n  if (pos.halfMoveClock >= 50) {\n    return 0;\n  }\n  if (boardTable.get(pos.boardHash) >= 3) {\n    return 0;\n  }\n\n  let stalemate = true; // true until proven otherwise\n  let pv: Pv; // default\n\n  // look up in tp\n  let entry: any = tp.get(pos.hash); // previous entry\n  if (entry) {\n    pv = entry.pv;\n    if (entry.depth >= depth) {\n      tpHits++;\n      switch (entry.fail) {\n        case L:\n          if (entry.score <= alpha) return alpha;\n          break;\n        case E:\n          return entry.score;\n        case H:\n          if (entry.score >= beta) return beta\n          break;\n        default: break;\n      }\n    }\n  }\n\n  // renew entry, use the previous pv as default\n  entry = (tp.add(pos.hash,\n    { pv: pv, score: alpha, depth: depth, fail: L }): Entry);\n\n  // Determine if we're in endgame.\n  // Endgame begins when any side that has a queen has one other minorpiece maximum.\n  // Disable delta pruning, change king pst and look for stalemates.\n  const endgame: boolean = pieces.endgame();\n  if (endgame && pieces.insufficientMaterial()) {\n    entry.score = 0;\n    entry.fail = E;\n    return 0;\n  }\n\n  // Callback helper\n  const handleMove = (move, promo?, score) => {\n    // if time's out\n    if (timeout()) return true;\n\n    // must be a beta cutoff since it's a null window search\n    if (score > alpha) {\n      entry.fail = H\n      stalemate = false; // my move was valid\n      entry.pv = [move, promo]; // new pv\n\n      if (score >= MAX_SCORE) alpha = MAX_SCORE;\n      else alpha = beta;\n\n      return true;\n    } else if (score > -MAX_SCORE) stalemate = false; // if my move was valid\n    return false;\n  };\n\n  // quiescence search ( 2 * PIECE.P (200 centipawns) is the margin)\n  if (depth <= 0) {\n    // null move beta cutoff\n    if (pos.score >= beta) {\n      // if no moves gets you out of check, this position will fail low\n      if (pos.inCheck()) {\n        stalemate = false;\n\n        // test all moves\n        forMoves(pos, pv, (move, promo, tp) => {\n          // tp here is target piece, not transposition table\n          const nextPos = pos.move(move, promo);\n          // if this move got rid of the check threat (if the move after\n          // can't take king)\n          if (!nextPos.inCheck(pos.turn)) {\n            boardTable.push(nextPos.boardHash);\n            const score = -alphaBeta(nextPos, 0, -beta, -alpha, pieces.new(tp));\n            boardTable.pull(nextPos.boardHash);\n            return handleMove(move, promo, score);\n          } else return false;\n        });\n      } else if (endgame && inStalemate(pos)) {\n        entry.score = 0;\n        entry.fail = E;\n        return 0;\n      } else {\n        entry.score = beta;\n        entry.fail = H;\n        return beta;\n      }\n    } else if (pos.score + PIECE.Q < alpha) {\n      if (pos.inCheck(next(pos.turn))) {\n        entry.fail = H;\n        entry.score = MAX_SCORE;\n        return MAX_SCORE; // king take or invalid castle\n      } else if (endgame && !pos.inCheck() && inStalemate(pos)) {\n        entry.score = 0;\n        entry.fail = E;\n        return 0;\n      }\n      // Might wanna try moves that check here later.\n\n      return alpha; // delta pruning\n    } else {\n      forMoves(pos, pv, (move, promo, tp) => {\n        // check if there was an invalid castle (saves time to do it here)\n        if (pos.kp !== -1 && Math.abs(pos.kp - move[1]) < 2) {\n          alpha = MAX_SCORE;\n          entry.fail = H;\n          return true;\n        }\n\n        // don't test silent moves\n        if (!pos.board[move[1]] && !(move[1] === pos.ep &&\n          'Pp'.includes((pos.board[move[0]]: any)))) return false;\n\n        const nextScore = pos.score + pos.value(move, promo);\n        // check if it's a king-take move, if it is we save a lot of time\n        if (nextScore >= MAX_SCORE) {\n          alpha = MAX_SCORE;\n          entry.fail = H;\n          return true;\n        }\n\n        // delta pruning\n        if ((pos.board[move[1]] || move[1] === pos.ep) && nextScore + 2 * PIECE.P >= alpha) {\n          // passes margin and not silent positon, search deeper\n          const nextPos = pos.move(move, promo, -nextScore);\n          boardTable.push(nextPos.boardHash);\n          const score = -alphaBeta(nextPos, 0, -beta, -alpha, pieces.new(tp));\n          boardTable.pull(nextPos.boardHash);\n          return handleMove(move, promo, score);\n        }\n        return false; // let forMoves() keep running\n      });\n      // if stalemate is still true, we know no valid moves were tested,\n      // but we don't know if there were no valid moves\n      // and therefore we should just return the score of this position\n      if (stalemate && alpha < beta) {\n        entry.fail = E;\n        entry.score = pos.score;\n        return pos.score;\n      }\n    }\n  } else {\n    // depth >= 1\n\n    // futiity pruning (use when searching deeper, not yet, need\n    // to watch out for king-take moves)\n    if (!root && depth === 1 && pos.score + PIECE.Q < alpha) {\n      if (pos.inCheck(next(pos.turn))) {\n        entry.score = MAX_SCORE;\n        entry.fail = H\n        return MAX_SCORE; // if you can take king\n      } else if (endgame && inStalemate(pos)) {\n        entry.score = 0;\n        entry.fail = E;\n        return 0;\n      }\n      return alpha;\n    }\n\n    // don't do nullmove at root or in endgame\n    // if in check, will not fail high\n    let score;\n    if (!root && !endgame) {\n      score = -alphaBeta(pos.nullMove(), depth - 3, -beta, -alpha, pieces.new());\n      if (score >= beta) {\n        entry.score = beta;\n        entry.fail = H;\n        return beta;\n      }\n    }\n\n    forMoves(pos, pv, (move, promo) => {\n      const nextScore = pos.score + pos.value(move, promo);\n      // check if it's a king-take move or if the previous move was an invalid\n      // castle, if it is we save a lot of time\n      if (nextScore >= MAX_SCORE) {\n        alpha = MAX_SCORE;\n        entry.fail = H;\n        return true;\n      }\n\n      if (depth === 1 && nextScore + 2 * PIECE.P < alpha) return false;\n\n      const nextPos = pos.move(move, promo, -nextScore);\n      boardTable.push(nextPos.boardHash);\n      const score = -alphaBeta(nextPos, depth - 1, -beta, -alpha, pieces.new());\n      boardTable.pull(nextPos.boardHash);\n      return handleMove(move, promo, score);\n    });\n  }\n\n  if (stalemate && endgame) {\n    if (!pos.inCheck() && inStalemate(pos)) {\n      entry.score = 0;\n      entry.fail = E;\n      return 0;\n    }\n  }\n\n  // could only have gotten a better score, we got interrupted\n  if (timeout()) {\n    entry.fail = H;\n  }\n\n  // alpha should have been changed to beta on beta cutoff\n  entry.score = alpha;\n  return alpha;\n}\n\n// return bound in case of timeout\nfunction mtdf(pos: Position, depth: number, guess: number): [number, number] {\n  const bound = { lower: -MAX_SCORE, upper: MAX_SCORE };\n  let f = guess;\n  let beta = f - 2 * SEARCH_MARGIN; // start lower to fail high earlier\n\n  const pieces = getPieces(pos);\n\n  do {\n    // find a window of size margin, then do a binary search in it\n    if (bound.lower !== -MAX_SCORE && bound.upper !== MAX_SCORE) {\n      if (bound.upper - bound.lower > 3) beta = Math.floor((bound.lower + bound.upper) / 2);\n      else beta = f + (f === bound.lower ? 1 : 0);\n    } else if (f === bound.lower) beta = f + SEARCH_MARGIN;\n    else if (f === bound.upper) beta = f - SEARCH_MARGIN;\n\n    f = alphaBeta(pos, depth, beta - 1, beta, pieces.new(), true);\n\n    if (f < beta) bound.upper = f;\n    else {\n      bound.lower = f;\n      gotMove = true;\n    }\n  } while (bound.lower <= bound.upper - 1 && !timeout()); // - 0.01 for floating point inaccuracy\n\n  return [bound.lower, bound.upper];\n}\n\n// Assumes there are valid moves.\n// @param time How many milliseconds to think. Min: 1000 Max. 60000\n// @returns [move, promo, stopReason]\nexport default async function move(pos: Position,\n  history: History,\n  time: number = 5000,\n  maxDepth: number = 100,\n  logs: Object,\n  betweenDepths?: () => Promise<any>): Promise<[Move, Piece | void, 'time' | 'depth']> {\n  let score = pos.score;\n  let bound;\n  let entry: any;\n\n  if (maxDepth < 1) maxDepth = 1;\n\n  // set up position table (for three-repeat rule)\n  history.forEach(e => {\n    boardTable.push(new Position(e.fen).boardHash);\n  });\n  boardTable.push(pos.boardHash);\n\n  if (time < 1000) time = 1000;\n  if (time > 60000) time = 60000\n\n  // timeLimit and timeOut() is defined globally higher up\n  timeLimit = Date.now() + time; // run for 5 sec\n\n  // reset logging information\n  logs.searched = 0;\n  logs.tpHits = 0;\n\n  // iterative deepening, start at depth 1\n  let i = 1;\n  while (i <= maxDepth && !timeout()) {\n    logs.depth = i;\n    if (betweenDepths) await betweenDepths();\n\n    // get the tp entry from the previous depth\n    if (i > 1) entry = tp.get(pos.hash);\n    bound = mtdf(pos, i, score);\n    // lower bound and upper bound will always be the same unless interrupted\n    score = bound[0];\n    i++;\n    logs.searched = searched;\n    logs.tpHits = tpHits;\n  }\n  const stopReason = timeout() ? 'time' : 'depth';\n  gotMove = false; // reset this\n  searched = 0;\n  tpHits = 0;\n\n  // compare entry from the latest depth (that got interrupted)\n  // to the entry from the depth before to see which one is best\n  const deepestEntry: any = tp.get(pos.hash); // should always be a hit\n  // if we didn't even finish depth 1, entry won't be defined\n  if (!entry ||\n    ((bound: any)[0] > entry.score) || // means we got a better move\n    ((bound: any)[1] < entry.score) // means the move we have is worse than we thought\n  ) entry = deepestEntry;\n\n  tp.clear();\n  boardTable.clear();\n  const returnVal = entry.pv;\n  returnVal.push(stopReason);\n  return returnVal;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/jackfish/AI.js","/**\n * A javascript chess engine inspired by\n * [sunfish](https://github.com/thomasahle/sunfish) and\n * [chess.js](https://github.com/jhlywa/chess.js).\n * @module jackfish\n * @author Mattias Ahlsén (mattias.ahlsen@gmail.com)\n * @example\n * import Engine from 'jackfish';\n * const game = new Engine();\n *\n * @flow\n */\n\ntype Square = number | string;\n\nimport { PIECES, BLACK, WHITE } from './declarations';\nimport Position from './Position';\nimport { rank, parse, squareToString, equalBoards } from './helpers';\nimport aimove, { getPieces } from './AI';\n\nimport type { Board, Piece, Move, CR, History } from './declarations';\n\n/*\nThe board is represented as an array with indexes like this:\n8 |  0  1  2  3  4  5  6  7\n7 |  8  9  10 11 12 13 14 15\n6 |  16 17 18 19 20 21 22 23\n5 |  24 25 26 27 28 29 30 31\n4 |  32 33 34 35 36 37 38 39\n3 |  40 41 42 43 44 45 46 47\n2 |  48 49 50 51 52 53 54 55\n1 |  56 57 58 59 60 61 62 63\n  |_________________________\n     A  B  C  D  E  F  G  H\n\nPieces are represented as characters with uppercase letters for white pieces\nand lowercase for black pieces, as in FEN notation:\nPawn: 'P' and 'p'\nKnight: 'N' and 'n'\nBishop: 'B' and 'b'\nRook: 'R' and 'r'\nQueen: 'Q' and 'q'\nKing: 'K' and 'k'\n*/\n\n/**\n * Configuration object for the engine.\n * @name Options\n * @property {string?}   startPos     The FEN string of the starting position.\n * @property {Function?} betweenDepth Async function that returns a promise,\n *                                    that runs between every depth of the AI\n *                                    searches.\n * @property {number} searchTime      Time for the AI to search in seconds.\n * @example\n * const options = {\n *   startPos: 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1',\n     betweenDepths: ''\n * }\n */\nexport type Options = {\n  startPos?: string,\n  searchTime?: number,\n  betweenDepths?: () => Promise<any>,\n};\n\ntype Config = {\n  startPos: string,\n  searchTime: number,\n  betweenDepths?: () => Promise<any>,\n};\n\nconst defaultConfig: Config = {\n  startPos: 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1',\n  searchTime: 4,\n};\n\n/**\n * The chess engine, including game mechanics and\n * a configurable AI. (default export)\n * @example const game = new Engine();\n * @param options Configuration object.\n * @param {string}\n * [options.startPos='rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1']\n * @param {number}\n * [options.searchTime=4]\n * See {@link Options}.\n *\n * @return {Engine}\n */\nexport default class Engine {\n  config: Config = defaultConfig;\n  history: History = [];\n  position: Position;\n  fullMove: number;\n\n  aiInfo: {\n    depth: number,\n    searched: number,\n    tpHits: number,\n  } = ({\n    depth: 0,\n    searched: 0,\n    tpHits: 0,\n  }: any);\n\n  betweenDepths: () => Promise<any>;\n\n  constructor(options?: Options) {\n    if (options) this.configure(options);\n    this.setPos(this.config.startPos);\n  }\n\n  /**\n   * Configurate the engine (only changes passed properties).\n   * @example\n   * // set starting position to standard\n   * game.configure({ startPos: 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1' });\n   * @param options   Same type of configuration object passed to\n   *                  constructor.\n   */\n  configure(options: Options): void {\n    for (const key in options) {\n      this.config[key] = options[key];\n    }\n  }\n\n  /**\n   * Get the current configuration, including all default values.\n   * @return The configuration object.\n   */\n  getConfig(): Config {\n    return this.config;\n  }\n\n  /**\n   * Changes to the new position and clears history array.\n   * @param fen The FEN string of the position to be set.\n   * @return True if the FEN string was valid enough and the position was\n   *         successfully changed.\n   */\n  setPos(fen: string): boolean {\n    const board: Board = [];\n    let turn;\n    let wc: CR = [false, false];\n    let bc: CR = [false, false];\n    let ep = -1; // default is none\n    let kp = -1;\n    let halfMoveClock;\n    let fullMove;\n\n    const subs = fen.trim().split(/ +/); // get substrings\n    if (subs.length !== 6) return false;\n\n    let pos = 0; // current board position (square)\n    let i = 0; // index of string\n    // The board array is indexed the same way as FEN notation.\n    while (i < subs[0].length) {\n      let c = subs[0].charAt(i); // currently parsed char\n      const num = parseInt(c);\n      if (Number.isInteger(num) && num > 0) {\n        if (num > 8 - pos % 8) return false;\n        for (let j = 0; j < num; j++) {\n          board[pos + j] = null;\n        }\n        pos += num;\n      } else if (PIECES.includes(c)) {\n        // Cast to piece when we know it is one.\n        c = ((c: any): Piece)\n        board[pos] = c;\n        pos++;\n      } else {\n        return false; // invalid FEN\n      }\n      i++;\n      if (pos >= 64) break; // should not be able to be bigger than 64\n      else if (pos % 8 === 0) {\n        if (subs[0].charAt(i) !== '/') return false;\n        i++;\n      }\n    }\n    if (fen.charAt(i) !== ' ') return false;\n\n    switch (subs[1]) {\n      case 'w': turn = WHITE; break;\n      case 'b': turn = BLACK; break;\n      default: return false;\n    }\n\n    if (subs[2] !== '-') {\n      if (subs[2].length > 4) return false;\n      const used = [];\n      for (let i = 0; i < subs[2].length; i++) {\n        const c = subs[2].charAt(i);\n        if (used.includes(c)) return false; // may only occur once\n        switch (c) {\n          case 'Q': wc[0] = true; break;\n          case 'K': wc[1] = true; break;\n          case 'q': bc[1] = true; break;\n          case 'k': bc[0] = true; break;\n          default: return false;\n        }\n        used.push(c);\n      }\n    }\n\n    if (subs[3] !== '-') {\n      ep = parse(subs[3]);\n      const r = rank(ep);\n      if (isNaN(ep)) return false;\n      if (r !== 3 && r !== 6) return false;\n    }\n\n    halfMoveClock = parseInt(subs[4]);\n    fullMove = parseInt(subs[5]);\n    if (!(Number.isInteger(halfMoveClock) && halfMoveClock >= 0)) return false;\n    if (!(Number.isInteger(fullMove) && fullMove > 0)) return false;\n\n    // if we've made it this far, we're golden\n    this.fullMove = fullMove;\n    this.position = new Position(board, turn, wc, bc, ep, kp, halfMoveClock);\n    this.history = [];\n    return true;\n  }\n\n  validFen(fen: string) {\n    const dummy = new this.constructor();\n    return dummy.setPos(fen);\n  }\n\n  /**\n   * Returns the FEN representation of the game.\n   * @return The FEN string.\n   */\n  fen(): string {\n    const pos = this.position;\n    const board = pos.board;\n    let fen = '';\n    let spaces = 0;\n    for (let i = 0; i < 64; i++) {\n      if (board[i] === null) spaces++;\n      else {\n        if (spaces > 0) {\n          fen += spaces;\n          spaces = 0;\n        }\n        fen += board[i];\n      }\n      if (i % 8 === 7) {\n        if (spaces > 0) {\n          fen += spaces;\n          spaces = 0;\n        }\n        if (i < 63) fen += '/';\n      }\n    }\n\n    fen += ' ';\n    if (pos.turn === WHITE) fen += 'w';\n    else fen += 'b';\n\n    fen += ' ';\n    if (!pos.wc[0] && !pos.wc[1] && !pos.bc[0] && !pos.bc[1]) fen += '-';\n    else {\n      if (pos.wc[1]) fen += 'K';\n      if (pos.wc[0]) fen += 'Q';\n      if (pos.bc[1]) fen += 'k';\n      if (pos.bc[0]) fen += 'q';\n    }\n\n    fen += ' ';\n    if (pos.ep !== -1) fen += squareToString(pos.ep);\n    else fen += '-';\n\n    fen += ' ';\n    fen += pos.halfMoveClock;\n\n    fen += ' ';\n    fen += this.fullMove;\n\n    return fen;\n  }\n\n  /**\n   * Moves from position o to position t, making sure it's a valid move.\n   * Positions can be on the form 0 for A8, 7 for H8, ..., 56 for A1,\n   * 63 for H1, or simply on the form 'a1', 'b7', etc...\n   * @param o Origin position.\n   * @param t Target position.\n   * @return True if it was a valid move.\n   */\n  move(o: Square, t: Square, promo?: Piece): boolean {\n    // parse() returns NaN for invalid position strings\n    o = (parse(o): number);\n    t = (parse(t): number);\n\n    // check that promotion piece is valid if there is one\n    if (promo) {\n      if (this.position.turn === WHITE) {\n        if (!'QNRB'.includes(promo)) return false;\n      } else if (!'qnrb'.includes(promo)) return false;\n    }\n\n    if (this.valid(o, t)) {\n      this.history.push({fen: this.fen(), move: [o, t]});\n      this.position = this.position.move([o, t], promo);\n      if (this.position.turn === WHITE) this.fullMove += 1;\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Undoes the latest move if there is one.\n   * @return The move that was undone on the form [origin, target] or null if\n   * there were no previous moves.\n   */\n  undoMove(): Move | null {\n    const history = this.history; // save this, setPos() clears it\n    const last = history.pop();\n    if (last) {\n      this.setPos(last.fen);\n      this.history = history; // need to set this because setPos() clears it\n      return last.move;\n    }\n    return null;\n  }\n\n  /**\n   * Get winner if there is one.\n   */\n  winner(): 'white' | 'black' | 'draw' | null {\n    if (this.inCheckMate()) {\n      if (this.position.turn === WHITE) return 'black';\n      else return 'white';\n    }\n\n    if (this.fiftyMoves() || this.inThreefoldRepetition() ||\n      this.inStaleMate() || this.insuffMaterial()) return 'draw'\n\n    return null;\n  }\n\n  insuffMaterial() {\n    return getPieces(this.position).insufficientMaterial();\n  }\n\n  /** Returns true if in draw according to fifty move rule. */\n  fiftyMoves(): boolean {\n    return this.position.halfMoveClock >= 50;\n  }\n\n  /** Returns true if the current board position has ocurred 3 or more times. */\n  inThreefoldRepetition(): boolean {\n    let count = 1; // starts at 1 because current position is 1 occurence\n    for (let i = 0; i < this.history.length; i++) {\n      const game = new Engine();\n      game.setPos(this.history[i].fen);\n      if (equalBoards(game.position.board, this.position.board)) {\n        count++;\n        if (count === 3) return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Check if side to move is in checkmate.\n   */\n  inCheckMate(): boolean {\n    return this.moves().length === 0 && this.position.inCheck();\n  }\n\n  /**\n   * Check if in stalemate.\n   */\n  inStaleMate(): boolean {\n    return this.moves().length === 0 && !this.position.inCheck();\n  }\n\n  /** Returns an array of valid moves. Only returns one move for promotions. */\n  moves(): Array<Move> {\n    const moves = [];\n    const generator = this.position.genMoves(); // move generator\n    let el = generator.next();\n    while (!el.done) {\n      if (this.position.valid(el.value)) moves.push(el.value);\n      el = generator.next();\n    }\n    return moves;\n  }\n\n  /**\n   * Returns true if a move is valid.\n   */\n  valid(o: Square, t: Square): boolean {\n    o = parse(o);\n    t = parse(t);\n\n    return this.position.valid([o, t]);\n  }\n\n  /**\n   * Sets position to the starting position set in config.startingPos (default\n   * is normal starting position).\n   */\n  restart(): void {\n    this.setPos(this.config.startPos);\n  }\n\n  /**\n   * Let the AI make a move. If there are no valid moves, return null.\n   * @param [time=5000] Time to think in milliseconds. Min-value: 1000.\n   * @return The move that was made.\n   */\n  async aiMove(maxDepth?: number): Promise<[Move, Piece | void] | void> {\n    // This implies that there are valid moves to be made.\n    if (this.winner() !== null) return;\n\n    const move = await aimove(this.position, this.history,\n      this.config.searchTime * 1000, maxDepth, this.aiInfo, this.config.betweenDepths);\n    if (move) {\n      this.move(move[0][0], move[0][1], move[1]);\n\n      return move;\n    } else throw new Error('The AI failed to make a move');\n  }\n\n  /**\n   * Returns whose turn it is.\n   * @return turn\n   */\n  turn(): 'white' | 'black' {\n    if (this.position.turn === WHITE) return 'white';\n    else return 'black';\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/jackfish/index.js","<template>\n  <div>\n    <h1>Jackfish</h1>\n    <h2>A chess engine in javascript.</h2>\n    <div class=\"game-status\">\n      <h3 v-if=\"winner === 'white'\">The winner is\n        <span class=\"white\">white</span></h3>\n      <h3 v-else-if=\"winner === 'black'\">The winner is\n        <span class=\"black\">black</span></h3>\n      <h3 v-else-if=\"winner === 'draw'\">It's a draw</h3>\n      <h3 v-else :style=\"{ visibility: 'hidden' }\">\n        Game is still running.\n      </h3>\n\n      <button type=\"button\" class=\"btn btn-light\" @click=\"undoMove\">\n        Undo move\n      </button>\n      <button type=\"button\" class=\"btn btn-light\" @click=\"restart\">\n        Restart\n      </button>\n\n      <div class=\"mt-3\">\n        <h6>AI search time (s)</h6>\n        <div class=\"mb-2\"><input v-model=\"game.config.searchTime\"></div>\n        <button type=\"button\" class=\"btn btn-outline-success\" @click=\"setTime(2)\">Easy</button>\n        <button type=\"button\" class=\"btn btn-outline-warning\" @click=\"setTime(4)\">Medium</button>\n        <button type=\"button\" class=\"btn btn-outline-danger\"  @click=\"setTime(6)\">Hard</button>\n      </div>\n\n      <div class=\"mt-3\">\n        <h6>Fen of starting position.</h6>\n        <div><input v-model=\"startPos\" class=\"fen\"></div>\n        <button class=\"btn btn-dark\" @click=\"setStartPos\">Set position</button>\n        <button class=\"btn btn-dark\" @click=\"resetStartPos\">Reset</button>\n        <p v-if=\"invalidStartPos\" class=\"text-danger\">Invalid FEN string</p>\n      </div>\n\n      <div class=\"mt-3\">\n        <h6>\n          <a href=\"https://en.wikipedia.org/wiki/Forsyth%E2%80%93Edwards_Notation\">\n            FEN\n          </a> of board\n        </h6>\n        <div><input v-model=\"fen\" class=\"fen\"></div>\n        <button class=\"btn btn-dark\" @click=\"setPos\">Set position</button>\n        <p v-if=\"invalidFen\" class=\"text-danger\">Invalid FEN string</p>\n      </div>\n\n      <div class=\"mt-3\">\n        <p><strong>Depth:</strong> {{aiInfo.depth}}</p>\n        <p><strong>Nodes searched:</strong> {{aiInfo.searched}}</p>\n        <p><strong>Hits in transposition table:</strong> {{aiInfo.tpHits}}</p>\n      </div>\n    </div>\n\n    <Promotion v-if=\"promotion\" :pos=\"promotion.pos\" :board=\"$refs.board\"\n      :color=\"promotion.color\" @done=\"handlePromotion\">\n    </Promotion>\n    <div id=\"board\" ref=\"board\" @click=\"cancel\">\n    </div>\n\n    <div class=\"links\">\n      <h3>About</h3>\n      <p>\n        This is a chess engine I've built in javascript. The \"AI\" uses\n        <a href=\"https://chessprogramming.wikispaces.com/MTD%28f%29\">mtd(f)</a>.\n        All rules apply: insufficient material, fifty-move rule, threefold\n        repetition etc, and the AI recognizes all these as draws and evaluates\n        them accordingly. See more below.\n      </p>\n      <a class=\"btn btn-primary btn-lg\" href=\"https://github.com/mattiasahlsen/jackfish/\" role=\"button\">\n        Github repo\n      </a>\n    </div>\n\n    <div class=\"about mt-4 mb-4\">\n      <h4 class=\"mt-3\">Features</h4>\n      <ul class=\"list-group\">\n        <li class=\"list-group-item\">\n          <a href=\"https://chessprogramming.wikispaces.com/Simplified+evaluation+function\">\n            Piece-square table evaluation\n          </a>\n        </li>\n        <li class=\"list-group-item\">\n          <a href=\"https://chessprogramming.wikispaces.com/MTD%28f%29\">\n            MTD(f)\n          </a>\n        </li>\n        <li class=\"list-group-item\">\n          <a href=\"https://chessprogramming.wikispaces.com/Alpha-Beta\">\n            Alpha-beta\n          </a>\n        </li>\n        <li class=\"list-group-item\">\n          <a href=\"https://chessprogramming.wikispaces.com/Iterative+Deepening\">\n            Iterative deepening\n          </a>\n        </li>\n        <li class=\"list-group-item\">\n          <a href=\"https://chessprogramming.wikispaces.com/Transposition%20Table#KeyCollisions\">\n            Transposition table\n          </a>\n        </li>\n        <li class=\"list-group-item\">\n          <a href=\"https://chessprogramming.wikispaces.com/Quiescence+Search\">\n            Quiescence search\n          </a>\n        <li class=\"list-group-item\">\n          <a href=\"https://chessprogramming.wikispaces.com/delta+pruning\">\n            Delta pruning\n          </a>\n        </li>\n      </ul>\n\n      <h4 class=\"mt-3\">To be implemented</h4>\n      <ul class=\"list-group\">\n        <li class=\"list-group-item\">\n          <a href=\"https://chessprogramming.wikispaces.com/Killer+Move\">\n            Killer heuristic\n          </a>\n        </li>\n        <li class=\"list-group-item\">\n          <a href=\"https://chessprogramming.wikispaces.com/Pawn%20Structure\">\n            Pawn structure evaluation\n          </a>\n        </li>\n      </ul>\n\n      <h4 class=\"mt-3\">Credits to</h4>\n      <a href=\"https://chessprogramming.wikispaces.com/\">https://chessprogramming.wikispaces.com/</a>\n      <br>\n      <a href=\"https://github.com/thomasahle/sunfish\">https://github.com/thomasahle/sunfish</a>\n    </div>\n    <p class=\"created-by\">Created by Mattias Ahlsén</p>\n  </div>\n</template>\n\n<script>\nimport Promotion from './Promotion';\n\n// Images for the chess board are copied to /static/img\nimport Chessboard from 'chessboardjs';\nimport 'chessboardjs/www/css/chessboard.css';\n\nimport Engine from '@/jackfish';\nimport { WHITE, BLACK } from '@/jackfish/declarations';\nimport { rank, parse } from '@/jackfish/helpers';\n\nconst game = new Engine();\n\nexport default {\n  name: 'Home',\n  components: {\n    Promotion,\n  },\n\n  data () {\n    return {\n      game: game,\n      promotion: null,\n      winner: game.winner(),\n      aiInfo: game.aiInfo,\n\n      fen: game.fen(),\n      startPos: game.config.startPos,\n    };\n  },\n  computed: {\n    invalidFen() {\n      return !game.validFen(this.fen);\n    },\n    invalidStartPos() {\n      return !game.validFen(this.startPos);\n    },\n  },\n  watch: {\n    'game.position.board': function() {\n      this.board.position(this.game.fen(), false);\n      this.winner = this.game.winner();\n      this.fen = this.game.fen();\n    },\n    'game.position.turn': function() {\n      if (this.game.turn() === 'black' && this.game.winner() === null) {\n        setTimeout(() => this.game.aiMove(5000), 100);\n      }\n    },\n\n    'game.aiInfo': {\n      handler: function(val) { this.aiInfo = val; }, deep: true\n    }\n  },\n  mounted () {\n    this.game.configure({\n      betweenDepths: () => {\n        // nothing else works to force a re-render... Vue seems to be bugged.\n        return new Promise(resolve => setTimeout(resolve, 10));\n      },\n    })\n\n    const onDragStart = (src, piece) => {\n      return (piece.charAt(0) === 'w' ? WHITE : BLACK) === this.game.position.turn &&\n      this.winner === null;\n    }\n\n    const onDrop = (src, target, piece) => {\n      if (!this.game.valid(src, target)) return 'snapback';\n\n      // pawn promotion\n      const r = rank(parse(target));\n      if (piece.charAt(1) === 'P' && (r === 8 || r === 1)) {\n        const color = (piece.charAt(0) === 'w') ? WHITE : BLACK;\n        // this refers to the vue object\n        this.promotion = {\n          pos: parse(target),\n          color,\n          src,\n          target,\n        };\n        return;\n      }\n\n      this.game.move(src, target); // we already know it's valid\n    }\n\n    this.board = Chessboard('board', {\n      position: this.game.fen(),\n      draggable: true,\n      onDrop,\n      onDragStart,\n    });\n  },\n  methods: {\n    handlePromotion(piece) {\n      this.game.move(\n        this.promotion.src,\n        this.promotion.target,\n        piece\n      );\n      this.promotion = null;\n    },\n    cancel() {\n      // cancel pawn promotion primarily\n      this.promotion = null;\n      this.board.position(this.game.fen(), false);\n    },\n    undoMove() {\n      this.game.undoMove();\n      if (game.position.turn === BLACK) this.game.undoMove();\n    },\n    restart() {\n      this.game.restart();\n    },\n\n    setPos() {\n      if (this.game.setPos(this.fen)) this.fen = this.game.fen();\n    },\n    setStartPos() {\n      if (game.validFen(this.startPos)) {\n        this.game.configure({\n          startPos: this.startPos\n        });\n      }\n    },\n    resetStartPos() {\n      this.game.configure({\n        startPos: 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1',\n      });\n      this.startPos = this.game.config.startPos;\n    },\n    setTime(time) {\n      this.game.configure({\n        searchTime: time,\n      });\n    }\n  },\n}\n</script>\n\n<style scoped>\n#board {\n  width: 50%;\n  margin: auto;\n  margin-bottom: 50px;\n  display: inline-block;\n  float: left;\n}\n.game-status {\n  float: left;\n  width: 25%;\n}\n.game-status h3 {\n  color: #737373;\n}\n.white {\n  color: #a6a6a6;\n}\n.black {\n  color: #333333;\n}\n\n.fen {\n  width: 90%;\n  margin-bottom: 10px;\n}\n\n.links {\n  float: left;\n  width: 25%;\n  padding: 5px;\n}\n\n.about {\n  padding: 5px;\n  float: left;\n  width: 100%;\n}\n.created-by {\n  display: inline-block;\n  float: right;\n  margin-right: 10px;\n}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/Home.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('h1',[_vm._v(\"Jackfish\")]),_vm._v(\" \"),_c('h2',[_vm._v(\"A chess engine in javascript.\")]),_vm._v(\" \"),_c('div',{staticClass:\"game-status\"},[(_vm.winner === 'white')?_c('h3',[_vm._v(\"The winner is\\n      \"),_c('span',{staticClass:\"white\"},[_vm._v(\"white\")])]):(_vm.winner === 'black')?_c('h3',[_vm._v(\"The winner is\\n      \"),_c('span',{staticClass:\"black\"},[_vm._v(\"black\")])]):(_vm.winner === 'draw')?_c('h3',[_vm._v(\"It's a draw\")]):_c('h3',{style:({ visibility: 'hidden' })},[_vm._v(\"\\n      Game is still running.\\n    \")]),_vm._v(\" \"),_c('button',{staticClass:\"btn btn-light\",attrs:{\"type\":\"button\"},on:{\"click\":_vm.undoMove}},[_vm._v(\"\\n      Undo move\\n    \")]),_vm._v(\" \"),_c('button',{staticClass:\"btn btn-light\",attrs:{\"type\":\"button\"},on:{\"click\":_vm.restart}},[_vm._v(\"\\n      Restart\\n    \")]),_vm._v(\" \"),_c('div',{staticClass:\"mt-3\"},[_c('h6',[_vm._v(\"AI search time (s)\")]),_vm._v(\" \"),_c('div',{staticClass:\"mb-2\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.game.config.searchTime),expression:\"game.config.searchTime\"}],domProps:{\"value\":(_vm.game.config.searchTime)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.game.config, \"searchTime\", $event.target.value)}}})]),_vm._v(\" \"),_c('button',{staticClass:\"btn btn-outline-success\",attrs:{\"type\":\"button\"},on:{\"click\":function($event){_vm.setTime(2)}}},[_vm._v(\"Easy\")]),_vm._v(\" \"),_c('button',{staticClass:\"btn btn-outline-warning\",attrs:{\"type\":\"button\"},on:{\"click\":function($event){_vm.setTime(4)}}},[_vm._v(\"Medium\")]),_vm._v(\" \"),_c('button',{staticClass:\"btn btn-outline-danger\",attrs:{\"type\":\"button\"},on:{\"click\":function($event){_vm.setTime(6)}}},[_vm._v(\"Hard\")])]),_vm._v(\" \"),_c('div',{staticClass:\"mt-3\"},[_c('h6',[_vm._v(\"Fen of starting position.\")]),_vm._v(\" \"),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.startPos),expression:\"startPos\"}],staticClass:\"fen\",domProps:{\"value\":(_vm.startPos)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.startPos=$event.target.value}}})]),_vm._v(\" \"),_c('button',{staticClass:\"btn btn-dark\",on:{\"click\":_vm.setStartPos}},[_vm._v(\"Set position\")]),_vm._v(\" \"),_c('button',{staticClass:\"btn btn-dark\",on:{\"click\":_vm.resetStartPos}},[_vm._v(\"Reset\")]),_vm._v(\" \"),(_vm.invalidStartPos)?_c('p',{staticClass:\"text-danger\"},[_vm._v(\"Invalid FEN string\")]):_vm._e()]),_vm._v(\" \"),_c('div',{staticClass:\"mt-3\"},[_vm._m(0),_vm._v(\" \"),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.fen),expression:\"fen\"}],staticClass:\"fen\",domProps:{\"value\":(_vm.fen)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.fen=$event.target.value}}})]),_vm._v(\" \"),_c('button',{staticClass:\"btn btn-dark\",on:{\"click\":_vm.setPos}},[_vm._v(\"Set position\")]),_vm._v(\" \"),(_vm.invalidFen)?_c('p',{staticClass:\"text-danger\"},[_vm._v(\"Invalid FEN string\")]):_vm._e()]),_vm._v(\" \"),_c('div',{staticClass:\"mt-3\"},[_c('p',[_c('strong',[_vm._v(\"Depth:\")]),_vm._v(\" \"+_vm._s(_vm.aiInfo.depth))]),_vm._v(\" \"),_c('p',[_c('strong',[_vm._v(\"Nodes searched:\")]),_vm._v(\" \"+_vm._s(_vm.aiInfo.searched))]),_vm._v(\" \"),_c('p',[_c('strong',[_vm._v(\"Hits in transposition table:\")]),_vm._v(\" \"+_vm._s(_vm.aiInfo.tpHits))])])]),_vm._v(\" \"),(_vm.promotion)?_c('Promotion',{attrs:{\"pos\":_vm.promotion.pos,\"board\":_vm.$refs.board,\"color\":_vm.promotion.color},on:{\"done\":_vm.handlePromotion}}):_vm._e(),_vm._v(\" \"),_c('div',{ref:\"board\",attrs:{\"id\":\"board\"},on:{\"click\":_vm.cancel}}),_vm._v(\" \"),_vm._m(1),_vm._v(\" \"),_vm._m(2),_vm._v(\" \"),_c('p',{staticClass:\"created-by\"},[_vm._v(\"Created by Mattias Ahlsén\")])],1)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('h6',[_c('a',{attrs:{\"href\":\"https://en.wikipedia.org/wiki/Forsyth%E2%80%93Edwards_Notation\"}},[_vm._v(\"\\n          FEN\\n        \")]),_vm._v(\" of board\\n      \")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"links\"},[_c('h3',[_vm._v(\"About\")]),_vm._v(\" \"),_c('p',[_vm._v(\"\\n      This is a chess engine I've built in javascript. The \\\"AI\\\" uses\\n      \"),_c('a',{attrs:{\"href\":\"https://chessprogramming.wikispaces.com/MTD%28f%29\"}},[_vm._v(\"mtd(f)\")]),_vm._v(\".\\n      All rules apply: insufficient material, fifty-move rule, threefold\\n      repetition etc, and the AI recognizes all these as draws and evaluates\\n      them accordingly. See more below.\\n    \")]),_vm._v(\" \"),_c('a',{staticClass:\"btn btn-primary btn-lg\",attrs:{\"href\":\"https://github.com/mattiasahlsen/jackfish/\",\"role\":\"button\"}},[_vm._v(\"\\n      Github repo\\n    \")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"about mt-4 mb-4\"},[_c('h4',{staticClass:\"mt-3\"},[_vm._v(\"Features\")]),_vm._v(\" \"),_c('ul',{staticClass:\"list-group\"},[_c('li',{staticClass:\"list-group-item\"},[_c('a',{attrs:{\"href\":\"https://chessprogramming.wikispaces.com/Simplified+evaluation+function\"}},[_vm._v(\"\\n          Piece-square table evaluation\\n        \")])]),_vm._v(\" \"),_c('li',{staticClass:\"list-group-item\"},[_c('a',{attrs:{\"href\":\"https://chessprogramming.wikispaces.com/MTD%28f%29\"}},[_vm._v(\"\\n          MTD(f)\\n        \")])]),_vm._v(\" \"),_c('li',{staticClass:\"list-group-item\"},[_c('a',{attrs:{\"href\":\"https://chessprogramming.wikispaces.com/Alpha-Beta\"}},[_vm._v(\"\\n          Alpha-beta\\n        \")])]),_vm._v(\" \"),_c('li',{staticClass:\"list-group-item\"},[_c('a',{attrs:{\"href\":\"https://chessprogramming.wikispaces.com/Iterative+Deepening\"}},[_vm._v(\"\\n          Iterative deepening\\n        \")])]),_vm._v(\" \"),_c('li',{staticClass:\"list-group-item\"},[_c('a',{attrs:{\"href\":\"https://chessprogramming.wikispaces.com/Transposition%20Table#KeyCollisions\"}},[_vm._v(\"\\n          Transposition table\\n        \")])]),_vm._v(\" \"),_c('li',{staticClass:\"list-group-item\"},[_c('a',{attrs:{\"href\":\"https://chessprogramming.wikispaces.com/Quiescence+Search\"}},[_vm._v(\"\\n          Quiescence search\\n        \")])]),_c('li',{staticClass:\"list-group-item\"},[_c('a',{attrs:{\"href\":\"https://chessprogramming.wikispaces.com/delta+pruning\"}},[_vm._v(\"\\n          Delta pruning\\n        \")])])]),_vm._v(\" \"),_c('h4',{staticClass:\"mt-3\"},[_vm._v(\"To be implemented\")]),_vm._v(\" \"),_c('ul',{staticClass:\"list-group\"},[_c('li',{staticClass:\"list-group-item\"},[_c('a',{attrs:{\"href\":\"https://chessprogramming.wikispaces.com/Killer+Move\"}},[_vm._v(\"\\n          Killer heuristic\\n        \")])]),_vm._v(\" \"),_c('li',{staticClass:\"list-group-item\"},[_c('a',{attrs:{\"href\":\"https://chessprogramming.wikispaces.com/Pawn%20Structure\"}},[_vm._v(\"\\n          Pawn structure evaluation\\n        \")])])]),_vm._v(\" \"),_c('h4',{staticClass:\"mt-3\"},[_vm._v(\"Credits to\")]),_vm._v(\" \"),_c('a',{attrs:{\"href\":\"https://chessprogramming.wikispaces.com/\"}},[_vm._v(\"https://chessprogramming.wikispaces.com/\")]),_vm._v(\" \"),_c('br'),_vm._v(\" \"),_c('a',{attrs:{\"href\":\"https://github.com/thomasahle/sunfish\"}},[_vm._v(\"https://github.com/thomasahle/sunfish\")])])}]\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-f6e613e8\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/Home.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-f6e613e8\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Home.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Home.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Home.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-f6e613e8\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./Home.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-f6e613e8\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/Home.vue\n// module id = null\n// module chunks = ","import Vue from 'vue'\nimport Router from 'vue-router'\nimport Home from '@/components/Home'\n\nVue.use(Router)\n\nexport default new Router({\n  routes: [\n    {\n      path: '/',\n      name: 'Home',\n      component: Home\n    }\n  ]\n})\n\n\n\n// WEBPACK FOOTER //\n// ./src/router/index.js","// The Vue build version to load with the `import` command\n// (runtime-only or standalone) has been set in webpack.base.conf with an alias.\nimport Vue from 'vue'\nimport App from './App'\nimport router from './router'\n\nimport $ from 'jquery';\nwindow.$ = window.jquery = $;\n\n// this might require the jquery variable to be available\nimport 'bootstrap/dist/css/bootstrap.min.css';\n\nVue.config.productionTip = false\n\n/* eslint-disable no-new */\nnew Vue({\n  el: '#app',\n  router,\n  components: { App },\n  template: '<App/>'\n})\n\n\n\n// WEBPACK FOOTER //\n// ./src/main.js"],"sourceRoot":""}