{"version":3,"sources":["webpack:///./src/App.vue?a157","webpack:///./src/App.vue","webpack:///src/App.vue","webpack:///./src/jackfish/declarations.js","webpack:///src/components/Promotion.vue","webpack:///./src/components/Promotion.vue?9712","webpack:///./src/components/Promotion.vue","webpack:///./src/jackfish/helpers.js","webpack:///./src/jackfish/evaluation.js","webpack:///./src/jackfish/tp.js","webpack:///./src/jackfish/Position.js","webpack:///./src/jackfish/AI.js","webpack:///./src/jackfish/index.js","webpack:///src/components/Home.vue","webpack:///./src/components/Home.vue?d3e5","webpack:///./src/components/Home.vue","webpack:///./src/router/index.js","webpack:///./src/main.js","webpack:///./src/assets/img/chesspieces/wikipedia lazy ^\\.\\/.*\\.png$"],"names":["selectortype_template_index_0_src_App","render","_h","this","$createElement","_c","_self","attrs","id","staticRenderFns","src_App","__webpack_require__","normalizeComponent","name","ssrContext","WHITE","BLACK","PIECES","imgs","white","Q","N","R","B","black","q","n","r","b","key","then","val","_loop","_loop2","Promotion","data","props","computed","file","pos","urls","color","width","board","offsetWidth","offset","getBoundingClientRect","x","components_Promotion","_vm","staticClass","style","left","_l","img","piece","src","on","click","$event","$emit","src_components_Promotion","Promotion_normalizeComponent","isWhite","charAt","toUpperCase","isColor","sameColor","p1","p2","next","c","colDif","Math","abs","rank","p","floor","parse","s","length","NaN","toLowerCase","charCodeAt","a","h","squareToString","String","fromCharCode","toString","concat","equalBoards","b1","b2","i","PIECE","P","K","pstRaw","pst","bKey","forEach","e","push","evaluation__loop","evaluate","value","Random","require","random","engines","mt19937","seed","rand","integer","pow","randoms","hashes","turn","wc","bc","epFile","kp","kps","Lru","maxSize","classCallCheck_default","map","map_default","createClass_default","size","hash","low","high","arr","get","undefined","delete","set","keys","clear","Cwf","cache","currentSize","A1","H8","W","steps","S","Position","boardOrFen","arguments","ep","halfMoveClock","score","myHash","boardHash","fen","subs","trim","split","num","parseInt","is_integer_default","j","Error","used","applyHashes","hashParam","hashBoard","rights","step","t","tp","includes","ret","slice","hashNullMove","prev","move","promo","o","op","helper","newHashes","hashMove","_this","newHash","newBoardHash","applyHash","applyBoardHash","moves","genMoves","el","done","nextPos","nextMoves","nextEl","mySteps","pawnSteps","pawn","kingSquare","indexOf","bq","rq","BQ","RQ","spaces","MAX_SCORE","SEARCH_MARGIN","L","E","H","boardTable","count","add","pull","Killer","origins","callBack","tpHits","searched","timeLimit","gotMove","timeout","Date","now","forMoves","pv","callback","inStalemate","inCheck","getPieces","pieces","new","takenPiece","newPieces","assign_default","endgame","insufficientMaterial","alphaBeta","depth","alpha","beta","root","stalemate","entry","fail","handleMove","nextScore","nullMove","mtdf","guess","bound","lower","upper","f","AI","_ref","asyncToGenerator_default","regenerator_default","mark","_callee","history","stopReason","deepestEntry","returnVal","time","maxDepth","logs","betweenDepths","wrap","_context","abrupt","stop","_x2","_x3","apply","defaultConfig","startPos","searchTime","Home_game","Engine","options","config","aiInfo","configure","setPos","fullMove","isNaN","position","constructor","valid","last","pop","inCheckMate","fiftyMoves","inThreefoldRepetition","inStaleMate","insuffMaterial","game","generator","console","log","aimove","Home","components","promotion","winner","invalidFen","validFen","invalidStartPos","watch","game.position.board","game.position.turn","runAiMove","importScripts","setTimeout","$worker","run","game.aiInfo","handler","deep","mounted","_this2","promise_default","resolve","onDragStart","onDrop","target","createBoard","window","onresize","$refs","ontouchmove","event","preventDefault","methods","height","min","$","chessboard_default","draggable","destroyBoard","destroy","handlePromotion","cancel","undoMove","restart","setStartPos","resetStartPos","setTime","components_Home","_e","_v","ref","touch-action","visibility","type","directives","rawName","expression","domProps","input","composing","_m","_s","href","role","src_components_Home","Home_normalizeComponent","Vue","use","Router","router","routes","path","component","VueWorker","jquery","productionTip","App","template","./bB.png","./bK.png","./bN.png","./bP.png","./bQ.png","./bR.png","./wB.png","./wK.png","./wN.png","./wP.png","./wQ.png","./wR.png","webpackAsyncContext","req","ids","Promise","reject","Object","module","exports"],"mappings":"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","file":"static/js/app.429307a4873818ea819f.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"app\"}},[_c('router-view')],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-6b03bc40\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/App.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-6b03bc40\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!../node_modules/vue-loader/lib/selector?type=styles&index=0!./App.vue\")\n}\nvar normalizeComponent = require(\"!../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../node_modules/vue-loader/lib/selector?type=script&index=0!./App.vue\"\nimport __vue_script__ from \"!!babel-loader!../node_modules/vue-loader/lib/selector?type=script&index=0!./App.vue\"\n/* template */\nimport __vue_template__ from \"!!../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-6b03bc40\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../node_modules/vue-loader/lib/selector?type=template&index=0!./App.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/App.vue\n// module id = null\n// module chunks = ","<template>\n  <div id=\"app\">\n    <router-view/>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'App'\n}\n</script>\n\n<style>\nhtml, body {\n  margin: 0;\n  padding: 0;\n  border: 0;\n}\n#app {\n  font-family: 'Avenir', Helvetica, Arial, sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  text-align: center;\n  background-color: #0f0f0f;\n  color: #f2f2f2;\n  width: 100%;\n}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/App.vue","/**\n * Type and constants declarations.\n * @flow\n */\n\nexport const WHITE = 0;\nexport const BLACK = 1;\nexport const PIECES = [\n  'P', 'N', 'B', 'R', 'Q', 'K',\n  'p', 'n', 'b', 'r', 'q', 'k'\n];\n\nexport type Color = 0 | 1;\n// ' ' means no piece\nexport type Piece = 'P' | 'N' | 'B' | 'R' | 'Q' | 'K' |\n                    'p' | 'n' | 'b' | 'r' | 'q' | 'k';\n// [white, black], piece objects may be any order\n// must have no empty elements\nexport type Board = Array<Piece | null>;\n\nexport type Move = [number, number]; // [from, to]\nexport type CR = [boolean, boolean]; // castling rights [queenside, kingside]\n\nexport type Hash = [number, number];\nexport type History = Array<{fen: string, move: Move}>;\n\n// used for testing\nexport type PieceObj = {| pos: number, piece: Piece |};\nexport type Pieces = Array<PieceObj>;\n\n\n\n// WEBPACK FOOTER //\n// ./src/jackfish/declarations.js","<template>\n  <div class=\"promotion\" :style=\"{\n    left: offset + 'px',\n    width: width + 'px',\n  }\">\n    <img v-for=\"(img, piece) in urls\" :key=\"img\"\n      :src=\"img\" @click=\"$emit('done', piece)\"\n      :style=\"{ width: width + 'px', }\"\n    >\n  </div>\n</template>\n\n<script>\nimport { WHITE } from '@/jackfish/declarations';\n\n// piece img urls\nconst imgs = {\n  white: {\n    Q: 'wQ',\n    N: 'wN',\n    R: 'wR',\n    B: 'wB',\n  },\n  black: {\n    q: 'bQ',\n    n: 'bN',\n    r: 'bR',\n    b: 'bB',\n  }\n};\n\nfor (const key in imgs.white) {\n  import('../assets/img/chesspieces/wikipedia/' + imgs.white[key] + '.png').then(val => {\n    imgs.white[key] = val;\n  })\n}\nfor (const key in imgs.black) {\n  import('../assets/img/chesspieces/wikipedia/' + imgs.black[key] + '.png').then(val => {\n    imgs.black[key] = val;\n  })\n}\n\nexport default {\n  name: 'Promotion',\n  data() {\n    return {\n    };\n  },\n  props: ['pos', 'color', 'board'],\n  computed: {\n    file() {\n      return this.pos % 8; // 0 - 7\n    },\n    // piece img urls\n    urls() {\n      if (this.color === WHITE) return imgs.white;\n      else return imgs.black;\n    },\n    width() {\n      return this.board.offsetWidth / 8;\n    },\n    offset() {\n      return this.board.getBoundingClientRect().x +\n        (this.file - 1) * this.width;\n    }\n  },\n};\n</script>\n\n<style scoped>\n.promotion {\n  position: absolute;\n  background-color: white;\n  box-shadow: 1px 1px 5px;\n  z-index: 100;\n}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/Promotion.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"promotion\",style:({\n  left: _vm.offset + 'px',\n  width: _vm.width + 'px',\n})},_vm._l((_vm.urls),function(img,piece){return _c('img',{key:img,style:({ width: _vm.width + 'px', }),attrs:{\"src\":img},on:{\"click\":function($event){return _vm.$emit('done', piece)}}})}),0)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-46a32d55\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/Promotion.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-46a32d55\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Promotion.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Promotion.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Promotion.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-46a32d55\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./Promotion.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-46a32d55\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/Promotion.vue\n// module id = null\n// module chunks = ","/**\n * Helper functions.\n * @flow\n */\n\nimport { WHITE, BLACK } from './declarations';\nimport type { Piece, Color, Board } from './declarations';\n\nexport function isWhite(piece: Piece): boolean {\n  return piece.charAt(0) === piece.charAt(0).toUpperCase();\n}\n\nexport function isColor(piece: Piece, color: Color): boolean {\n  return color === WHITE ? isWhite(piece) : !isWhite(piece);\n}\n\nexport function sameColor(p1: Piece, p2: Piece): boolean {\n  return isWhite(p1) === isWhite(p2);\n}\n\n// Returns the other color.\nexport function next(c: Color): Color {\n  return c === WHITE ? BLACK : WHITE;\n}\n\nexport function rowDif(p1: number, p2: number): number {\n  return Math.abs(Math.floor(p1 / 8) - Math.floor(p2 / 8));\n}\n\nexport function colDif(p1: number, p2: number): number {\n  return Math.abs(p1 % 8 - p2 % 8);\n}\n\nexport function rank(p: number): number {\n  return 8 - Math.floor(p / 8)\n}\n\n/**\n * Parses a position on form 'f5'. If it's already a number, returns the\n * number.\n * @return The corresponding number, or NaN if the string was invalid.\n */\nexport function parse(s: string | number) {\n  if (typeof s === 'number') return s;\n  if (s.length !== 2) return NaN;\n\n  s = s.toLowerCase();\n  const file = s.charCodeAt(0); // char representing file\n  const rank = s.charCodeAt(1); // char representing rank\n  const a = 'a'.charCodeAt(0);\n  const h = 'h'.charCodeAt(0);\n  if (!(file >= a && file <= h && rank >= 49 && rank <= 56)) {\n    return NaN;\n  }\n\n  // 97 is ascii for 'a' and 49 for '1'\n  return file - 97 + 56 - (rank - 49) * 8;\n}\n\n/**\n * Parses a position on number form to from 'f5'.\n * Assumes pos >= 0 && pos <= 63.\n * @return The string, or null if the number was invalid.\n */\nexport function squareToString(pos: number): string {\n  const file: string = String.fromCharCode(pos % 8 + 97);\n  const r: string = rank(pos).toString();\n  return file.concat(r);\n}\n\nexport function equalBoards (b1: Board, b2: Board) {\n  for (let i = 0; i < 64; i++) {\n    if (b1[i] !== b2[i]) return false;\n  }\n  return true;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/jackfish/helpers.js","/**\n * Evaluation of a position.\n * @flow\n */\n\nimport { isWhite } from './helpers';\n\nimport type { Board, Piece } from './declarations';\n\n// Piece values.\n// King value is set to a very high value to easily detect when king is taken,\n// and thereby detecting checkmate, and to always avoid it if possible.\nexport const PIECE = { P: 100, N: 320, B: 330, R: 500, Q: 900, K: 30000 };\n\n// Piece-square tables.\n// Index is index of position on the board for white, and for the board\n// flipped for black.\n// Taken from https://chessprogramming.wikispaces.com/Simplified%20evaluation%20function\n\n/* eslint-disable */\nexport const pstRaw = {\n  // pawn\n  P: [\n     0,  0,  0,  0,  0,  0,  0,  0,\n    50, 50, 50, 50, 50, 50, 50, 50,\n    10, 10, 20, 30, 30, 20, 10, 10,\n     5,  5, 10, 25, 25, 10,  5,  5,\n     0,  0,  0, 20, 20,  0,  0,  0,\n     5, -5,-10,  0,  0,-10, -5,  5,\n     5, 10, 10,-20,-20, 10, 10,  5,\n     0,  0,  0,  0,  0,  0,  0,  0\n  ],\n  // knight\n  N: [\n    -50,-40,-30,-30,-30,-30,-40,-50,\n    -40,-20,  0,  0,  0,  0,-20,-40,\n    -30,  0, 10, 15, 15, 10,  0,-30,\n    -30,  5, 15, 20, 20, 15,  5,-30,\n    -30,  0, 15, 20, 20, 15,  0,-30,\n    -30,  5, 10, 15, 15, 10,  5,-30,\n    -40,-20,  0,  5,  5,  0,-20,-40,\n    -50,-40,-30,-30,-30,-30,-40,-50,\n  ],\n  // bishop\n  B: [\n    -20,-10,-10,-10,-10,-10,-10,-20,\n    -10,  0,  0,  0,  0,  0,  0,-10,\n    -10,  0,  5, 10, 10,  5,  0,-10,\n    -10,  5,  5, 10, 10,  5,  5,-10,\n    -10,  0, 10, 10, 10, 10,  0,-10,\n    -10, 10, 10, 10, 10, 10, 10,-10,\n    -10,  5,  0,  0,  0,  0,  5,-10,\n    -20,-10,-10,-10,-10,-10,-10,-20,\n  ],\n  // rook\n  R: [\n     0,  0,  0,  0,  0,  0,  0,  0,\n     5, 10, 10, 10, 10, 10, 10,  5,\n    -5,  0,  0,  0,  0,  0,  0, -5,\n    -5,  0,  0,  0,  0,  0,  0, -5,\n    -5,  0,  0,  0,  0,  0,  0, -5,\n    -5,  0,  0,  0,  0,  0,  0, -5,\n    -5,  0,  0,  0,  0,  0,  0, -5,\n     0,  0,  0,  5,  5,  0,  0,  0,\n  ],\n  // queen\n  Q: [\n    -20,-10,-10, -5, -5,-10,-10,-20,\n    -10,  0,  0,  0,  0,  0,  0,-10,\n    -10,  0,  5,  5,  5,  5,  0,-10,\n     -5,  0,  5,  5,  5,  5,  0, -5,\n      0,  0,  5,  5,  5,  5,  0, -5,\n    -10,  5,  5,  5,  5,  5,  0,-10,\n    -10,  0,  5,  0,  0,  0,  0,-10,\n    -20,-10,-10, -5, -5,-10,-10,-20,\n  ],\n  // king\n  K: [\n    -30,-40,-40,-50,-50,-40,-40,-30,\n    -30,-40,-40,-50,-50,-40,-40,-30,\n    -30,-40,-40,-50,-50,-40,-40,-30,\n    -30,-40,-40,-50,-50,-40,-40,-30,\n    -20,-30,-30,-40,-40,-30,-30,-20,\n    -10,-20,-20,-20,-20,-20,-20,-10,\n     20, 20,  0,  0,  0,  0, 20, 20,\n     20, 30, 10,  0,  0, 10, 30, 20\n  ]\n};\n/* eslint-enable */\n\n// Join psts with piece values into a final pst, and add mirrored tables\n// for black pieces\ntype Pst = {\n  [piece: Piece]: Array<number>\n};\n\nexport const pst: Pst = {};\nfor (const key in pstRaw) {\n  const bKey: Piece = (key.toLowerCase(): any); // corresponding black piece key\n  pst[(key: any)] = [];\n  pst[bKey] = [];\n  pstRaw[key].forEach((e, i) => {\n    pst[(key: any)].push(e + PIECE[key])\n    pst[bKey][56 - i + 2 * (i % 8)] = e + PIECE[key];\n  });\n}\n\n/**\n * Gives the board value for white (negate for black's).\n */\nexport default function evaluate(board: Board): number {\n  let value = 0;\n  for (let i = 0; i < 64; i++) {\n    if (board[i]) {\n      const piece: Piece = board[i];\n      if (isWhite(piece)) value += pst[piece][i];\n      else value -= pst[piece][i];\n    }\n  }\n  return value;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/jackfish/evaluation.js","/**\n * Transposition table stuff\n * @flow\n */\n\nimport Position from './Position';\nimport { PIECES, WHITE } from './declarations';\nimport type { Piece } from './declarations';\n\nconst Random = require('random-js');\n// 27102 is just a random number\nconst random = new Random(Random.engines.mt19937().seed(27102));\n\n/**\n * Zobrist hashing for positions. Hashed in two parts, low and high.\n *\n * Low is used as key in Map and high is stored at the key\n * together with a value for that position. This is because of\n * javascript's number type that can only store integers up to 52 signed\n * bits and the fact that bitwise operators in javascript only operates on\n * 32 bit signed integers.\n */\n\n// get a random 32 bit integer\nexport function rand() {\n  return random.integer(-Math.pow(2, 31), Math.pow(2, 31) - 1);\n}\n\n// Makes a hash tuple with low and high\nexport const randoms = () => [rand(), rand()];\n\n// initialize hashes array\ntype Hashes = {\n  [index: Piece | 'wc' | 'bc' | 'turn' | 'epFile' | 'kp']: any\n}\nconst hashes: Hashes = {};\nPIECES.forEach(p => {\n  hashes[p] = [];\n  for (let i = 0; i < 64; i++) {\n    hashes[p].push(randoms()); // [low, high]\n  }\n\n  hashes.turn = randoms(); // apply when white's turn\n\n  hashes.wc = [randoms(), randoms()]; // [queenside, kingside]\n  hashes.bc = [randoms(), randoms()];\n\n  hashes.epFile = [];\n  for (let i = 0; i < 8; i++) {\n    hashes.epFile.push(randoms()); // [A, B, C...]\n  }\n\n  hashes.kp = [];\n  const kps = [3, 5, 59, 61];\n  for (let i = 0; i < kps.length; i++) {\n    hashes.kp[kps[i]] = randoms();\n  }\n});\n\nexport { hashes };\n\n// Hash the position, returning hash as [low, high]\nexport function hash(pos: Position): [number, number] {\n  const myHash = [0, 0]; // low, high\n\n  // apply [low, high] to low and high\n  const applyHashes = (hashParam: [number, number]) => {\n    myHash[0] ^= hashParam[0];\n    myHash[1] ^= hashParam[1];\n  }\n\n  if (pos.turn === WHITE) applyHashes(hashes.turn);\n  for (let i = 0; i < 64; i++) {\n    const p = pos.board[i];\n    if (p) applyHashes(hashes[p][i]);\n  }\n  if (pos.wc[0]) applyHashes(hashes.wc[0]);\n  if (pos.wc[1]) applyHashes(hashes.wc[1]);\n  if (pos.bc[0]) applyHashes(hashes.bc[0]);\n  if (pos.bc[1]) applyHashes(hashes.bc[1]);\n  if (pos.ep !== -1) applyHashes(hashes.epFile[pos.ep % 8]);\n  if (pos.kp !== -1) applyHashes(hashes.kp[pos.kp]);\n\n  return myHash;\n}\n\n/** Transposition table */\n\n// LRU cache, first in first out, size > 0\nexport class Lru<Entry = any> {\n  map: Map<number, Array<Entry>> = new Map();\n  // max number of keys in map (not max number of entries since there can be\n  // many entries in an array at one key)\n  maxSize: number;\n\n  constructor(maxSize: number) {\n    this.maxSize = maxSize;\n  }\n\n  size() {\n    return this.map.size;\n  }\n\n  /** Returns entry at hash, or undefined if there is none. */\n  get(hash: [number, number]): ?Entry {\n    const low = hash[0];\n    const high = hash[1];\n    const arr = this.map.get(low);\n\n    if (arr !== undefined) {\n      // set to last recently used\n      this.map.delete(low);\n      this.map.set(low, arr);\n\n      return arr[high];\n    }\n    return undefined;\n  }\n\n  /** Add an entry to the cache, returns the added entry. */\n  add(hash: [number, number], val: Entry): Entry {\n    const low = hash[0];\n    const high = hash[1];\n    const arr = this.map.get(low);\n\n    if (arr !== undefined) {\n      arr[high] = val;\n      this.map.delete(low);\n      this.map.set(low, arr);\n    } else {\n      const arr = [];\n      arr[high] = val;\n      this.map.set(low, arr);\n    }\n\n    if (this.map.size > this.maxSize) {\n      // $FlowFixMe\n      this.map.delete(this.map.keys().next().value);\n    }\n\n    return val;\n  }\n\n  clear() {\n    this.map.clear();\n  }\n\n  setSize(maxSize: number) {\n    this.maxSize = maxSize;\n  }\n}\n\n// A simpler clear-when-full cache,\n// has a max size but just resets when it's reached\nexport class Cwf<Entry = any> {\n  cache: Array<Array<Entry>> = [];\n  maxSize: number;\n  currentSize: number = 0;\n\n  constructor(size: number) {\n    this.maxSize = size;\n  }\n\n  size(): number {\n    return this.currentSize;\n  }\n  setSize(size: number): void {\n    this.maxSize = size;\n  }\n\n  /** Returns entry at hash or undefined if there is none. */\n  get(hash: [number, number]): ?Entry {\n    const low = hash[0];\n    const high = hash[1];\n\n    if (this.cache[low] !== undefined) return this.cache[low][high];\n    else return undefined;\n  }\n\n  /** Add an entry to the cache. Assumes it does not already exist */\n  add(hash: [number, number], val: Entry): Entry {\n    const low = hash[0];\n    const high = hash[1];\n\n    // if passed size limit, clear cache and start over\n    // (might clear one too early)\n    if (this.currentSize === this.maxSize) {\n      this.cache = [];\n      this.currentSize = 0;\n    }\n\n    if (this.cache[low] !== undefined) {\n      if (this.cache[low][high] === undefined) this.currentSize++;\n      this.cache[low][high] = val;\n    } else {\n      this.cache[low] = [];\n      this.cache[low][high] = val;\n      this.currentSize++;\n    }\n    return val;\n  }\n  clear() {\n    this.cache = [];\n    this.currentSize = 0;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/jackfish/tp.js","/**\n * Position module.\n * @flow\n */\n\nimport { isColor, sameColor, next, colDif, rowDif,\n  parse, squareToString } from './helpers';\nimport evaluate, { pst } from './evaluation';\nimport { WHITE, BLACK } from './declarations';\nimport { hash, hashes } from './tp';\n\nimport type { Color, Board, Piece, Move, CR, Hash } from './declarations';\n\n// some squares\nexport const A1 = 56;\nexport const H1 = 63;\nexport const A8 = 0;\nexport const H8 = 7;\n\n// directions\nconst N = -8; // north\nconst E = 1; // east\nconst S = 8; // south\nconst W = -1; // west\n\n/* eslint-disable */\n// possible steps for different pieces\nconst steps = {};\nsteps.P = [N, 2*N, N+W, N+E]; // p[0] = white, p[1] = black\nsteps.N = [2*N+W, 2*N+E, 2*W+N, 2*W+S, 2*S+E, 2*S+W, 2*E+N, 2*E+S];\nsteps.B = [N+W, N+E, S+W, S+E];\nsteps.R = [N, E, S, W];\nsteps.Q = [N, N+E, E, S+E, S, S+W, W, N+W];\nsteps.K = [N, N+E, E, S+E, S, S+W, W, N+W];\n\n// add for black pieces\nfor (const key in steps) {\n  steps[key.toLowerCase()] = steps[key];\n}\n// black pawns can only move opposite direction\nsteps.p = [];\nfor (let i = 0; i < steps.P.length; i++) steps.p.push(-steps.P[i]);\n\n/* eslint-enable */\n\n/**\n * A complete position of a chess game.\n */\nexport default class Position {\n  board: Board;\n  turn: Color;\n  wc: CR;\n  bc: CR;\n  ep: number;\n  kp: number;\n  halfMoveClock: number;\n\n  score: number;\n  hash: Hash;\n  boardHash: Hash;\n\n  prev: Position | void;\n\n  constructor(\n    boardOrFen: Board | string,\n    turn: Color = WHITE,\n    wc: CR = [true, true], // white castling rights\n    bc: CR = [true, true], // black...\n    ep: number = -1, // -1 if there is none\n    kp: number = -1, // -1 if there is none\n    halfMoveClock: number = 0, // defaults to 0\n\n    // Score for color to move. If none is provided, calculates it from scratch.\n    score?: number,\n    myHash?: Hash,\n    boardHash?: Hash,\n  ) {\n    // if we get a fen string: assumes it's a valid fen string\n    if (typeof boardOrFen === 'string') {\n      const fen = boardOrFen;\n      this.board = [];\n      this.wc = [false, false];\n      this.bc = [false, false];\n      this.ep = -1;\n      this.kp = -1;\n\n      const subs = fen.trim().split(/ +/); // get substrings\n\n      let pos = 0; // current board position (square)\n      let i = 0; // index of string\n      // The board array is indexed the same way as FEN notation.\n      while (i < subs[0].length) {\n        let c = subs[0].charAt(i); // currently parsed char\n        const num = parseInt(c);\n        if (Number.isInteger(num)) {\n          for (let j = 0; j < num; j++) {\n            this.board[pos + j] = null;\n          }\n          pos += num;\n        } else {\n          // Cast to piece when we know it is one.\n          c = ((c: any): Piece)\n          this.board[pos] = c;\n          pos++;\n        }\n        i++;\n        if (pos >= 64) break; // should not be able to be bigger than 64\n        else if (pos % 8 === 0) {\n          i++;\n        }\n      }\n\n      switch (subs[1]) {\n        case 'w': this.turn = WHITE; break;\n        case 'b': this.turn = BLACK; break;\n        default: throw new Error('Invalid fen string');\n      }\n\n      if (subs[2] !== '-') {\n        const used = [];\n        for (let i = 0; i < subs[2].length; i++) {\n          const c = subs[2].charAt(i);\n          switch (c) {\n            case 'Q': this.wc[0] = true; break;\n            case 'K': this.wc[1] = true; break;\n            case 'q': this.bc[1] = true; break;\n            case 'k': this.bc[0] = true; break;\n            default: throw new Error('Invalid fen string');\n          }\n          used.push(c);\n        }\n      }\n\n      if (subs[3] !== '-') this.ep = parse(subs[3]);\n\n      this.halfMoveClock = parseInt(subs[4]);\n    } else {\n      // else just copy all the parameters to fields.\n      this.board = boardOrFen;\n      this.turn = turn;\n      this.wc = wc;\n      this.bc = bc;\n      this.ep = ep;\n      this.kp = kp;\n      this.halfMoveClock = halfMoveClock;\n    }\n\n    if (score !== undefined) this.score = score;\n    else {\n      this.score = this.turn === WHITE\n        ? evaluate(this.board) : -evaluate(this.board);\n    }\n\n    if (myHash !== undefined) this.hash = myHash;\n    else this.hash = hash((this: any));\n    if (boardHash !== undefined) this.boardHash = boardHash;\n    else this.boardHash = this.hashBoard();\n  }\n\n  /**\n   * Returns possible moves for color, including moves that result in king-take\n   * and castles invalid because of threatened squares or check. For pawn\n   * promotions, it will only generate one move without the promotion piece.\n   * You must later add the promotion piece for the move to be valid.\n   * @param [color=this.turn] The color to look for moves for.\n   */\n  *genMoves(color?: Color = this.turn): Generator<Move, void, void> {\n    for (let i = 0; i < this.board.length; i++) {\n      const piece = this.board[i];\n      if (piece === null || !isColor(piece, color)) continue;\n\n      // check for castling\n      if (piece.toUpperCase() === 'K') {\n        const rights = color === WHITE ? this.wc : this.bc;\n        if (rights[0] && this.board[i - 1] === null &&\n          this.board[i - 2] === null) yield ([i, i - 2]: Move);\n        if (rights[1] && this.board[i + 1] === null &&\n          this.board[i + 2] === null) yield ([i, i + 2]: Move);\n      }\n\n      for (let j = 0; j < steps[piece].length; j++) {\n        const step = steps[piece][j];\n        // if step is two steps, it must be a pawn\n        if ((step === 2 * N && i < A1 - 8) ||\n          (step === 2 * S && i > H8 + 8)) continue;\n\n        let t = i + step; // target square\n\n        // keep within bounds of board\n        while (t >= 0 && t <= 63 && colDif(t, t - step) < 6) {\n          const tp = this.board[t]; // target piece (or null)\n\n          // pawns get special treatment\n          if (piece.toUpperCase() === 'P') {\n            if (colDif(i, t) === 0 && tp !== null) break;\n            if (rowDif(i, t) === 2 && this.board[i + step / 2] !== null) break;\n            if (colDif(i, t) === 1 && t !== this.ep &&\n              (tp === null || sameColor(tp, piece))) break;\n          } else if (tp !== null) {\n            if (!sameColor(tp, piece)) {\n              yield ([i, t]: Move);\n            }\n            break;\n          }\n\n          yield ([i, t]: Move);\n          if ('KkNnPp'.includes(piece)) break;\n          t += step;\n        }\n      }\n    }\n  }\n\n  /**\n   * Makes a nullmove, i.e. switches turn, resets en passant and negates score.\n   */\n  nullMove(): Position {\n    // copying board with slice, works because it's shallow\n    const ret = new Position(this.board.slice(), next(this.turn), this.wc, this.bc,\n      -1, -1, this.halfMoveClock + 1,\n      -this.score, this.hashNullMove(), this.boardHash);\n    ret.prev = this;\n    return ret;\n  }\n\n  /**\n   * Makes the move and returns the new position. Does not alter this\n   * position. Assumes that the move is valid.\n   * @param move  The move\n   * @param promo If there is a promotion of a pawn, this is the piece to\n   *              replace it with. Default to Queen.\n   * @param score Optional to pass score to avoid calculating it twice\n   * @return      The new position.\n   */\n  move(move: Move, promo?: Piece, score?: number): Position {\n    const o = move[0]; // origin square\n    const t = move[1]; // target square\n    // it's assumed that there is a piece at the origin position,\n    // toUpperCase() makes it generic because color doesn't matter\n    const op: Piece = (this.board[o]: any);\n    if (!promo) {\n      if (this.turn === WHITE) promo = 'Q'; // default promotion piece\n      else promo = 'q';\n    }\n\n    const board = this.board.slice(); // copy board\n    let wc: CR = (this.wc.slice(): any); // copy castling rights\n    let bc: CR = (this.bc.slice(): any);\n    let ep = -1; // default\n    let kp = -1;\n    // negate score so it's for the other side\n    if (score === undefined) score = -(this.score + this.value(move, promo));\n\n    let halfMoveClock;\n    // will also be reset at pawn take\n    if (board[t]) halfMoveClock = 0;\n    else halfMoveClock = this.halfMoveClock + 1;\n\n    // make the move\n    board[t] = board[o];\n    board[o] = null;\n\n    // castle\n    if (op === 'K') {\n      wc = [false, false];\n      if (Math.abs(t - o) === 2) {\n        kp = (o + t) / 2;\n        board[kp] = 'R';\n        board[t < o ? A1 : H1] = null;\n      }\n    } else if (op === 'k') {\n      bc = [false, false];\n      if (Math.abs(t - o) === 2) {\n        kp = (o + t) / 2;\n        board[kp] = 'r';\n        board[t < o ? A8 : H8] = null;\n      }\n    } else {\n      // set castling rights\n      const helper = (p) => {\n        switch (p) {\n          case A1: wc[0] = false; break;\n          case H1: wc[1] = false; break;\n          case A8: bc[0] = false; break;\n          case H8: bc[1] = false; break;\n          default: break;\n        }\n      }\n      helper(o);\n      helper(t);\n\n      // double move, en passant and pawn promotion\n      if (op === 'P') { // white\n        halfMoveClock = 0;\n\n        if (t - o === -16) ep = (t + o) / 2;\n        else if (t === this.ep) board[t + 8] = null;\n        else if (t <= H8) board[t] = (promo: any); // assume it's defined\n      } else if (op === 'p') { // black\n        halfMoveClock = 0;\n\n        if (t - o === 16) ep = (t + o) / 2;\n        else if (t === this.ep) board[t - 8] = null;\n        else if (t >= A1) board[t] = (promo: any);\n      }\n    }\n\n    const newHashes = this.hashMove(move, promo)\n\n    const ret = new Position(board, next(this.turn), wc, bc, ep, kp,\n      halfMoveClock, score, newHashes[0], newHashes[1]);\n    ret.prev = this;\n    return ret;\n  }\n\n  /**\n   * Returns the value (change of position score) of a move. Assumes it's valid.\n   */\n  value(move: Move, promo?: Piece): number {\n    const o = move[0];\n    const t = move[1];\n    const op: Piece = (this.board[o]: any);\n    let tp: Piece = (this.board[t]: any);\n\n    // invalid castling detection, returns MAX_SAFE_INTEGER if last move's\n    // castle was invalid (if king is threatened on any of the squares\n    // it moves over)\n    if (this.kp !== -1 && Math.abs(t - this.kp) < 2) return 30000;\n\n    let score = pst[op][t] - pst[op][o];\n    // capture\n    if (tp) score += pst[tp][t];\n\n    // castling\n    if (op === 'K' && Math.abs(t - o) === 2) {\n      score += pst['R'][(t + o) / 2];\n      score -= t < o ? pst['R'][A1] : pst['R'][H1];\n    } else if (op === 'k' && Math.abs(t - o) === 2) {\n      score += pst['r'][(t + o) / 2];\n      score -= t < o ? pst['r'][A8] : pst['r'][H8];\n    }\n\n    // pawn stuff\n    if (op === 'P') {\n      if (t <= H8) score += pst[promo || 'Q'][t] - pst[op][t];\n      else if (t === this.ep) {\n        tp = (this.board[t + 8]: any);\n        score += pst[tp][t + 8];\n      }\n    } else if (op === 'p') {\n      if (t >= A1) score += pst[promo || 'q'][t] - pst[op][t];\n      else if (t === this.ep) {\n        tp = (this.board[t - 8]: any);\n        score += pst[tp][t - 8];\n      }\n    }\n    return score;\n  }\n\n  /** Returns the resulting hashes ([posHash, boardHash]) from a move\n      (position hash and board hash). Assumes it's a valid move. */\n  hashMove(move: Move, promo?: Piece): [Hash, Hash] {\n    const o = move[0];\n    const t = move[1];\n    const op: Piece = (this.board[o]: any);\n    let tp = this.board[t];\n\n    const newHash: Hash = (this.hash.slice(): any); // copy\n    const newBoardHash: Hash = (this.boardHash.slice(): any);\n\n    const applyHash = (hashParam: Hash) => {\n      newHash[0] ^= hashParam[0];\n      newHash[1] ^= hashParam[1];\n    }\n    const applyBoardHash = (hashParam: Hash) => {\n      newBoardHash[0] ^= hashParam[0];\n      newBoardHash[1] ^= hashParam[1];\n    }\n\n    // switch turn\n    applyHash(hashes.turn);\n\n    // if this position has an en passant or king passant, unhash it\n    if (this.ep !== -1) applyHash(hashes.epFile[this.ep % 8]);\n    if (this.kp !== -1) applyHash(hashes.kp[this.kp]);\n\n    applyHash(hashes[op][o]);\n    applyHash(hashes[op][t]);\n    applyBoardHash(hashes[op][o]);\n    applyBoardHash(hashes[op][t]);\n    if (tp) {\n      applyHash(hashes[tp][t]);\n      applyBoardHash(hashes[tp][t]);\n    }\n\n    // castling\n    if (op === 'K' && Math.abs(t - o) === 2) {\n      const kp = (t + o) / 2;\n      applyHash(hashes.wc[0]);\n      applyHash(hashes.wc[1]);\n      applyHash(hashes.kp[kp]);\n\n      applyHash(hashes['R'][kp]);\n      applyBoardHash(hashes['R'][kp]);\n      if (t < o) {\n        applyHash(hashes['R'][A1]);\n        applyBoardHash(hashes['R'][A1]);\n      } else {\n        applyHash(hashes['R'][H1]);\n        applyBoardHash(hashes['R'][H1]);\n      }\n    } else if (op === 'k' && Math.abs(t - o) === 2) {\n      const kp = (t + o) / 2;\n      applyHash(hashes.bc[0]);\n      applyHash(hashes.bc[1]);\n      applyHash(hashes.kp[kp]);\n\n      applyHash(hashes['r'][kp]);\n      applyBoardHash(hashes['r'][kp]);\n      if (t < o) {\n        applyHash(hashes['r'][A8]);\n        applyBoardHash(hashes['r'][A8]);\n      } else {\n        applyHash(hashes['r'][H8]);\n        applyBoardHash(hashes['r'][H8]);\n      }\n    } else {\n      const helper = (p) => {\n        switch (p) {\n          case A1: if (this.wc[0]) applyHash(hashes.wc[0]); break;\n          case H1: if (this.wc[1]) applyHash(hashes.wc[1]); break;\n          case A8: if (this.bc[0]) applyHash(hashes.bc[0]); break;\n          case H8: if (this.bc[1]) applyHash(hashes.bc[1]); break;\n          default: break;\n        }\n      }\n      helper(o);\n      helper(t);\n\n      // pawn stuff\n      if (op === 'P') {\n        // hash en passant\n        if (t - o === -16) applyHash(hashes.epFile[((t + o) / 2) % 8]);\n        else if (t === this.ep) {\n          tp = (this.board[t + 8]: any);\n          applyHash(hashes[tp][t + 8]);\n          applyBoardHash(hashes[tp][t + 8]);\n        } else if (t <= H8) {\n          applyHash(hashes[op][t]);\n          applyHash(hashes[promo || 'Q'][t]);\n          applyBoardHash(hashes[op][t]);\n          applyBoardHash(hashes[promo || 'Q'][t]);\n        }\n      } else if (op === 'p') {\n        if (t - o === 16) applyHash(hashes.epFile[((t + o) / 2) % 8]);\n        else if (t === this.ep) {\n          tp = (this.board[t - 8]: any);\n          applyHash(hashes[tp][t - 8]);\n          applyBoardHash(hashes[tp][t - 8]);\n        } else if (t >= A1) {\n          applyHash(hashes[op][t]);\n          applyHash(hashes[promo || 'q'][t]);\n          applyBoardHash(hashes[op][t]);\n          applyBoardHash(hashes[promo || 'q'][t]);\n        }\n      }\n    }\n    return [newHash, newBoardHash];\n  }\n\n  hashNullMove(): Hash {\n    const newHash: Hash = (this.hash.slice(): any); // copy old hash\n    const applyHash = (hashParam: Hash) => {\n      newHash[0] ^= hashParam[0];\n      newHash[1] ^= hashParam[1];\n    }\n\n    // if this position has an en passant or king passant, unhash it\n    if (this.ep !== -1) applyHash(hashes.epFile[this.ep % 8]);\n    if (this.kp !== -1) applyHash(hashes.kp[this.kp]);\n\n    applyHash(hashes.turn);\n\n    return newHash;\n  }\n\n  hashBoard(): Hash {\n    const hash: Hash = [0, 0];\n\n    for (let i = 0; i < 64; i++) {\n      const p = this.board[i];\n      if (p) {\n        // apply hash\n        hash[0] ^= hashes[p][i][0];\n        hash[1] ^= hashes[p][i][1];\n      }\n    }\n    return hash;\n  }\n\n  /**\n   * Checks if a move is valid.\n   */\n  valid(move: Move): boolean {\n    const moves = this.genMoves(); // generator\n    let el = moves.next();\n    while (!el.done) {\n      if (move[0] === el.value[0] && move[1] === el.value[1]) {\n        const nextPos = this.move(move);\n        const nextMoves = nextPos.genMoves();\n        let nextEl = nextMoves.next();\n        while (!nextEl.done) {\n          // check if the move was an invalid castle\n          if (nextPos.kp !== -1 && Math.abs(nextEl.value[1] - nextPos.kp) < 2) {\n            return false;\n          }\n          // check if the move results in king being taken\n          const tp = nextPos.board[nextEl.value[1]];\n          if (tp !== null && 'Kk'.includes(tp)) return false;\n          nextEl = nextMoves.next();\n        }\n        // if it passed all the tests, return true\n        return true;\n      }\n      el = moves.next();\n    }\n    return false;\n  }\n\n  /** Returns true if color is in check. If square is provided,\n      checks if that square is threatened. */\n  inCheck(color: Color = this.turn): boolean {\n    let mySteps; // steps for different pieces\n    let pawnSteps;\n    let pawn;\n    let kingSquare;\n    if (color === WHITE) {\n      // square position of king\n      kingSquare = this.board.indexOf('K');\n\n      mySteps = {\n        'bq': steps.B,\n        'rq': steps.R,\n        'n': steps.N,\n      };\n      pawn = 'p';\n      pawnSteps = [S + W, S + E];\n    } else {\n      kingSquare = this.board.indexOf('k');\n\n      mySteps = {\n        'BQ': steps.B,\n        'RQ': steps.R,\n        'N': steps.N,\n      }\n      pawn = 'P';\n      pawnSteps = [N + W, N + E];\n    }\n\n    // search all steps for all pieces\n    for (const key in mySteps) {\n      for (let i = 0; i < mySteps[key].length; i++) {\n        let t = kingSquare + mySteps[key][i];\n        while (t >= 0 && t <= 63 && colDif(t, t - mySteps[key][i]) < 6) {\n          if (this.board[t]) {\n            if (key.includes(this.board[t])) return true;\n            // pawns get special treatment\n            if (this.board[t] === pawn &&\n              (kingSquare === t + pawnSteps[0] ||\n              kingSquare === t + pawnSteps[1])) {\n              return true;\n            }\n            break;\n          }\n\n          if ('Nn'.includes(key)) break;\n          t += mySteps[key][i];\n        }\n      }\n    }\n    return false;\n  }\n\n  // Get fen of the position (fullMove set to 1)\n  toString() {\n    let fen = '';\n    let spaces = 0;\n    for (let i = 0; i < 64; i++) {\n      if (this.board[i] === null) spaces++;\n      else {\n        if (spaces > 0) {\n          fen += spaces;\n          spaces = 0;\n        }\n        fen += this.board[i];\n      }\n      if (i % 8 === 7) {\n        if (spaces > 0) {\n          fen += spaces;\n          spaces = 0;\n        }\n        if (i < 63) fen += '/';\n      }\n    }\n\n    fen += ' ';\n    if (this.turn === WHITE) fen += 'w';\n    else fen += 'b';\n\n    fen += ' ';\n    if (!this.wc[0] && !this.wc[1] && !this.bc[0] && !this.bc[1]) fen += '-';\n    else {\n      if (this.wc[1]) fen += 'K';\n      if (this.wc[0]) fen += 'Q';\n      if (this.bc[1]) fen += 'k';\n      if (this.bc[0]) fen += 'q';\n    }\n\n    fen += ' ';\n    if (this.ep !== -1) fen += squareToString(this.ep);\n    else fen += '-';\n\n    fen += ' ';\n    fen += this.halfMoveClock;\n\n    fen += ' ';\n    fen += 1; // fullMove\n\n    return fen;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/jackfish/Position.js","/**\n * @module AI\n * The \"AI\", or computer mover.\n * @flow\n */\n\nimport Position, { A1, H8 } from './Position';\nimport { Cwf } from './tp'\nimport { PIECE } from './evaluation';\nimport { next } from './helpers';\nimport { PIECES } from './declarations';\n\nimport type { Move, Piece, History, Hash } from './declarations';\n\n// best moves for a position in reverse order\ntype Pv = [Move, Piece | void] | void;\n\n// Constants and types.\n\n// If value of position is > this, it means previous move was invalid\nconst MAX_SCORE = 15 * PIECE.Q; // with margin\n// How much to move alpha and beta in the mtd(f) until we have failed\n// both high and low\nconst SEARCH_MARGIN = 50;\n\n// fail low, high, hit exact (between alpha and beta) or invalid position\nconst L = 'L';\nconst E = 'E';\nconst H = 'H';\n\ntype Entry = {\n  pv: Pv, // moves previously beat alpha, from worst to best\n  score: number,\n  depth: number,\n  fail: 'L' | 'E' | 'H'\n};\n\nconst tp: Cwf<Entry> = new Cwf(1e7);\nconst boardTable: any = new Cwf(1e3); // table to find repeated positions\n\n// add methods to boardTable\nboardTable.push = function(hash: Hash) {\n  let count = this.get(hash); // if this position has been visited before\n  if (count !== undefined) this.add(hash, count + 1);\n  else this.add(hash, 1);\n}\nboardTable.pull = function(hash: Hash) {\n  let count = this.get(hash); // if this position has been visited before\n  if (count !== undefined && count > 0) this.add(hash, count - 1);\n}\n\n/* eslint-disable */\n// Data structure for storing killer moves (not pawn promotions)\nclass Killer {\n  origins: { [number]: { [number]: boolean } } = {};\n  constructor() {\n    return this;\n  }\n\n  add(move: Move) {\n    if (this.origins[move[0]]) this.origins[move[0]][move[1]] = true;\n    else {\n      this.origins[move[0]] = {};\n      this.origins[move[0]][move[1]] = true;\n    }\n  }\n\n  forEach(pos, callBack: (move: Move, tp: ?Piece) => boolean) {\n    for (const o in this.origins) {\n      for (const t in this.origins[o]) {\n        // TODO: Implement pseudo valid method on Position class and use\n        // here, then if it is pseudo-valid, call callback with the move\n      }\n    }\n  }\n}\n/* eslint-enable */\n\n// Logs\nlet tpHits = 0;\nlet searched = 0; // how many positions searched\n\nlet timeLimit;\nlet gotMove = false; // must have failed high or exact once to get a move\nconst timeout = () => Date.now() > timeLimit && gotMove;\n\n// Helper functions\n\n// Calls a callback function for all moves (as arguments) generated by genMoves,\n// including all 4 promotion moves for promotions. Runs through pv moves first.\n// if callback returns true, breaks. Returns true if there were any moves\n// generated, else false.\nfunction forMoves(pos: Position, pv: Pv,\n  callback: (move: Move, promo?: Piece, tp: ?Piece) => boolean): void {\n  if (pv) {\n    const move = pv[0];\n    let tp;\n    if (move[1] === pos.ep) {\n      if (pos.board[move[0]] === 'P') tp = pos.board[pos.ep + 8];\n      else if (pos.board[move[0]] === 'p') tp = pos.board[pos.ep - 8];\n      else tp = pos.board[move[1]];\n    } else tp = pos.board[move[1]];\n\n    if (callback(pv[0], pv[1], tp)) return; // move, promo\n  }\n\n  const moves = pos.genMoves();\n  let el = moves.next();\n  if (el.done) return; // if there are no valid moves\n\n  while (!el.done) {\n    const move = el.value;\n    let tp;\n    if (move[1] === pos.ep) {\n      if (pos.board[move[0]] === 'P') tp = pos.board[pos.ep + 8];\n      else tp = pos.board[pos.ep - 8];\n    } else tp = pos.board[move[1]];\n\n    if (pos.board[move[0]] === 'P' && move[1] <= H8) {\n      const promos = 'QNRB';\n      for (let i = 0; i < promos.length; i++) {\n        if (callback(move, (promos.charAt(i): any), tp)) return;\n      }\n    } else if (pos.board[move[0]] === 'p' && move[1] >= A1) {\n      const promos = 'qnrb';\n      for (let i = 0; i < promos.length; i++) {\n        if (callback(move, (promos.charAt(i): any), tp)) return;\n      }\n    } else if (callback(move, undefined, tp)) return;\n    el = moves.next();\n  }\n}\n\n// Check if a positino is stalemate. Assumes nobody is in check.\n// Promotion piece doesn't matter.\nfunction inStalemate(pos: Position) {\n  const moves = pos.genMoves();\n  let el = moves.next();\n  while (!el.done) {\n    // don't try castling, if the castle is valid, there is also a valid\n    // king move that don't gets you in check\n    // $FlowFixMe\n    if ('Kk'.includes(pos.board[el.value[0]]) && Math.abs(el.value[1] - el.value[0]) === 2) {\n      el = moves.next();\n      continue;\n    }\n\n    // if a move didn't get your king killed\n    if (!pos.move(el.value).inCheck(pos.turn)) {\n      return false; // not stalemate\n    }\n    el = moves.next();\n  }\n  return true; // stalemate\n}\n\nexport function getPieces(pos: Position) {\n  const pieces: Object = {};\n  PIECES.forEach((e) => { pieces[e] = 0 });\n  for (let i = 0; i < 64; i++) {\n    const p = pos.board[i];\n    if (p) pieces[p]++;\n  }\n  pieces.new = function(takenPiece?: Piece) {\n    const newPieces = Object.assign({}, this);\n    if (takenPiece) newPieces[takenPiece]--;\n    return newPieces;\n  }\n  pieces.endgame = function() {\n    if (this.Q > 0) {\n      if (this.R > 0 || this.B + this.N > 1) return false;\n    }\n    if (this.q > 0) {\n      if (this.r > 0 || this.b + this.n > 1) return false;\n    }\n    return true;\n  }\n  pieces.insufficientMaterial = function() {\n    return this.Q === 0 && this.q === 0 &&\n      this.P === 0 && this.p === 0 &&\n      this.R === 0 && this.r === 0 &&\n      (this.B === 0 || (this.B === 1 && this.N === 0)) &&\n      (this.b === 0 || (this.b === 1 && this.n === 0));\n  }\n\n  return pieces;\n}\n\n// Main algorithm\n\n// generic alpha-beta algorithm, doesn't assume mtd(f) search\nfunction alphaBeta(\n  pos: Position,\n  depth: number,\n  alpha: number,\n  beta: number,\n  pieces: Object,\n  root: boolean = false): number {\n  searched++;\n  if (depth < 0) depth = 0;\n\n  // draw\n  if (pos.halfMoveClock >= 50) {\n    return 0;\n  }\n  if (boardTable.get(pos.boardHash) >= 3) {\n    return 0;\n  }\n\n  let stalemate = true; // true until proven otherwise\n  let pv: Pv; // default\n\n  // look up in tp\n  let entry: any = tp.get(pos.hash); // previous entry\n  if (entry) {\n    pv = entry.pv;\n    if (entry.depth >= depth) {\n      tpHits++;\n      switch (entry.fail) {\n        case L:\n          if (entry.score <= alpha) return alpha;\n          break;\n        case E:\n          return entry.score;\n        case H:\n          if (entry.score >= beta) return beta\n          break;\n        default: break;\n      }\n    }\n  }\n\n  // renew entry, use the previous pv as default\n  entry = (tp.add(pos.hash,\n    { pv: pv, score: alpha, depth: depth, fail: L }): Entry);\n\n  // Determine if we're in endgame.\n  // Endgame begins when any side that has a queen has one other minorpiece maximum.\n  // Disable delta pruning, change king pst and look for stalemates.\n  const endgame: boolean = pieces.endgame();\n  if (endgame && pieces.insufficientMaterial()) {\n    entry.score = 0;\n    entry.fail = E;\n    return 0;\n  }\n\n  // Callback helper\n  const handleMove = (move, promo?, score) => {\n    // if time's out\n    if (timeout()) return true;\n\n    // must be a beta cutoff since it's a null window search\n    if (score > alpha) {\n      entry.fail = H\n      stalemate = false; // my move was valid\n      entry.pv = [move, promo]; // new pv\n\n      if (score >= MAX_SCORE) alpha = MAX_SCORE;\n      else alpha = beta;\n\n      return true;\n    } else if (score > -MAX_SCORE) stalemate = false; // if my move was valid\n    return false;\n  };\n\n  // quiescence search ( 2 * PIECE.P (200 centipawns) is the margin)\n  if (depth <= 0) {\n    // null move beta cutoff\n    if (pos.score >= beta) {\n      // if no moves gets you out of check, this position will fail low\n      if (pos.inCheck()) {\n        stalemate = false;\n\n        // test all moves\n        forMoves(pos, pv, (move, promo, tp) => {\n          // tp here is target piece, not transposition table\n          const nextPos = pos.move(move, promo);\n          // if this move got rid of the check threat (if the move after\n          // can't take king)\n          if (!nextPos.inCheck(pos.turn)) {\n            boardTable.push(nextPos.boardHash);\n            const score = -alphaBeta(nextPos, 0, -beta, -alpha, pieces.new(tp));\n            boardTable.pull(nextPos.boardHash);\n            return handleMove(move, promo, score);\n          } else return false;\n        });\n      } else if (endgame && inStalemate(pos)) {\n        entry.score = 0;\n        entry.fail = E;\n        return 0;\n      } else {\n        entry.score = beta;\n        entry.fail = H;\n        return beta;\n      }\n    } else if (pos.score + PIECE.Q < alpha) {\n      if (pos.inCheck(next(pos.turn))) {\n        entry.fail = H;\n        entry.score = MAX_SCORE;\n        return MAX_SCORE; // king take or invalid castle\n      } else if (endgame && !pos.inCheck() && inStalemate(pos)) {\n        entry.score = 0;\n        entry.fail = E;\n        return 0;\n      }\n      // Might wanna try moves that check here later.\n\n      return alpha; // delta pruning\n    } else {\n      forMoves(pos, pv, (move, promo, tp) => {\n        // check if there was an invalid castle (saves time to do it here)\n        if (pos.kp !== -1 && Math.abs(pos.kp - move[1]) < 2) {\n          alpha = MAX_SCORE;\n          entry.fail = H;\n          return true;\n        }\n\n        // don't test silent moves\n        if (!pos.board[move[1]] && !(move[1] === pos.ep &&\n          'Pp'.includes((pos.board[move[0]]: any)))) return false;\n\n        const nextScore = pos.score + pos.value(move, promo);\n        // check if it's a king-take move, if it is we save a lot of time\n        if (nextScore >= MAX_SCORE) {\n          alpha = MAX_SCORE;\n          entry.fail = H;\n          return true;\n        }\n\n        // delta pruning\n        if ((pos.board[move[1]] || move[1] === pos.ep) && nextScore + 2 * PIECE.P >= alpha) {\n          // passes margin and not silent positon, search deeper\n          const nextPos = pos.move(move, promo, -nextScore);\n          boardTable.push(nextPos.boardHash);\n          const score = -alphaBeta(nextPos, 0, -beta, -alpha, pieces.new(tp));\n          boardTable.pull(nextPos.boardHash);\n          return handleMove(move, promo, score);\n        }\n        return false; // let forMoves() keep running\n      });\n      // if stalemate is still true, we know no valid moves were tested,\n      // but we don't know if there were no valid moves\n      // and therefore we should just return the score of this position\n      if (stalemate && alpha < beta) {\n        entry.fail = E;\n        entry.score = pos.score;\n        return pos.score;\n      }\n    }\n  } else {\n    // depth >= 1\n\n    // futiity pruning (use when searching deeper, not yet, need\n    // to watch out for king-take moves)\n    if (!root && depth === 1 && pos.score + PIECE.Q < alpha) {\n      if (pos.inCheck(next(pos.turn))) {\n        entry.score = MAX_SCORE;\n        entry.fail = H\n        return MAX_SCORE; // if you can take king\n      } else if (endgame && inStalemate(pos)) {\n        entry.score = 0;\n        entry.fail = E;\n        return 0;\n      }\n      return alpha;\n    }\n\n    // don't do nullmove at root or in endgame\n    // if in check, will not fail high\n    let score;\n    if (!root && !endgame) {\n      score = -alphaBeta(pos.nullMove(), depth - 3, -beta, -alpha, pieces.new());\n      if (score >= beta) {\n        entry.score = beta;\n        entry.fail = H;\n        return beta;\n      }\n    }\n\n    forMoves(pos, pv, (move, promo) => {\n      const nextScore = pos.score + pos.value(move, promo);\n      // check if it's a king-take move or if the previous move was an invalid\n      // castle, if it is we save a lot of time\n      if (nextScore >= MAX_SCORE) {\n        alpha = MAX_SCORE;\n        entry.fail = H;\n        return true;\n      }\n\n      if (depth === 1 && nextScore + 2 * PIECE.P < alpha) return false;\n\n      const nextPos = pos.move(move, promo, -nextScore);\n      boardTable.push(nextPos.boardHash);\n      const score = -alphaBeta(nextPos, depth - 1, -beta, -alpha, pieces.new());\n      boardTable.pull(nextPos.boardHash);\n      return handleMove(move, promo, score);\n    });\n  }\n\n  if (stalemate && endgame) {\n    if (!pos.inCheck() && inStalemate(pos)) {\n      entry.score = 0;\n      entry.fail = E;\n      return 0;\n    }\n  }\n\n  // could only have gotten a better score, we got interrupted\n  if (timeout()) {\n    entry.fail = H;\n  }\n\n  // alpha should have been changed to beta on beta cutoff\n  entry.score = alpha;\n  return alpha;\n}\n\n// return bound in case of timeout\nfunction mtdf(pos: Position, depth: number, guess: number): [number, number] {\n  const bound = { lower: -MAX_SCORE, upper: MAX_SCORE };\n  let f = guess;\n  let beta = f - 2 * SEARCH_MARGIN; // start lower to fail high earlier\n\n  const pieces = getPieces(pos);\n\n  do {\n    // find a window of size margin, then do a binary search in it\n    if (bound.lower !== -MAX_SCORE && bound.upper !== MAX_SCORE) {\n      if (bound.upper - bound.lower > 3) beta = Math.floor((bound.lower + bound.upper) / 2);\n      else beta = f + (f === bound.lower ? 1 : 0);\n    } else if (f === bound.lower) beta = f + SEARCH_MARGIN;\n    else if (f === bound.upper) beta = f - SEARCH_MARGIN;\n\n    f = alphaBeta(pos, depth, beta - 1, beta, pieces.new(), true);\n\n    if (f < beta) bound.upper = f;\n    else {\n      bound.lower = f;\n      gotMove = true;\n    }\n  } while (bound.lower <= bound.upper - 1 && !timeout()); // - 0.01 for floating point inaccuracy\n\n  return [bound.lower, bound.upper];\n}\n\n// Assumes there are valid moves.\n// @param time How many milliseconds to think. Min: 1000 Max. 60000\n// @returns [move, promo, stopReason]\nexport default async function move(pos: Position,\n  history: History,\n  time: number = 5000,\n  maxDepth: number = 100,\n  logs: Object,\n  betweenDepths?: () => Promise<any>): Promise<[Move, Piece | void, 'time' | 'depth']> {\n  let score = pos.score;\n  let bound;\n  let entry: any;\n\n  if (maxDepth < 1) maxDepth = 1;\n\n  // set up position table (for three-repeat rule)\n  history.forEach(e => {\n    boardTable.push(new Position(e.fen).boardHash);\n  });\n  boardTable.push(pos.boardHash);\n\n  if (time < 1000) time = 1000;\n  if (time > 60000) time = 60000\n\n  // timeLimit and timeOut() is defined globally higher up\n  timeLimit = Date.now() + time; // run for 5 sec\n\n  // reset logging information\n  logs.searched = 0;\n  logs.tpHits = 0;\n\n  // iterative deepening, start at depth 1\n  let i = 1;\n  while (i <= maxDepth && !timeout()) {\n    logs.depth = i;\n    if (betweenDepths) await betweenDepths();\n\n    // get the tp entry from the previous depth\n    if (i > 1) entry = tp.get(pos.hash);\n    bound = mtdf(pos, i, score);\n    // lower bound and upper bound will always be the same unless interrupted\n    score = bound[0];\n    i++;\n    logs.searched = searched;\n    logs.tpHits = tpHits;\n  }\n  const stopReason = timeout() ? 'time' : 'depth';\n  gotMove = false; // reset this\n  searched = 0;\n  tpHits = 0;\n\n  // compare entry from the latest depth (that got interrupted)\n  // to the entry from the depth before to see which one is best\n  const deepestEntry: any = tp.get(pos.hash); // should always be a hit\n  // if we didn't even finish depth 1, entry won't be defined\n  if (!entry ||\n    ((bound: any)[0] > entry.score) || // means we got a better move\n    ((bound: any)[1] < entry.score) // means the move we have is worse than we thought\n  ) entry = deepestEntry;\n\n  // clear transposition table between depths\n  tp.clear();\n  boardTable.clear();\n  const returnVal = entry.pv;\n  returnVal.push(stopReason);\n  return returnVal;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/jackfish/AI.js","/**\n * A javascript chess engine inspired by\n * [sunfish](https://github.com/thomasahle/sunfish) and\n * [chess.js](https://github.com/jhlywa/chess.js).\n * @module jackfish\n * @author Mattias Ahlsén (mattias.ahlsen@gmail.com)\n * @example\n * import Engine from 'jackfish';\n * const game = new Engine();\n *\n * @flow\n */\n\ntype Square = number | string;\n\nimport { PIECES, BLACK, WHITE } from './declarations';\nimport Position from './Position';\nimport { rank, parse, squareToString, equalBoards } from './helpers';\nimport aimove, { getPieces } from './AI';\n\nimport type { Board, Piece, Move, CR, History } from './declarations';\n\n/*\nThe board is represented as an array with indexes like this:\n8 |  0  1  2  3  4  5  6  7\n7 |  8  9  10 11 12 13 14 15\n6 |  16 17 18 19 20 21 22 23\n5 |  24 25 26 27 28 29 30 31\n4 |  32 33 34 35 36 37 38 39\n3 |  40 41 42 43 44 45 46 47\n2 |  48 49 50 51 52 53 54 55\n1 |  56 57 58 59 60 61 62 63\n  |_________________________\n     A  B  C  D  E  F  G  H\n\nPieces are represented as characters with uppercase letters for white pieces\nand lowercase for black pieces, as in FEN notation:\nPawn: 'P' and 'p'\nKnight: 'N' and 'n'\nBishop: 'B' and 'b'\nRook: 'R' and 'r'\nQueen: 'Q' and 'q'\nKing: 'K' and 'k'\n*/\n\n/**\n * Configuration object for the engine.\n * @name Options\n * @property {string?}   startPos     The FEN string of the starting position.\n * @property {Function?} betweenDepth Async function that returns a promise,\n *                                    that runs between every depth of the AI\n *                                    searches.\n * @property {number} searchTime      Time for the AI to search in seconds.\n * @example\n * const options = {\n *   startPos: 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1',\n     betweenDepths: ''\n * }\n */\nexport type Options = {\n  startPos?: string,\n  searchTime?: number,\n  betweenDepths?: () => Promise<any>,\n};\n\ntype Config = {\n  startPos: string,\n  searchTime: number,\n  betweenDepths?: () => Promise<any>,\n};\n\nconst defaultConfig: Config = {\n  startPos: 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1',\n  searchTime: 6,\n};\n\n/**\n * The chess engine, including game mechanics and\n * a configurable AI. (default export)\n * @example const game = new Engine();\n * @param options Configuration object.\n * @param {string}\n * [options.startPos='rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1']\n * @param {number}\n * [options.searchTime=4]\n * See {@link Options}.\n *\n * @return {Engine}\n */\nexport default class Engine {\n  config: Config = defaultConfig;\n  history: History = [];\n  position: Position;\n  fullMove: number;\n\n  aiInfo: {\n    depth: number,\n    searched: number,\n    tpHits: number,\n  } = ({\n    depth: 0,\n    searched: 0,\n    tpHits: 0,\n  }: any);\n\n  betweenDepths: () => Promise<any>;\n\n  constructor(options?: Options) {\n    if (options) this.configure(options);\n    this.setPos(this.config.startPos);\n  }\n\n  /**\n   * Configurate the engine (only changes passed properties).\n   * @example\n   * // set starting position to standard\n   * game.configure({ startPos: 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1' });\n   * @param options   Same type of configuration object passed to\n   *                  constructor.\n   */\n  configure(options: Options): void {\n    for (const key in options) {\n      this.config[key] = options[key];\n    }\n  }\n\n  /**\n   * Get the current configuration, including all default values.\n   * @return The configuration object.\n   */\n  getConfig(): Config {\n    return this.config;\n  }\n\n  /**\n   * Changes to the new position and clears history array.\n   * @param fen The FEN string of the position to be set.\n   * @return True if the FEN string was valid enough and the position was\n   *         successfully changed.\n   */\n  setPos(fen: string): boolean {\n    const board: Board = [];\n    let turn;\n    let wc: CR = [false, false];\n    let bc: CR = [false, false];\n    let ep = -1; // default is none\n    let kp = -1;\n    let halfMoveClock;\n    let fullMove;\n\n    const subs = fen.trim().split(/ +/); // get substrings\n    if (subs.length !== 6) return false;\n\n    let pos = 0; // current board position (square)\n    let i = 0; // index of string\n    // The board array is indexed the same way as FEN notation.\n    while (i < subs[0].length) {\n      let c = subs[0].charAt(i); // currently parsed char\n      const num = parseInt(c);\n      if (Number.isInteger(num) && num > 0) {\n        if (num > 8 - pos % 8) return false;\n        for (let j = 0; j < num; j++) {\n          board[pos + j] = null;\n        }\n        pos += num;\n      } else if (PIECES.includes(c)) {\n        // Cast to piece when we know it is one.\n        c = ((c: any): Piece)\n        board[pos] = c;\n        pos++;\n      } else {\n        return false; // invalid FEN\n      }\n      i++;\n      if (pos >= 64) break; // should not be able to be bigger than 64\n      else if (pos % 8 === 0) {\n        if (subs[0].charAt(i) !== '/') return false;\n        i++;\n      }\n    }\n    if (fen.charAt(i) !== ' ') return false;\n\n    switch (subs[1]) {\n      case 'w': turn = WHITE; break;\n      case 'b': turn = BLACK; break;\n      default: return false;\n    }\n\n    if (subs[2] !== '-') {\n      if (subs[2].length > 4) return false;\n      const used = [];\n      for (let i = 0; i < subs[2].length; i++) {\n        const c = subs[2].charAt(i);\n        if (used.includes(c)) return false; // may only occur once\n        switch (c) {\n          case 'Q': wc[0] = true; break;\n          case 'K': wc[1] = true; break;\n          case 'q': bc[1] = true; break;\n          case 'k': bc[0] = true; break;\n          default: return false;\n        }\n        used.push(c);\n      }\n    }\n\n    if (subs[3] !== '-') {\n      ep = parse(subs[3]);\n      const r = rank(ep);\n      if (isNaN(ep)) return false;\n      if (r !== 3 && r !== 6) return false;\n    }\n\n    halfMoveClock = parseInt(subs[4]);\n    fullMove = parseInt(subs[5]);\n    if (!(Number.isInteger(halfMoveClock) && halfMoveClock >= 0)) return false;\n    if (!(Number.isInteger(fullMove) && fullMove > 0)) return false;\n\n    // if we've made it this far, we're golden\n    this.fullMove = fullMove;\n    this.position = new Position(board, turn, wc, bc, ep, kp, halfMoveClock);\n    this.history = [];\n    return true;\n  }\n\n  validFen(fen: string) {\n    const dummy = new this.constructor();\n    return dummy.setPos(fen);\n  }\n\n  /**\n   * Returns the FEN representation of the game.\n   * @return The FEN string.\n   */\n  fen(): string {\n    const pos = this.position;\n    const board = pos.board;\n    let fen = '';\n    let spaces = 0;\n    for (let i = 0; i < 64; i++) {\n      if (board[i] === null) spaces++;\n      else {\n        if (spaces > 0) {\n          fen += spaces;\n          spaces = 0;\n        }\n        fen += board[i];\n      }\n      if (i % 8 === 7) {\n        if (spaces > 0) {\n          fen += spaces;\n          spaces = 0;\n        }\n        if (i < 63) fen += '/';\n      }\n    }\n\n    fen += ' ';\n    if (pos.turn === WHITE) fen += 'w';\n    else fen += 'b';\n\n    fen += ' ';\n    if (!pos.wc[0] && !pos.wc[1] && !pos.bc[0] && !pos.bc[1]) fen += '-';\n    else {\n      if (pos.wc[1]) fen += 'K';\n      if (pos.wc[0]) fen += 'Q';\n      if (pos.bc[1]) fen += 'k';\n      if (pos.bc[0]) fen += 'q';\n    }\n\n    fen += ' ';\n    if (pos.ep !== -1) fen += squareToString(pos.ep);\n    else fen += '-';\n\n    fen += ' ';\n    fen += pos.halfMoveClock;\n\n    fen += ' ';\n    fen += this.fullMove;\n\n    return fen;\n  }\n\n  /**\n   * Moves from position o to position t, making sure it's a valid move.\n   * Positions can be on the form 0 for A8, 7 for H8, ..., 56 for A1,\n   * 63 for H1, or simply on the form 'a1', 'b7', etc...\n   * @param o Origin position.\n   * @param t Target position.\n   * @return True if it was a valid move.\n   */\n  move(o: Square, t: Square, promo?: Piece): boolean {\n    // parse() returns NaN for invalid position strings\n    o = (parse(o): number);\n    t = (parse(t): number);\n\n    // check that promotion piece is valid if there is one\n    if (promo) {\n      if (this.position.turn === WHITE) {\n        if (!'QNRB'.includes(promo)) return false;\n      } else if (!'qnrb'.includes(promo)) return false;\n    }\n\n    if (this.valid(o, t)) {\n      this.history.push({fen: this.fen(), move: [o, t]});\n      this.position = this.position.move([o, t], promo);\n      if (this.position.turn === WHITE) this.fullMove += 1;\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Undoes the latest move if there is one.\n   * @return The move that was undone on the form [origin, target] or null if\n   * there were no previous moves.\n   */\n  undoMove(): Move | null {\n    const history = this.history; // save this, setPos() clears it\n    const last = history.pop();\n    if (last) {\n      this.setPos(last.fen);\n      this.history = history; // need to set this because setPos() clears it\n      return last.move;\n    }\n    return null;\n  }\n\n  /**\n   * Get winner if there is one.\n   */\n  winner(): 'white' | 'black' | 'draw' | null {\n    if (this.inCheckMate()) {\n      if (this.position.turn === WHITE) return 'black';\n      else return 'white';\n    }\n\n    if (this.fiftyMoves() || this.inThreefoldRepetition() ||\n      this.inStaleMate() || this.insuffMaterial()) return 'draw'\n\n    return null;\n  }\n\n  insuffMaterial() {\n    return getPieces(this.position).insufficientMaterial();\n  }\n\n  /** Returns true if in draw according to fifty move rule. */\n  fiftyMoves(): boolean {\n    return this.position.halfMoveClock >= 50;\n  }\n\n  /** Returns true if the current board position has ocurred 3 or more times. */\n  inThreefoldRepetition(): boolean {\n    let count = 1; // starts at 1 because current position is 1 occurence\n    for (let i = 0; i < this.history.length; i++) {\n      const game = new Engine();\n      game.setPos(this.history[i].fen);\n      if (equalBoards(game.position.board, this.position.board)) {\n        count++;\n        if (count === 3) return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Check if side to move is in checkmate.\n   */\n  inCheckMate(): boolean {\n    return this.moves().length === 0 && this.position.inCheck();\n  }\n\n  /**\n   * Check if in stalemate.\n   */\n  inStaleMate(): boolean {\n    return this.moves().length === 0 && !this.position.inCheck();\n  }\n\n  /** Returns an array of valid moves. Only returns one move for promotions. */\n  moves(): Array<Move> {\n    const moves = [];\n    const generator = this.position.genMoves(); // move generator\n    let el = generator.next();\n    while (!el.done) {\n      if (this.position.valid(el.value)) moves.push(el.value);\n      el = generator.next();\n    }\n    return moves;\n  }\n\n  /**\n   * Returns true if a move is valid.\n   */\n  valid(o: Square, t: Square): boolean {\n    o = parse(o);\n    t = parse(t);\n\n    return this.position.valid([o, t]);\n  }\n\n  /**\n   * Sets position to the starting position set in config.startingPos (default\n   * is normal starting position).\n   */\n  restart(): void {\n    this.setPos(this.config.startPos);\n  }\n\n  /**\n   * Let the AI make a move. If there are no valid moves, return null.\n   * @return The move that was made.\n   */\n  async aiMove(maxDepth?: number): Promise<[Move, Piece | void, 'time' | 'depth' ] | void> {\n    console.log('check')\n    return\n    // This implies that there are valid moves to be made.\n    if (this.winner() !== null) return;\n\n    const move = await aimove(this.position, this.history,\n      this.config.searchTime * 1000, maxDepth, this.aiInfo, this.config.betweenDepths);\n    if (move) {\n      this.move(move[0][0], move[0][1], move[1]);\n\n      return move;\n    } else throw new Error('The AI failed to make a move');\n  }\n\n  /**\n   * Returns whose turn it is.\n   * @return turn\n   */\n  turn(): 'white' | 'black' {\n    if (this.position.turn === WHITE) return 'white';\n    else return 'black';\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/jackfish/index.js","<template>\n  <div>\n    <div class=\"content\">\n      <Promotion v-if=\"promotion\" :pos=\"promotion.pos\" :board=\"$refs.board\"\n        :color=\"promotion.color\" @done=\"handlePromotion\">\n      </Promotion>\n      <div id=\"board\" ref=\"board\" @click=\"cancel\" touch-action=\"none\">\n      </div>\n\n      <div class=\"info\">\n        <h1>Jackfish</h1>\n        <h2>A chess engine in javascript.</h2>\n        <div class=\"game-status col-sm-6\">\n          <h3 v-if=\"winner === 'white'\">The winner is\n            <span class=\"white\">white</span></h3>\n          <h3 v-else-if=\"winner === 'black'\">The winner is\n            <span class=\"black\">black</span></h3>\n          <h3 v-else-if=\"winner === 'draw'\">It's a draw</h3>\n          <h3 v-else :style=\"{ visibility: 'hidden' }\">\n            Game is still running.\n          </h3>\n\n          <button type=\"button\" class=\"btn btn-light\" @click=\"undoMove\">\n            Undo move\n          </button>\n          <button type=\"button\" class=\"btn btn-light\" @click=\"restart\">\n            Restart\n          </button>\n\n          <!--\n          <div class=\"mt-3\">\n            <h6>AI search time (s)</h6>\n            <div class=\"mb-2\"><input v-model=\"game.config.searchTime\"></div>\n            <button type=\"button\" class=\"btn btn-outline-success\" @click=\"setTime(2)\">Easy</button>\n            <button type=\"button\" class=\"btn btn-outline-warning\" @click=\"setTime(4)\">Medium</button>\n            <button type=\"button\" class=\"btn btn-outline-danger\"  @click=\"setTime(6)\">Hard</button>\n          </div>\n          -->\n\n          <div class=\"mt-3\">\n            <h6>Fen of starting position.</h6>\n            <div><input v-model=\"startPos\" class=\"fen\"></div>\n            <button class=\"btn btn-dark\" @click=\"setStartPos\">Set position</button>\n            <button class=\"btn btn-dark\" @click=\"resetStartPos\">Reset</button>\n            <p v-if=\"invalidStartPos\" class=\"text-danger\">Invalid FEN string</p>\n          </div>\n\n          <div class=\"mt-3\">\n            <h6>\n              <a href=\"https://en.wikipedia.org/wiki/Forsyth%E2%80%93Edwards_Notation\">\n                FEN\n              </a> of board\n            </h6>\n            <div><input v-model=\"fen\" class=\"fen\"></div>\n            <button class=\"btn btn-dark\" @click=\"setPos\">Set position</button>\n            <p v-if=\"invalidFen\" class=\"text-danger\">Invalid FEN string</p>\n          </div>\n\n          <div class=\"mt-3\">\n            <p><strong>Depth:</strong> {{aiInfo.depth}}</p>\n            <p><strong>Nodes searched:</strong> {{aiInfo.searched}}</p>\n            <p><strong>Hits in transposition table:</strong> {{aiInfo.tpHits}}</p>\n          </div>\n        </div>\n\n        <div class=\"col-sm-6 links\">\n          <h3>About</h3>\n          <p>\n            This is a chess engine I've built in javascript. The \"AI\" uses\n            <a href=\"https://chessprogramming.wikispaces.com/MTD%28f%29\">mtd(f)</a>.\n            All rules apply: insufficient material, fifty-move rule, threefold\n            repetition etc, and the AI recognizes all these as draws and evaluates\n            them accordingly. See more below.\n          </p>\n          <a class=\"btn btn-primary btn-lg\" href=\"https://github.com/mattiasahlsen/jackfish/\" role=\"button\">\n            Github repo\n          </a>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"about mt-4 mb-4\">\n      <h4 class=\"mt-3\">Features</h4>\n      <ul>\n        <li>\n          <a href=\"https://chessprogramming.wikispaces.com/Simplified+evaluation+function\">\n            Piece-square table evaluation\n          </a>\n        </li>\n        <li class=\"\">\n          <a href=\"https://chessprogramming.wikispaces.com/MTD%28f%29\">\n            MTD(f)\n          </a>\n        </li>\n        <li class=\"\">\n          <a href=\"https://chessprogramming.wikispaces.com/Alpha-Beta\">\n            Alpha-beta\n          </a>\n        </li>\n        <li class=\"\">\n          <a href=\"https://chessprogramming.wikispaces.com/Iterative+Deepening\">\n            Iterative deepening\n          </a>\n        </li>\n        <li class=\"\">\n          <a href=\"https://chessprogramming.wikispaces.com/Transposition%20Table#KeyCollisions\">\n            Transposition table\n          </a>\n        </li>\n        <li class=\"\">\n          <a href=\"https://chessprogramming.wikispaces.com/Quiescence+Search\">\n            Quiescence search\n          </a>\n        <li class=\"\">\n          <a href=\"https://chessprogramming.wikispaces.com/delta+pruning\">\n            Delta pruning\n          </a>\n        </li>\n      </ul>\n\n      <!--\n      <h4 class=\"mt-3\">To be implemented</h4>\n      <ul class=\"\">\n        <li class=\"\">\n          <a href=\"https://chessprogramming.wikispaces.com/Killer+Move\">\n            Killer heuristic\n          </a>\n        </li>\n        <li class=\"\">\n          <a href=\"https://chessprogramming.wikispaces.com/Pawn%20Structure\">\n            Pawn structure evaluation\n          </a>\n        </li>\n      </ul>\n      -->\n\n      <h4 class=\"mt-3\">Credits to</h4>\n      <div>\n        <a href=\"https://chessprogramming.wikispaces.com/\">https://chessprogramming.wikispaces.com/</a>\n      </div>\n      <div>\n        <a href=\"https://github.com/thomasahle/sunfish\">https://github.com/thomasahle/sunfish</a>\n      </div>\n      <div>\n      </div>\n    </div>\n\n    <p class=\"created-by\">Created by Mattias Ahlsén</p>\n  </div>\n</template>\n\n<script>\nimport Promotion from './Promotion';\n\n// Images for the chess board are copied to /static/img\nimport Chessboard from 'chessboardjs';\nimport 'chessboardjs/www/css/chessboard.css';\n\nimport Engine from '@/jackfish';\nimport { WHITE, BLACK } from '@/jackfish/declarations';\nimport { rank, parse } from '@/jackfish/helpers';\n\nconst game = new Engine();\n\nexport default {\n  name: 'Home',\n  components: {\n    Promotion,\n  },\n\n  data () {\n    return {\n      game: game,\n      promotion: null,\n      winner: game.winner(),\n      aiInfo: game.aiInfo,\n\n      fen: game.fen(),\n      startPos: game.config.startPos,\n      board: null,\n    };\n  },\n  computed: {\n    invalidFen() {\n      return !game.validFen(this.fen);\n    },\n    invalidStartPos() {\n      return !game.validFen(this.startPos);\n    },\n  },\n  watch: {\n    'game.position.board': function() {\n      this.board.position(this.game.fen(), true);\n      this.winner = this.game.winner();\n      this.fen = this.game.fen();\n    },\n    'game.position.turn': function() {\n      if (this.game.turn() === 'black' && this.game.winner() === null) {\n        const runAiMove = game => {\n          importScripts('/jackfish/AI.js')\n        }\n        setTimeout(() => this.$worker.run(runAiMove, []), 100);\n        //setTimeout(() => this.$worker.run(() => console.log('check')), 100);\n      }\n    },\n\n    'game.aiInfo': {\n      handler: function(val) { this.aiInfo = val; }, deep: true\n    }\n  },\n  mounted () {\n    this.game.configure({\n      betweenDepths: () => {\n        // nothing else works to force a re-render... Vue seems to be bugged.\n        return new Promise(resolve => setTimeout(resolve, 10));\n      },\n    })\n\n    this.onDragStart = (src, piece) => {\n      return (piece.charAt(0) === 'w' ? WHITE : BLACK) === this.game.position.turn &&\n      this.winner === null;\n    }\n\n    this.onDrop = (src, target, piece) => {\n      if (!this.game.valid(src, target)) return 'snapback';\n\n      // pawn promotion\n      const r = rank(parse(target));\n      if (piece.charAt(1) === 'P' && (r === 8 || r === 1)) {\n        const color = (piece.charAt(0) === 'w') ? WHITE : BLACK;\n        // this refers to the vue object\n        this.promotion = {\n          pos: parse(target),\n          color,\n          src,\n          target,\n        };\n        return;\n      }\n\n      this.game.move(src, target); // we already know it's valid\n    }\n    this.createBoard()\n    window.onresize = this.createBoard\n\n    this.$refs.board.ontouchmove = (event) => event.preventDefault()\n  },\n  methods: {\n    createBoard() {\n      //console.log($(window).width() * 0.9)\n      this.$refs.board.style.width = this.$refs.board.style.height =\n        Math.min($(window).height(), $(window).width() * 0.7) + 'px'\n\n      //console.log(this.game)\n      this.board = Chessboard('board', {\n        position: this.game.fen(),\n        draggable: true,\n        onDrop: this.onDrop,\n        onDragStart: this.onDragStart,\n      });\n    },\n    destroyBoard() {\n      if (this.board) this.board.destroy()\n      this.board = null\n    },\n    handlePromotion(piece) {\n      this.game.move(\n        this.promotion.src,\n        this.promotion.target,\n        piece\n      );\n      this.promotion = null;\n    },\n    cancel() {\n      // cancel pawn promotion primarily\n      this.promotion = null;\n      this.board.position(this.game.fen(), false);\n    },\n    undoMove() {\n      this.game.undoMove();\n      if (game.position.turn === BLACK) this.game.undoMove();\n    },\n    restart() {\n      this.game.restart();\n    },\n\n    setPos() {\n      if (this.game.setPos(this.fen)) this.fen = this.game.fen();\n    },\n    setStartPos() {\n      if (game.validFen(this.startPos)) {\n        this.game.configure({\n          startPos: this.startPos\n        });\n      }\n    },\n    resetStartPos() {\n      this.game.configure({\n        startPos: 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1',\n      });\n      this.startPos = this.game.config.startPos;\n    },\n    setTime(time) {\n      this.game.configure({\n        searchTime: time,\n      });\n    }\n  },\n}\n</script>\n\n<style scoped>\n.content {\n  width: 100%;\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n}\n#board {\n  touch-action: none;\n  margin-left: auto;\n  margin-right: auto;\n  flex-grow: 0;\n  flex-shrink: 0;\n}\n.info {\n}\n.game-status {\n  margin-left: auto;\n  margin-right: auto;\n}\n.game-status h3 {\n  color: #737373;\n}\n.white {\n  color: #a6a6a6;\n}\n.black {\n  color: #333333;\n}\n\n.fen {\n  width: 90%;\n  margin-bottom: 10px;\n}\n\n.links {\n  padding: 5px;\n  margin-left: auto;\n  margin-right: auto;\n}\n\n.about {\n  padding: 5px;\n  width: 100%;\n  background-color:\n}\n.created-by {\n  display: inline-block;\n  margin-right: 10px;\n}\n\nh1, h2 {\n  margin: 0;\n}\n\n</style>\n<style>\n/* custom board colors */\n.black-3c85d {\n  background-color: #002233 !important;\n}\n.white-1e1d7 {\n  background-color:#f2f2f2 !important;\n}\n.piece-417db {\n  cursor: pointer;\n}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/Home.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',{staticClass:\"content\"},[(_vm.promotion)?_c('Promotion',{attrs:{\"pos\":_vm.promotion.pos,\"board\":_vm.$refs.board,\"color\":_vm.promotion.color},on:{\"done\":_vm.handlePromotion}}):_vm._e(),_vm._v(\" \"),_c('div',{ref:\"board\",attrs:{\"id\":\"board\",\"touch-action\":\"none\"},on:{\"click\":_vm.cancel}}),_vm._v(\" \"),_c('div',{staticClass:\"info\"},[_c('h1',[_vm._v(\"Jackfish\")]),_vm._v(\" \"),_c('h2',[_vm._v(\"A chess engine in javascript.\")]),_vm._v(\" \"),_c('div',{staticClass:\"game-status col-sm-6\"},[(_vm.winner === 'white')?_c('h3',[_vm._v(\"The winner is\\n          \"),_c('span',{staticClass:\"white\"},[_vm._v(\"white\")])]):(_vm.winner === 'black')?_c('h3',[_vm._v(\"The winner is\\n          \"),_c('span',{staticClass:\"black\"},[_vm._v(\"black\")])]):(_vm.winner === 'draw')?_c('h3',[_vm._v(\"It's a draw\")]):_c('h3',{style:({ visibility: 'hidden' })},[_vm._v(\"\\n          Game is still running.\\n        \")]),_vm._v(\" \"),_c('button',{staticClass:\"btn btn-light\",attrs:{\"type\":\"button\"},on:{\"click\":_vm.undoMove}},[_vm._v(\"\\n          Undo move\\n        \")]),_vm._v(\" \"),_c('button',{staticClass:\"btn btn-light\",attrs:{\"type\":\"button\"},on:{\"click\":_vm.restart}},[_vm._v(\"\\n          Restart\\n        \")]),_vm._v(\" \"),_c('div',{staticClass:\"mt-3\"},[_c('h6',[_vm._v(\"Fen of starting position.\")]),_vm._v(\" \"),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.startPos),expression:\"startPos\"}],staticClass:\"fen\",domProps:{\"value\":(_vm.startPos)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.startPos=$event.target.value}}})]),_vm._v(\" \"),_c('button',{staticClass:\"btn btn-dark\",on:{\"click\":_vm.setStartPos}},[_vm._v(\"Set position\")]),_vm._v(\" \"),_c('button',{staticClass:\"btn btn-dark\",on:{\"click\":_vm.resetStartPos}},[_vm._v(\"Reset\")]),_vm._v(\" \"),(_vm.invalidStartPos)?_c('p',{staticClass:\"text-danger\"},[_vm._v(\"Invalid FEN string\")]):_vm._e()]),_vm._v(\" \"),_c('div',{staticClass:\"mt-3\"},[_vm._m(0),_vm._v(\" \"),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.fen),expression:\"fen\"}],staticClass:\"fen\",domProps:{\"value\":(_vm.fen)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.fen=$event.target.value}}})]),_vm._v(\" \"),_c('button',{staticClass:\"btn btn-dark\",on:{\"click\":_vm.setPos}},[_vm._v(\"Set position\")]),_vm._v(\" \"),(_vm.invalidFen)?_c('p',{staticClass:\"text-danger\"},[_vm._v(\"Invalid FEN string\")]):_vm._e()]),_vm._v(\" \"),_c('div',{staticClass:\"mt-3\"},[_c('p',[_c('strong',[_vm._v(\"Depth:\")]),_vm._v(\" \"+_vm._s(_vm.aiInfo.depth))]),_vm._v(\" \"),_c('p',[_c('strong',[_vm._v(\"Nodes searched:\")]),_vm._v(\" \"+_vm._s(_vm.aiInfo.searched))]),_vm._v(\" \"),_c('p',[_c('strong',[_vm._v(\"Hits in transposition table:\")]),_vm._v(\" \"+_vm._s(_vm.aiInfo.tpHits))])])]),_vm._v(\" \"),_vm._m(1)])],1),_vm._v(\" \"),_vm._m(2),_vm._v(\" \"),_c('p',{staticClass:\"created-by\"},[_vm._v(\"Created by Mattias Ahlsén\")])])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('h6',[_c('a',{attrs:{\"href\":\"https://en.wikipedia.org/wiki/Forsyth%E2%80%93Edwards_Notation\"}},[_vm._v(\"\\n              FEN\\n            \")]),_vm._v(\" of board\\n          \")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"col-sm-6 links\"},[_c('h3',[_vm._v(\"About\")]),_vm._v(\" \"),_c('p',[_vm._v(\"\\n          This is a chess engine I've built in javascript. The \\\"AI\\\" uses\\n          \"),_c('a',{attrs:{\"href\":\"https://chessprogramming.wikispaces.com/MTD%28f%29\"}},[_vm._v(\"mtd(f)\")]),_vm._v(\".\\n          All rules apply: insufficient material, fifty-move rule, threefold\\n          repetition etc, and the AI recognizes all these as draws and evaluates\\n          them accordingly. See more below.\\n        \")]),_vm._v(\" \"),_c('a',{staticClass:\"btn btn-primary btn-lg\",attrs:{\"href\":\"https://github.com/mattiasahlsen/jackfish/\",\"role\":\"button\"}},[_vm._v(\"\\n          Github repo\\n        \")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"about mt-4 mb-4\"},[_c('h4',{staticClass:\"mt-3\"},[_vm._v(\"Features\")]),_vm._v(\" \"),_c('ul',[_c('li',[_c('a',{attrs:{\"href\":\"https://chessprogramming.wikispaces.com/Simplified+evaluation+function\"}},[_vm._v(\"\\n          Piece-square table evaluation\\n        \")])]),_vm._v(\" \"),_c('li',{},[_c('a',{attrs:{\"href\":\"https://chessprogramming.wikispaces.com/MTD%28f%29\"}},[_vm._v(\"\\n          MTD(f)\\n        \")])]),_vm._v(\" \"),_c('li',{},[_c('a',{attrs:{\"href\":\"https://chessprogramming.wikispaces.com/Alpha-Beta\"}},[_vm._v(\"\\n          Alpha-beta\\n        \")])]),_vm._v(\" \"),_c('li',{},[_c('a',{attrs:{\"href\":\"https://chessprogramming.wikispaces.com/Iterative+Deepening\"}},[_vm._v(\"\\n          Iterative deepening\\n        \")])]),_vm._v(\" \"),_c('li',{},[_c('a',{attrs:{\"href\":\"https://chessprogramming.wikispaces.com/Transposition%20Table#KeyCollisions\"}},[_vm._v(\"\\n          Transposition table\\n        \")])]),_vm._v(\" \"),_c('li',{},[_c('a',{attrs:{\"href\":\"https://chessprogramming.wikispaces.com/Quiescence+Search\"}},[_vm._v(\"\\n          Quiescence search\\n        \")])]),_c('li',{},[_c('a',{attrs:{\"href\":\"https://chessprogramming.wikispaces.com/delta+pruning\"}},[_vm._v(\"\\n          Delta pruning\\n        \")])])]),_vm._v(\" \"),_c('h4',{staticClass:\"mt-3\"},[_vm._v(\"Credits to\")]),_vm._v(\" \"),_c('div',[_c('a',{attrs:{\"href\":\"https://chessprogramming.wikispaces.com/\"}},[_vm._v(\"https://chessprogramming.wikispaces.com/\")])]),_vm._v(\" \"),_c('div',[_c('a',{attrs:{\"href\":\"https://github.com/thomasahle/sunfish\"}},[_vm._v(\"https://github.com/thomasahle/sunfish\")])]),_vm._v(\" \"),_c('div')])}]\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-607810a0\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/Home.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-607810a0\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Home.vue\")\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-607810a0\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=1!./Home.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Home.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Home.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-607810a0\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./Home.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-607810a0\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/Home.vue\n// module id = null\n// module chunks = ","import Vue from 'vue'\nimport Router from 'vue-router'\nimport Home from '@/components/Home'\n\nVue.use(Router)\n\nexport default new Router({\n  routes: [\n    {\n      path: '/',\n      name: 'Home',\n      component: Home\n    }\n  ]\n})\n\n\n\n// WEBPACK FOOTER //\n// ./src/router/index.js","// The Vue build version to load with the `import` command\n// (runtime-only or standalone) has been set in webpack.base.conf with an alias.\nimport Vue from 'vue'\nimport App from './App'\nimport router from './router'\n\nimport VueWorker from 'vue-worker'\nVue.use(VueWorker)\n\nimport $ from 'jquery';\nwindow.$ = window.jquery = $;\n\n// this might require the jquery variable to be available\nimport 'bootstrap/dist/css/bootstrap.min.css';\n\nVue.config.productionTip = false\n\n/* eslint-disable no-new */\nnew Vue({\n  el: '#app',\n  router,\n  components: { App },\n  template: '<App/>'\n})\n\n\n\n// WEBPACK FOOTER //\n// ./src/main.js","var map = {\n\t\"./bB.png\": [\n\t\t\"z18c\",\n\t\t11\n\t],\n\t\"./bK.png\": [\n\t\t\"dLpT\",\n\t\t10\n\t],\n\t\"./bN.png\": [\n\t\t\"KRZJ\",\n\t\t9\n\t],\n\t\"./bP.png\": [\n\t\t\"9AiN\",\n\t\t8\n\t],\n\t\"./bQ.png\": [\n\t\t\"+a6Z\",\n\t\t7\n\t],\n\t\"./bR.png\": [\n\t\t\"fFy0\",\n\t\t6\n\t],\n\t\"./wB.png\": [\n\t\t\"xofh\",\n\t\t5\n\t],\n\t\"./wK.png\": [\n\t\t\"zrxd\",\n\t\t4\n\t],\n\t\"./wN.png\": [\n\t\t\"Zz9q\",\n\t\t3\n\t],\n\t\"./wP.png\": [\n\t\t\"gMX9\",\n\t\t2\n\t],\n\t\"./wQ.png\": [\n\t\t\"80Ug\",\n\t\t1\n\t],\n\t\"./wR.png\": [\n\t\t\"rP+x\",\n\t\t0\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tvar ids = map[req];\n\tif(!ids)\n\t\treturn Promise.reject(new Error(\"Cannot find module '\" + req + \"'.\"));\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(ids[0]);\n\t});\n};\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = \"TFeN\";\nmodule.exports = webpackAsyncContext;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/assets/img/chesspieces/wikipedia lazy ^\\.\\/.*\\.png$\n// module id = TFeN\n// module chunks = 13"],"sourceRoot":""}