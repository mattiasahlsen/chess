webpackJsonp([13],{"1MTY":function(t,e){},"LuF+":function(t,e){},NHnr:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("7+uW"),r={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]};var s=i("VU/8")({name:"App"},r,!1,function(t){i("rXjl")},null,null).exports,a=i("/ocq"),o=i("//Fk"),h=i.n(o),c=0,u=1,l=["P","N","B","R","Q","K","p","n","b","r","q","k"],f={white:{Q:"wQ",N:"wN",R:"wR",B:"wB"},black:{q:"bQ",n:"bN",r:"bR",b:"bB"}},v=function(t){i("TFeN")("./"+f.white[t]+".png").then(function(e){f.white[t]=e})};for(var p in f.white)v(p);var d=function(t){i("TFeN")("./"+f.black[t]+".png").then(function(e){f.black[t]=e})};for(var p in f.black)d(p);var b={name:"Promotion",data:function(){return{}},props:["pos","color","board"],computed:{file:function(){return this.pos%8},urls:function(){return this.color===c?f.white:f.black},width:function(){return this.board.offsetWidth/8},offset:function(){return this.board.getBoundingClientRect().x+(this.file-1)*this.width}}},m={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"promotion",style:{left:t.offset+"px",width:t.width+"px"}},t._l(t.urls,function(e,n){return i("img",{key:e,style:{width:t.width+"px"},attrs:{src:e},on:{click:function(e){t.$emit("done",n)}}})}))},staticRenderFns:[]};var g=i("VU/8")(b,m,!1,function(t){i("LuF+")},"data-v-46a32d55",null).exports,k=i("KyXY"),w=i.n(k),_=(i("1MTY"),i("Xxa5")),y=i.n(_),P=i("exGp"),C=i.n(P),x=i("RRo+"),M=i.n(x),N=i("Zrlr"),R=i.n(N),S=i("wxAW"),T=i.n(S);function Q(t){return t.charAt(0)===t.charAt(0).toUpperCase()}function A(t,e){return e===c?Q(t):!Q(t)}function B(t,e){return Q(t)===Q(e)}function F(t){return t===c?u:c}function q(t,e){return Math.abs(t%8-e%8)}function K(t){return 8-Math.floor(t/8)}function I(t){if("number"==typeof t)return t;if(2!==t.length)return NaN;var e=(t=t.toLowerCase()).charCodeAt(0),i=t.charCodeAt(1),n="a".charCodeAt(0),r="h".charCodeAt(0);return e>=n&&e<=r&&i>=49&&i<=56?e-97+56-8*(i-49):NaN}function z(t){var e=String.fromCharCode(t%8+97),i=K(t).toString();return e.concat(i)}function E(t,e){for(var i=0;i<64;i++)if(t[i]!==e[i])return!1;return!0}var H={P:100,N:320,B:330,R:500,Q:900,K:3e4},D={P:[0,0,0,0,0,0,0,0,50,50,50,50,50,50,50,50,10,10,20,30,30,20,10,10,5,5,10,25,25,10,5,5,0,0,0,20,20,0,0,0,5,-5,-10,0,0,-10,-5,5,5,10,10,-20,-20,10,10,5,0,0,0,0,0,0,0,0],N:[-50,-40,-30,-30,-30,-30,-40,-50,-40,-20,0,0,0,0,-20,-40,-30,0,10,15,15,10,0,-30,-30,5,15,20,20,15,5,-30,-30,0,15,20,20,15,0,-30,-30,5,10,15,15,10,5,-30,-40,-20,0,5,5,0,-20,-40,-50,-40,-30,-30,-30,-30,-40,-50],B:[-20,-10,-10,-10,-10,-10,-10,-20,-10,0,0,0,0,0,0,-10,-10,0,5,10,10,5,0,-10,-10,5,5,10,10,5,5,-10,-10,0,10,10,10,10,0,-10,-10,10,10,10,10,10,10,-10,-10,5,0,0,0,0,5,-10,-20,-10,-10,-10,-10,-10,-10,-20],R:[0,0,0,0,0,0,0,0,5,10,10,10,10,10,10,5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,0,0,0,5,5,0,0,0],Q:[-20,-10,-10,-5,-5,-10,-10,-20,-10,0,0,0,0,0,0,-10,-10,0,5,5,5,5,0,-10,-5,0,5,5,5,5,0,-5,0,0,5,5,5,5,0,-5,-10,5,5,5,5,5,0,-10,-10,0,5,0,0,0,0,-10,-20,-10,-10,-5,-5,-10,-10,-20],K:[-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30,-20,-30,-30,-40,-40,-30,-30,-20,-10,-20,-20,-20,-20,-20,-20,-10,20,20,0,0,0,0,20,20,20,30,10,0,0,10,30,20]},j={},L=function(t){var e=t.toLowerCase();j[t]=[],j[e]=[],D[t].forEach(function(i,n){j[t].push(i+H[t]),j[e][56-n+n%8*2]=i+H[t]})};for(var U in D)L(U);function X(t){for(var e=0,i=0;i<64;i++)if(t[i]){var n=t[i];Q(n)?e+=j[n][i]:e-=j[n][i]}return e}var O=i("ifoU"),W=i.n(O),Z=i("LtXW"),G=new Z(Z.engines.mt19937().seed(27102));function J(){return G.integer(-Math.pow(2,31),Math.pow(2,31)-1)}var V=function(){return[J(),J()]},Y={};l.forEach(function(t){Y[t]=[];for(var e=0;e<64;e++)Y[t].push(V());Y.turn=V(),Y.wc=[V(),V()],Y.bc=[V(),V()],Y.epFile=[];for(var i=0;i<8;i++)Y.epFile.push(V());Y.kp=[];for(var n=[3,5,59,61],r=0;r<n.length;r++)Y.kp[n[r]]=V()});!function(){function t(e){R()(this,t),this.map=new W.a,this.maxSize=e}T()(t,[{key:"size",value:function(){return this.map.size}},{key:"get",value:function(t){var e=t[0],i=t[1],n=this.map.get(e);if(void 0!==n)return this.map.delete(e),this.map.set(e,n),n[i]}},{key:"add",value:function(t,e){var i=t[0],n=t[1],r=this.map.get(i);if(void 0!==r)r[n]=e,this.map.delete(i),this.map.set(i,r);else{var s=[];s[n]=e,this.map.set(i,s)}return this.map.size>this.maxSize&&this.map.delete(this.map.keys().next().value),e}},{key:"clear",value:function(){this.map.clear()}},{key:"setSize",value:function(t){this.maxSize=t}}])}();var tt=function(){function t(e){R()(this,t),this.cache=[],this.currentSize=0,this.maxSize=e}return T()(t,[{key:"size",value:function(){return this.currentSize}},{key:"setSize",value:function(t){this.maxSize=t}},{key:"get",value:function(t){var e=t[0],i=t[1];return void 0!==this.cache[e]?this.cache[e][i]:void 0}},{key:"add",value:function(t,e){var i=t[0],n=t[1];return this.currentSize===this.maxSize&&(this.cache=[],this.currentSize=0),void 0!==this.cache[i]?(void 0===this.cache[i][n]&&this.currentSize++,this.cache[i][n]=e):(this.cache[i]=[],this.cache[i][n]=e,this.currentSize++),e}},{key:"clear",value:function(){this.cache=[],this.currentSize=0}}]),t}(),et=56,it=7,nt=-8,rt=-1,st={};for(var at in st.P=[nt,-16,-9,-7],st.N=[-17,-15,-10,6,17,15,-6,10],st.B=[-9,-7,7,9],st.R=[nt,1,8,rt],st.Q=[nt,-7,1,9,8,7,rt,-9],st.K=[nt,-7,1,9,8,7,rt,-9],st)st[at.toLowerCase()]=st[at];st.p=[];for(var ot=0;ot<st.P.length;ot++)st.p.push(-st.P[ot]);var ht=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[!0,!0],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[!0,!0],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,h=arguments[7],l=arguments[8],f=arguments[9];if(R()(this,t),"string"==typeof e){var v=e;this.board=[],this.wc=[!1,!1],this.bc=[!1,!1],this.ep=-1,this.kp=-1;for(var p=v.trim().split(/ +/),d=0,b=0;b<p[0].length;){var m=p[0].charAt(b),g=parseInt(m);if(M()(g)){for(var k=0;k<g;k++)this.board[d+k]=null;d+=g}else m=m,this.board[d]=m,d++;if(b++,d>=64)break;d%8==0&&b++}switch(p[1]){case"w":this.turn=c;break;case"b":this.turn=u;break;default:throw new Error("Invalid fen string")}if("-"!==p[2])for(var w=[],_=0;_<p[2].length;_++){var y=p[2].charAt(_);switch(y){case"Q":this.wc[0]=!0;break;case"K":this.wc[1]=!0;break;case"q":this.bc[1]=!0;break;case"k":this.bc[0]=!0;break;default:throw new Error("Invalid fen string")}w.push(y)}"-"!==p[3]&&(this.ep=I(p[3])),this.halfMoveClock=parseInt(p[4])}else this.board=e,this.turn=i,this.wc=n,this.bc=r,this.ep=s,this.kp=a,this.halfMoveClock=o;this.score=void 0!==h?h:this.turn===c?X(this.board):-X(this.board),this.hash=void 0!==l?l:function(t){var e=[0,0],i=function(t){e[0]^=t[0],e[1]^=t[1]};t.turn===c&&i(Y.turn);for(var n=0;n<64;n++){var r=t.board[n];r&&i(Y[r][n])}return t.wc[0]&&i(Y.wc[0]),t.wc[1]&&i(Y.wc[1]),t.bc[0]&&i(Y.bc[0]),t.bc[1]&&i(Y.bc[1]),-1!==t.ep&&i(Y.epFile[t.ep%8]),-1!==t.kp&&i(Y.kp[t.kp]),e}(this),this.boardHash=void 0!==f?f:this.hashBoard()}return T()(t,[{key:"genMoves",value:y.a.mark(function t(){var e,i,n,r,s,a,o,h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.turn;return y.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=0;case 1:if(!(e<this.board.length)){t.next=48;break}if(null!==(i=this.board[e])&&A(i,h)){t.next=5;break}return t.abrupt("continue",45);case 5:if("K"!==i.toUpperCase()){t.next=13;break}if(!(n=h===c?this.wc:this.bc)[0]||null!==this.board[e-1]||null!==this.board[e-2]){t.next=10;break}return t.next=10,[e,e-2];case 10:if(!n[1]||null!==this.board[e+1]||null!==this.board[e+2]){t.next=13;break}return t.next=13,[e,e+2];case 13:r=0;case 14:if(!(r<st[i].length)){t.next=45;break}if(!(-16===(s=st[i][r])&&e<et-8||16===s&&e>it+8)){t.next=18;break}return t.abrupt("continue",42);case 18:a=e+s;case 19:if(!(a>=0&&a<=63&&q(a,a-s)<6)){t.next=42;break}if(o=this.board[a],"P"!==i.toUpperCase()){t.next=30;break}if(0!==q(e,a)||null===o){t.next=24;break}return t.abrupt("break",42);case 24:if(2!==(u=e,l=a,Math.abs(Math.floor(u/8)-Math.floor(l/8)))||null===this.board[e+s/2]){t.next=26;break}return t.abrupt("break",42);case 26:if(1!==q(e,a)||a===this.ep||null!==o&&!B(o,i)){t.next=28;break}return t.abrupt("break",42);case 28:t.next=35;break;case 30:if(null===o){t.next=35;break}if(B(o,i)){t.next=34;break}return t.next=34,[e,a];case 34:return t.abrupt("break",42);case 35:return t.next=37,[e,a];case 37:if(!"KkNnPp".includes(i)){t.next=39;break}return t.abrupt("break",42);case 39:a+=s,t.next=19;break;case 42:r++,t.next=14;break;case 45:e++,t.next=1;break;case 48:case"end":return t.stop()}var u,l},t,this)})},{key:"nullMove",value:function(){var e=new t(this.board.slice(),F(this.turn),this.wc,this.bc,-1,-1,this.halfMoveClock+1,-this.score,this.hashNullMove(),this.boardHash);return e.prev=this,e}},{key:"move",value:function(e,i,n){var r=e[0],s=e[1],a=this.board[r];i||(i=this.turn===c?"Q":"q");var o=this.board.slice(),h=this.wc.slice(),u=this.bc.slice(),l=-1,f=-1;void 0===n&&(n=-(this.score+this.value(e,i)));var v=void 0;if(v=o[s]?0:this.halfMoveClock+1,o[s]=o[r],o[r]=null,"K"===a)h=[!1,!1],2===Math.abs(s-r)&&(o[f=(r+s)/2]="R",o[s<r?et:63]=null);else if("k"===a)u=[!1,!1],2===Math.abs(s-r)&&(o[f=(r+s)/2]="r",o[s<r?0:it]=null);else{var p=function(t){switch(t){case et:h[0]=!1;break;case 63:h[1]=!1;break;case 0:u[0]=!1;break;case it:u[1]=!1}};p(r),p(s),"P"===a?(v=0,s-r==-16?l=(s+r)/2:s===this.ep?o[s+8]=null:s<=it&&(o[s]=i)):"p"===a&&(v=0,s-r==16?l=(s+r)/2:s===this.ep?o[s-8]=null:s>=et&&(o[s]=i))}var d=this.hashMove(e,i),b=new t(o,F(this.turn),h,u,l,f,v,n,d[0],d[1]);return b.prev=this,b}},{key:"value",value:function(t,e){var i=t[0],n=t[1],r=this.board[i],s=this.board[n];if(-1!==this.kp&&Math.abs(n-this.kp)<2)return 3e4;var a=j[r][n]-j[r][i];return s&&(a+=j[s][n]),"K"===r&&2===Math.abs(n-i)?(a+=j.R[(n+i)/2],a-=n<i?j.R[et]:j.R[63]):"k"===r&&2===Math.abs(n-i)&&(a+=j.r[(n+i)/2],a-=n<i?j.r[0]:j.r[it]),"P"===r?n<=it?a+=j[e||"Q"][n]-j[r][n]:n===this.ep&&(s=this.board[n+8],a+=j[s][n+8]):"p"===r&&(n>=et?a+=j[e||"q"][n]-j[r][n]:n===this.ep&&(s=this.board[n-8],a+=j[s][n-8])),a}},{key:"hashMove",value:function(t,e){var i=this,n=t[0],r=t[1],s=this.board[n],a=this.board[r],o=this.hash.slice(),h=this.boardHash.slice(),c=function(t){o[0]^=t[0],o[1]^=t[1]},u=function(t){h[0]^=t[0],h[1]^=t[1]};if(c(Y.turn),-1!==this.ep&&c(Y.epFile[this.ep%8]),-1!==this.kp&&c(Y.kp[this.kp]),c(Y[s][n]),c(Y[s][r]),u(Y[s][n]),u(Y[s][r]),a&&(c(Y[a][r]),u(Y[a][r])),"K"===s&&2===Math.abs(r-n)){var l=(r+n)/2;c(Y.wc[0]),c(Y.wc[1]),c(Y.kp[l]),c(Y.R[l]),u(Y.R[l]),r<n?(c(Y.R[et]),u(Y.R[et])):(c(Y.R[63]),u(Y.R[63]))}else if("k"===s&&2===Math.abs(r-n)){var f=(r+n)/2;c(Y.bc[0]),c(Y.bc[1]),c(Y.kp[f]),c(Y.r[f]),u(Y.r[f]),r<n?(c(Y.r[0]),u(Y.r[0])):(c(Y.r[it]),u(Y.r[it]))}else{var v=function(t){switch(t){case et:i.wc[0]&&c(Y.wc[0]);break;case 63:i.wc[1]&&c(Y.wc[1]);break;case 0:i.bc[0]&&c(Y.bc[0]);break;case it:i.bc[1]&&c(Y.bc[1])}};v(n),v(r),"P"===s?r-n==-16?c(Y.epFile[(r+n)/2%8]):r===this.ep?(a=this.board[r+8],c(Y[a][r+8]),u(Y[a][r+8])):r<=it&&(c(Y[s][r]),c(Y[e||"Q"][r]),u(Y[s][r]),u(Y[e||"Q"][r])):"p"===s&&(r-n==16?c(Y.epFile[(r+n)/2%8]):r===this.ep?(a=this.board[r-8],c(Y[a][r-8]),u(Y[a][r-8])):r>=et&&(c(Y[s][r]),c(Y[e||"q"][r]),u(Y[s][r]),u(Y[e||"q"][r])))}return[o,h]}},{key:"hashNullMove",value:function(){var t=this.hash.slice(),e=function(e){t[0]^=e[0],t[1]^=e[1]};return-1!==this.ep&&e(Y.epFile[this.ep%8]),-1!==this.kp&&e(Y.kp[this.kp]),e(Y.turn),t}},{key:"hashBoard",value:function(){for(var t=[0,0],e=0;e<64;e++){var i=this.board[e];i&&(t[0]^=Y[i][e][0],t[1]^=Y[i][e][1])}return t}},{key:"valid",value:function(t){for(var e=this.genMoves(),i=e.next();!i.done;){if(t[0]===i.value[0]&&t[1]===i.value[1]){for(var n=this.move(t),r=n.genMoves(),s=r.next();!s.done;){if(-1!==n.kp&&Math.abs(s.value[1]-n.kp)<2)return!1;var a=n.board[s.value[1]];if(null!==a&&"Kk".includes(a))return!1;s=r.next()}return!0}i=e.next()}return!1}},{key:"inCheck",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.turn,e=void 0,i=void 0,n=void 0,r=void 0;for(var s in t===c?(r=this.board.indexOf("K"),e={bq:st.B,rq:st.R,n:st.N},n="p",i=[7,9]):(r=this.board.indexOf("k"),e={BQ:st.B,RQ:st.R,N:st.N},n="P",i=[-9,-7]),e)for(var a=0;a<e[s].length;a++)for(var o=r+e[s][a];o>=0&&o<=63&&q(o,o-e[s][a])<6;){if(this.board[o]){if(s.includes(this.board[o]))return!0;if(this.board[o]===n&&(r===o+i[0]||r===o+i[1]))return!0;break}if("Nn".includes(s))break;o+=e[s][a]}return!1}},{key:"toString",value:function(){for(var t="",e=0,i=0;i<64;i++)null===this.board[i]?e++:(e>0&&(t+=e,e=0),t+=this.board[i]),i%8==7&&(e>0&&(t+=e,e=0),i<63&&(t+="/"));return t+=" ",this.turn===c?t+="w":t+="b",t+=" ",this.wc[0]||this.wc[1]||this.bc[0]||this.bc[1]?(this.wc[1]&&(t+="K"),this.wc[0]&&(t+="Q"),this.bc[1]&&(t+="k"),this.bc[0]&&(t+="q")):t+="-",t+=" ",-1!==this.ep?t+=z(this.ep):t+="-",t+=" ",t+=this.halfMoveClock,t+=" ",t+=1}}]),t}(),ct=i("woOf"),ut=i.n(ct),lt=15*H.Q,ft=50,vt="L",pt="E",dt="H",bt=new tt(1e7),mt=new tt(1e3);mt.push=function(t){var e=this.get(t);void 0!==e?this.add(t,e+1):this.add(t,1)},mt.pull=function(t){var e=this.get(t);void 0!==e&&e>0&&this.add(t,e-1)};!function(){function t(){return R()(this,t),this.origins={},this}T()(t,[{key:"add",value:function(t){this.origins[t[0]]?this.origins[t[0]][t[1]]=!0:(this.origins[t[0]]={},this.origins[t[0]][t[1]]=!0)}},{key:"forEach",value:function(t,e){for(var i in this.origins)for(var n in this.origins[i]);}}])}();var gt=0,kt=0,wt=void 0,_t=!1,yt=function(){return Date.now()>wt&&_t};function Pt(t,e,i){if(e){var n=e[0],r=void 0;if(r=n[1]===t.ep?"P"===t.board[n[0]]?t.board[t.ep+8]:"p"===t.board[n[0]]?t.board[t.ep-8]:t.board[n[1]]:t.board[n[1]],i(e[0],e[1],r))return}var s=t.genMoves(),a=s.next();if(!a.done)for(;!a.done;){var o=a.value,h=void 0;if(h=o[1]===t.ep?"P"===t.board[o[0]]?t.board[t.ep+8]:t.board[t.ep-8]:t.board[o[1]],"P"===t.board[o[0]]&&o[1]<=it){for(var c=0;c<"QNRB".length;c++)if(i(o,"QNRB".charAt(c),h))return}else if("p"===t.board[o[0]]&&o[1]>=et){for(var u=0;u<"qnrb".length;u++)if(i(o,"qnrb".charAt(u),h))return}else if(i(o,void 0,h))return;a=s.next()}}function Ct(t){for(var e=t.genMoves(),i=e.next();!i.done;)if("Kk".includes(t.board[i.value[0]])&&2===Math.abs(i.value[1]-i.value[0]))i=e.next();else{if(!t.move(i.value).inCheck(t.turn))return!1;i=e.next()}return!0}function xt(t){var e={};l.forEach(function(t){e[t]=0});for(var i=0;i<64;i++){var n=t.board[i];n&&e[n]++}return e.new=function(t){var e=ut()({},this);return t&&e[t]--,e},e.endgame=function(){return!(this.Q>0&&(this.R>0||this.B+this.N>1))&&!(this.q>0&&(this.r>0||this.b+this.n>1))},e.insufficientMaterial=function(){return 0===this.Q&&0===this.q&&0===this.P&&0===this.p&&0===this.R&&0===this.r&&(0===this.B||1===this.B&&0===this.N)&&(0===this.b||1===this.b&&0===this.n)},e}function Mt(t,e,i,n,r){var s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(kt++,e<0&&(e=0),t.halfMoveClock>=50)return 0;if(mt.get(t.boardHash)>=3)return 0;var a=!0,o=void 0,h=bt.get(t.hash);if(h&&(o=h.pv,h.depth>=e))switch(gt++,h.fail){case vt:if(h.score<=i)return i;break;case pt:return h.score;case dt:if(h.score>=n)return n}h=bt.add(t.hash,{pv:o,score:i,depth:e,fail:vt});var c=r.endgame();if(c&&r.insufficientMaterial())return h.score=0,h.fail=pt,0;var u=function(t,e,r){return!!yt()||(r>i?(h.fail=dt,a=!1,h.pv=[t,e],i=r>=lt?lt:n,!0):(r>-lt&&(a=!1),!1))};if(e<=0)if(t.score>=n){if(!t.inCheck())return c&&Ct(t)?(h.score=0,h.fail=pt,0):(h.score=n,h.fail=dt,n);a=!1,Pt(t,o,function(e,s,a){var o=t.move(e,s);if(o.inCheck(t.turn))return!1;mt.push(o.boardHash);var h=-Mt(o,0,-n,-i,r.new(a));return mt.pull(o.boardHash),u(e,s,h)})}else{if(t.score+H.Q<i)return t.inCheck(F(t.turn))?(h.fail=dt,h.score=lt,lt):c&&!t.inCheck()&&Ct(t)?(h.score=0,h.fail=pt,0):i;if(Pt(t,o,function(e,s,a){if(-1!==t.kp&&Math.abs(t.kp-e[1])<2)return i=lt,h.fail=dt,!0;if(!(t.board[e[1]]||e[1]===t.ep&&"Pp".includes(t.board[e[0]])))return!1;var o=t.score+t.value(e,s);if(o>=lt)return i=lt,h.fail=dt,!0;if((t.board[e[1]]||e[1]===t.ep)&&o+2*H.P>=i){var c=t.move(e,s,-o);mt.push(c.boardHash);var l=-Mt(c,0,-n,-i,r.new(a));return mt.pull(c.boardHash),u(e,s,l)}return!1}),a&&i<n)return h.fail=pt,h.score=t.score,t.score}else{if(!s&&1===e&&t.score+H.Q<i)return t.inCheck(F(t.turn))?(h.score=lt,h.fail=dt,lt):c&&Ct(t)?(h.score=0,h.fail=pt,0):i;if(!s&&!c&&-Mt(t.nullMove(),e-3,-n,-i,r.new())>=n)return h.score=n,h.fail=dt,n;Pt(t,o,function(s,a){var o=t.score+t.value(s,a);if(o>=lt)return i=lt,h.fail=dt,!0;if(1===e&&o+2*H.P<i)return!1;var c=t.move(s,a,-o);mt.push(c.boardHash);var l=-Mt(c,e-1,-n,-i,r.new());return mt.pull(c.boardHash),u(s,a,l)})}return a&&c&&!t.inCheck()&&Ct(t)?(h.score=0,h.fail=pt,0):(yt()&&(h.fail=dt),h.score=i,i)}function Nt(t,e,i){var n={lower:-lt,upper:lt},r=i,s=r-2*ft,a=xt(t);do{n.lower!==-lt&&n.upper!==lt?s=n.upper-n.lower>3?Math.floor((n.lower+n.upper)/2):r+(r===n.lower?1:0):r===n.lower?s=r+ft:r===n.upper&&(s=r-ft),(r=Mt(t,e,s-1,s,a.new(),!0))<s?n.upper=r:(n.lower=r,_t=!0)}while(n.lower<=n.upper-1&&!yt());return[n.lower,n.upper]}var Rt=function(){var t=C()(y.a.mark(function t(e,i){var n,r,s,a,o,h,c,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,f=arguments[4],v=arguments[5];return y.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=e.score,r=void 0,s=void 0,l<1&&(l=1),i.forEach(function(t){mt.push(new ht(t.fen).boardHash)}),mt.push(e.boardHash),u<1e3&&(u=1e3),u>6e4&&(u=6e4),wt=Date.now()+u,f.searched=0,f.tpHits=0,a=1;case 12:if(!(a<=l)||yt()){t.next=25;break}if(f.depth=a,!v){t.next=17;break}return t.next=17,v();case 17:a>1&&(s=bt.get(e.hash)),r=Nt(e,a,n),n=r[0],a++,f.searched=kt,f.tpHits=gt,t.next=12;break;case 25:return o=yt()?"time":"depth",_t=!1,kt=0,gt=0,h=bt.get(e.hash),(!s||r[0]>s.score||r[1]<s.score)&&(s=h),bt.clear(),mt.clear(),(c=s.pv).push(o),t.abrupt("return",c);case 36:case"end":return t.stop()}},t,this)}));return function(e,i){return t.apply(this,arguments)}}(),St={startPos:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",searchTime:4},Tt=new(function(){function t(e){R()(this,t),this.config=St,this.history=[],this.aiInfo={depth:0,searched:0,tpHits:0},e&&this.configure(e),this.setPos(this.config.startPos)}return T()(t,[{key:"configure",value:function(t){for(var e in t)this.config[e]=t[e]}},{key:"getConfig",value:function(){return this.config}},{key:"setPos",value:function(t){var e,i,n=[],r=void 0,s=[!1,!1],a=[!1,!1],o=-1,h=t.trim().split(/ +/);if(6!==h.length)return!1;for(var f=0,v=0;v<h[0].length;){var p=h[0].charAt(v),d=parseInt(p);if(M()(d)&&d>0){if(d>8-f%8)return!1;for(var b=0;b<d;b++)n[f+b]=null;f+=d}else{if(!l.includes(p))return!1;p=p,n[f]=p,f++}if(v++,f>=64)break;if(f%8==0){if("/"!==h[0].charAt(v))return!1;v++}}if(" "!==t.charAt(v))return!1;switch(h[1]){case"w":r=c;break;case"b":r=u;break;default:return!1}if("-"!==h[2]){if(h[2].length>4)return!1;for(var m=[],g=0;g<h[2].length;g++){var k=h[2].charAt(g);if(m.includes(k))return!1;switch(k){case"Q":s[0]=!0;break;case"K":s[1]=!0;break;case"q":a[1]=!0;break;case"k":a[0]=!0;break;default:return!1}m.push(k)}}if("-"!==h[3]){var w=K(o=I(h[3]));if(isNaN(o))return!1;if(3!==w&&6!==w)return!1}return e=parseInt(h[4]),i=parseInt(h[5]),!!(M()(e)&&e>=0)&&(!!(M()(i)&&i>0)&&(this.fullMove=i,this.position=new ht(n,r,s,a,o,-1,e),this.history=[],!0))}},{key:"validFen",value:function(t){return(new this.constructor).setPos(t)}},{key:"fen",value:function(){for(var t=this.position,e=t.board,i="",n=0,r=0;r<64;r++)null===e[r]?n++:(n>0&&(i+=n,n=0),i+=e[r]),r%8==7&&(n>0&&(i+=n,n=0),r<63&&(i+="/"));return i+=" ",t.turn===c?i+="w":i+="b",i+=" ",t.wc[0]||t.wc[1]||t.bc[0]||t.bc[1]?(t.wc[1]&&(i+="K"),t.wc[0]&&(i+="Q"),t.bc[1]&&(i+="k"),t.bc[0]&&(i+="q")):i+="-",i+=" ",-1!==t.ep?i+=z(t.ep):i+="-",i+=" ",i+=t.halfMoveClock,i+=" ",i+=this.fullMove,i}},{key:"move",value:function(t,e,i){if(t=I(t),e=I(e),i)if(this.position.turn===c){if(!"QNRB".includes(i))return!1}else if(!"qnrb".includes(i))return!1;return!!this.valid(t,e)&&(this.history.push({fen:this.fen(),move:[t,e]}),this.position=this.position.move([t,e],i),this.position.turn===c&&(this.fullMove+=1),!0)}},{key:"undoMove",value:function(){var t=this.history,e=t.pop();return e?(this.setPos(e.fen),this.history=t,e.move):null}},{key:"winner",value:function(){return this.inCheckMate()?this.position.turn===c?"black":"white":this.fiftyMoves()||this.inThreefoldRepetition()||this.inStaleMate()||this.insuffMaterial()?"draw":null}},{key:"insuffMaterial",value:function(){return xt(this.position).insufficientMaterial()}},{key:"fiftyMoves",value:function(){return this.position.halfMoveClock>=50}},{key:"inThreefoldRepetition",value:function(){for(var e=1,i=0;i<this.history.length;i++){var n=new t;if(n.setPos(this.history[i].fen),E(n.position.board,this.position.board)&&3===++e)return!0}return!1}},{key:"inCheckMate",value:function(){return 0===this.moves().length&&this.position.inCheck()}},{key:"inStaleMate",value:function(){return 0===this.moves().length&&!this.position.inCheck()}},{key:"moves",value:function(){for(var t=[],e=this.position.genMoves(),i=e.next();!i.done;)this.position.valid(i.value)&&t.push(i.value),i=e.next();return t}},{key:"valid",value:function(t,e){return t=I(t),e=I(e),this.position.valid([t,e])}},{key:"restart",value:function(){this.setPos(this.config.startPos)}},{key:"aiMove",value:function(){var t=C()(y.a.mark(function t(e){var i;return y.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null===this.winner()){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,Rt(this.position,this.history,1e3*this.config.searchTime,e,this.aiInfo,this.config.betweenDepths);case 4:if(!(i=t.sent)){t.next=10;break}return this.move(i[0][0],i[0][1],i[1]),t.abrupt("return",i);case 10:throw new Error("The AI failed to make a move");case 11:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"turn",value:function(){return this.position.turn===c?"white":"black"}}]),t}()),Qt={name:"Home",components:{Promotion:g},data:function(){return{game:Tt,promotion:null,winner:Tt.winner(),aiInfo:Tt.aiInfo,fen:Tt.fen(),startPos:Tt.config.startPos,board:null}},computed:{invalidFen:function(){return!Tt.validFen(this.fen)},invalidStartPos:function(){return!Tt.validFen(this.startPos)}},watch:{"game.position.board":function(){this.board.position(this.game.fen(),!1),this.winner=this.game.winner(),this.fen=this.game.fen()},"game.position.turn":function(){var t=this;"black"===this.game.turn()&&null===this.game.winner()&&setTimeout(function(){return t.game.aiMove(5e3)},100)},"game.aiInfo":{handler:function(t){this.aiInfo=t},deep:!0}},mounted:function(){var t=this;this.game.configure({betweenDepths:function(){return new h.a(function(t){return setTimeout(t,10)})}}),this.onDragStart=function(e,i){return("w"===i.charAt(0)?c:u)===t.game.position.turn&&null===t.winner},this.onDrop=function(e,i,n){if(!t.game.valid(e,i))return"snapback";var r=K(I(i));if("P"!==n.charAt(1)||8!==r&&1!==r)t.game.move(e,i);else{var s="w"===n.charAt(0)?c:u;t.promotion={pos:I(i),color:s,src:e,target:i}}},this.createBoard(),this.$refs.board.ontouchmove=function(t){return t.preventDefault()}},methods:{createBoard:function(){console.log(.9*$(window).width()),this.$refs.board.style.width=this.$refs.board.style.height=Math.min($(window).height()-$("#header").height()-15,.8*$(window).width())+"px",this.$refs.board.style.marginLeft="auto",this.$refs.board.style.marginRight="auto",this.board=w()("board",{position:this.game.fen(),draggable:!0,onDrop:this.onDrop,onDragStart:this.onDragStart})},destroyBoard:function(){this.board&&this.board.destroy(),this.board=null},handlePromotion:function(t){this.game.move(this.promotion.src,this.promotion.target,t),this.promotion=null},cancel:function(){this.promotion=null,this.board.position(this.game.fen(),!1)},undoMove:function(){this.game.undoMove(),Tt.position.turn===u&&this.game.undoMove()},restart:function(){this.game.restart()},setPos:function(){this.game.setPos(this.fen)&&(this.fen=this.game.fen())},setStartPos:function(){Tt.validFen(this.startPos)&&this.game.configure({startPos:this.startPos})},resetStartPos:function(){this.game.configure({startPos:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"}),this.startPos=this.game.config.startPos},setTime:function(t){this.game.configure({searchTime:t})}}},At={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t._m(0),t._v(" "),i("div",{staticClass:"container-fluid"},[t.promotion?i("Promotion",{attrs:{pos:t.promotion.pos,board:t.$refs.board,color:t.promotion.color},on:{done:t.handlePromotion}}):t._e(),t._v(" "),i("div",{ref:"board",attrs:{id:"board","touch-action":"none"},on:{click:t.cancel}}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"game-status col-sm-6"},["white"===t.winner?i("h3",[t._v("The winner is\n          "),i("span",{staticClass:"white"},[t._v("white")])]):"black"===t.winner?i("h3",[t._v("The winner is\n          "),i("span",{staticClass:"black"},[t._v("black")])]):"draw"===t.winner?i("h3",[t._v("It's a draw")]):i("h3",{style:{visibility:"hidden"}},[t._v("\n          Game is still running.\n        ")]),t._v(" "),i("button",{staticClass:"btn btn-light",attrs:{type:"button"},on:{click:t.undoMove}},[t._v("\n          Undo move\n        ")]),t._v(" "),i("button",{staticClass:"btn btn-light",attrs:{type:"button"},on:{click:t.restart}},[t._v("\n          Restart\n        ")]),t._v(" "),i("div",{staticClass:"mt-3"},[i("h6",[t._v("AI search time (s)")]),t._v(" "),i("div",{staticClass:"mb-2"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.game.config.searchTime,expression:"game.config.searchTime"}],domProps:{value:t.game.config.searchTime},on:{input:function(e){e.target.composing||t.$set(t.game.config,"searchTime",e.target.value)}}})]),t._v(" "),i("button",{staticClass:"btn btn-outline-success",attrs:{type:"button"},on:{click:function(e){t.setTime(2)}}},[t._v("Easy")]),t._v(" "),i("button",{staticClass:"btn btn-outline-warning",attrs:{type:"button"},on:{click:function(e){t.setTime(4)}}},[t._v("Medium")]),t._v(" "),i("button",{staticClass:"btn btn-outline-danger",attrs:{type:"button"},on:{click:function(e){t.setTime(6)}}},[t._v("Hard")])]),t._v(" "),i("div",{staticClass:"mt-3"},[i("h6",[t._v("Fen of starting position.")]),t._v(" "),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.startPos,expression:"startPos"}],staticClass:"fen",domProps:{value:t.startPos},on:{input:function(e){e.target.composing||(t.startPos=e.target.value)}}})]),t._v(" "),i("button",{staticClass:"btn btn-dark",on:{click:t.setStartPos}},[t._v("Set position")]),t._v(" "),i("button",{staticClass:"btn btn-dark",on:{click:t.resetStartPos}},[t._v("Reset")]),t._v(" "),t.invalidStartPos?i("p",{staticClass:"text-danger"},[t._v("Invalid FEN string")]):t._e()]),t._v(" "),i("div",{staticClass:"mt-3"},[t._m(1),t._v(" "),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.fen,expression:"fen"}],staticClass:"fen",domProps:{value:t.fen},on:{input:function(e){e.target.composing||(t.fen=e.target.value)}}})]),t._v(" "),i("button",{staticClass:"btn btn-dark",on:{click:t.setPos}},[t._v("Set position")]),t._v(" "),t.invalidFen?i("p",{staticClass:"text-danger"},[t._v("Invalid FEN string")]):t._e()]),t._v(" "),i("div",{staticClass:"mt-3"},[i("p",[i("strong",[t._v("Depth:")]),t._v(" "+t._s(t.aiInfo.depth))]),t._v(" "),i("p",[i("strong",[t._v("Nodes searched:")]),t._v(" "+t._s(t.aiInfo.searched))]),t._v(" "),i("p",[i("strong",[t._v("Hits in transposition table:")]),t._v(" "+t._s(t.aiInfo.tpHits))])])]),t._v(" "),t._m(2)])],1),t._v(" "),t._m(3),t._v(" "),i("p",{staticClass:"created-by"},[t._v("Created by Mattias Ahlsén")])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("header",{attrs:{id:"header"}},[e("h1",[this._v("Jackfish")]),this._v(" "),e("h2",[this._v("A chess engine in javascript.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h6",[e("a",{attrs:{href:"https://en.wikipedia.org/wiki/Forsyth%E2%80%93Edwards_Notation"}},[this._v("\n              FEN\n            ")]),this._v(" of board\n          ")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"col-sm-6 links"},[e("h3",[this._v("About")]),this._v(" "),e("p",[this._v('\n          This is a chess engine I\'ve built in javascript. The "AI" uses\n          '),e("a",{attrs:{href:"https://chessprogramming.wikispaces.com/MTD%28f%29"}},[this._v("mtd(f)")]),this._v(".\n          All rules apply: insufficient material, fifty-move rule, threefold\n          repetition etc, and the AI recognizes all these as draws and evaluates\n          them accordingly. See more below.\n        ")]),this._v(" "),e("a",{staticClass:"btn btn-primary btn-lg",attrs:{href:"https://github.com/mattiasahlsen/jackfish/",role:"button"}},[this._v("\n          Github repo\n        ")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"about mt-4 mb-4"},[i("h4",{staticClass:"mt-3"},[t._v("Features")]),t._v(" "),i("ul",{staticClass:"list-group"},[i("li",{staticClass:"list-group-item"},[i("a",{attrs:{href:"https://chessprogramming.wikispaces.com/Simplified+evaluation+function"}},[t._v("\n          Piece-square table evaluation\n        ")])]),t._v(" "),i("li",{staticClass:"list-group-item"},[i("a",{attrs:{href:"https://chessprogramming.wikispaces.com/MTD%28f%29"}},[t._v("\n          MTD(f)\n        ")])]),t._v(" "),i("li",{staticClass:"list-group-item"},[i("a",{attrs:{href:"https://chessprogramming.wikispaces.com/Alpha-Beta"}},[t._v("\n          Alpha-beta\n        ")])]),t._v(" "),i("li",{staticClass:"list-group-item"},[i("a",{attrs:{href:"https://chessprogramming.wikispaces.com/Iterative+Deepening"}},[t._v("\n          Iterative deepening\n        ")])]),t._v(" "),i("li",{staticClass:"list-group-item"},[i("a",{attrs:{href:"https://chessprogramming.wikispaces.com/Transposition%20Table#KeyCollisions"}},[t._v("\n          Transposition table\n        ")])]),t._v(" "),i("li",{staticClass:"list-group-item"},[i("a",{attrs:{href:"https://chessprogramming.wikispaces.com/Quiescence+Search"}},[t._v("\n          Quiescence search\n        ")])]),i("li",{staticClass:"list-group-item"},[i("a",{attrs:{href:"https://chessprogramming.wikispaces.com/delta+pruning"}},[t._v("\n          Delta pruning\n        ")])])]),t._v(" "),i("h4",{staticClass:"mt-3"},[t._v("To be implemented")]),t._v(" "),i("ul",{staticClass:"list-group"},[i("li",{staticClass:"list-group-item"},[i("a",{attrs:{href:"https://chessprogramming.wikispaces.com/Killer+Move"}},[t._v("\n          Killer heuristic\n        ")])]),t._v(" "),i("li",{staticClass:"list-group-item"},[i("a",{attrs:{href:"https://chessprogramming.wikispaces.com/Pawn%20Structure"}},[t._v("\n          Pawn structure evaluation\n        ")])])]),t._v(" "),i("h4",{staticClass:"mt-3"},[t._v("Credits to")]),t._v(" "),i("a",{attrs:{href:"https://chessprogramming.wikispaces.com/"}},[t._v("https://chessprogramming.wikispaces.com/")]),t._v(" "),i("br"),t._v(" "),i("a",{attrs:{href:"https://github.com/thomasahle/sunfish"}},[t._v("https://github.com/thomasahle/sunfish")])])}]};var Bt=i("VU/8")(Qt,At,!1,function(t){i("oSBT")},"data-v-60226745",null).exports;n.a.use(a.a);var Ft=new a.a({routes:[{path:"/",name:"Home",component:Bt}]}),qt=i("7t+N"),Kt=i.n(qt);i("qb6w");window.$=window.jquery=Kt.a,n.a.config.productionTip=!1,new n.a({el:"#app",router:Ft,components:{App:s},template:"<App/>"})},TFeN:function(t,e,i){var n={"./bB.png":["z18c",11],"./bK.png":["dLpT",10],"./bN.png":["KRZJ",9],"./bP.png":["9AiN",8],"./bQ.png":["+a6Z",7],"./bR.png":["fFy0",6],"./wB.png":["xofh",5],"./wK.png":["zrxd",4],"./wN.png":["Zz9q",3],"./wP.png":["gMX9",2],"./wQ.png":["80Ug",1],"./wR.png":["rP+x",0]};function r(t){var e=n[t];return e?i.e(e[1]).then(function(){return i(e[0])}):Promise.reject(new Error("Cannot find module '"+t+"'."))}r.keys=function(){return Object.keys(n)},r.id="TFeN",t.exports=r},oSBT:function(t,e){},qb6w:function(t,e){},rXjl:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.f770537593a01dbe5fc9.js.map